"use strict";

/*
 * MikoPBX - free phone system for small business
 * Copyright Â© 2017-2023 Alexey Portnov and Nikolay Beketov
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation; either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License along with this program.
 * If not, see <https://www.gnu.org/licenses/>.
 */

/* global SemanticLocalization, globalRootUrl, moduleUsersUiIndexLdap, UserMessage, Datatable */
var ModuleUsersUIUsersTab = {
  /**
   * Users table.
   * @type {jQuery}
   */
  $usersTable: $('#users-table'),

  /**
   * User data table.
   * @type {Datatable}
   */
  userDataTable: null,

  /**
   * Select group dropdowns.
   * @type {jQuery}
   */
  $selectGroup: $('.select-group'),

  /**
   * User use LDAP table checkboxes.
   * @type {jQuery}
   */
  $userUseLdapTableCheckbox: $('.user-use-ldap-checkbox'),

  /**
   * Body.
   * @type {jQuery}
   */
  $body: $('body'),

  /**
   * Initializes the ModuleUsersUIIndex module.
   */
  initialize: function initialize() {
    ModuleUsersUIUsersTab.initializeDataTable();
    ModuleUsersUIUsersTab.$selectGroup.each(function (index, obj) {
      $(obj).dropdown({
        values: ModuleUsersUIUsersTab.makeDropdownList($(obj).attr('data-value'))
      });
    });
    ModuleUsersUIUsersTab.$selectGroup.dropdown({
      onChange: ModuleUsersUIUsersTab.changeGroupInList
    });
    ModuleUsersUIUsersTab.$userUseLdapTableCheckbox.checkbox({
      onChange: ModuleUsersUIUsersTab.changeLdapInList
    }); // Double click on password or login input field in the table

    ModuleUsersUIUsersTab.$body.on('focusin', '.user-login-input, .user-password-input', function (e) {
      $(e.target).transition('glow');
      $(e.target).closest('div').removeClass('transparent').addClass('changed-field');
      $(e.target).attr('readonly', false);

      if (moduleUsersUiIndexLdap.$useLdapCheckbox.checkbox('is checked') && $(e.target).closest('tr').find('.user-use-ldap-checkbox').checkbox('is checked')) {
        var $inputField = $(e.target);
        $inputField.closest('div').search({
          searchDelay: 300,
          minCharacters: 2,
          // change the search endpoint to a custom endpoint by manipulating apiSettings
          apiSettings: {
            url: "".concat(globalRootUrl, "module-users-u-i/ldap-config/search-ldap-user/{query}")
          }
        }); // Handle Enters key press event

        $inputField.on('keydown', function (event) {
          if (event.key === 'Enter') {
            // Prevent default action (if form, prevent submission)
            event.preventDefault();
            var $searchResults = $inputField.closest('div').find('.results .result'); // If there is one result, insert it into the field

            if ($searchResults.length === 1) {
              var result = $searchResults.first().data('result');
              $inputField.val(result.title);
            }
          }
        });
      }
    }); // Submit form on Enter or Tab

    $(document).on('keydown', function (e) {
      var keyCode = e.keyCode || e.which;

      if (keyCode === 13 || keyCode === 9 && !$(':focus').hasClass('.user-login-input') || keyCode === 9 && !$(':focus').hasClass('.user-password-input')) {
        var $el = $('.changed-field').closest('tr');
        $el.each(function (index, obj) {
          var currentRowId = $(obj).attr('id');

          if (currentRowId !== undefined) {
            ModuleUsersUIUsersTab.changeLoginPasswordInList(currentRowId);
          }
        });
      }
    }); // Submit form on focus out from password or login input field

    ModuleUsersUIUsersTab.$body.on('focusout', '.user-login-input, .user-password-input', function (e) {
      var $el = $('.changed-field').closest('tr');
      $el.each(function (index, obj) {
        var currentRowId = $(obj).attr('id');

        if (currentRowId !== undefined) {
          ModuleUsersUIUsersTab.changeLoginPasswordInList(currentRowId);
        }
      });
    });
  },

  /**
   * Initializes the users table DataTable.
   */
  initializeDataTable: function initializeDataTable() {
    $('#main-users-ui-tab-menu .item').tab({
      onVisible: function onVisible() {
        if ($(this).data('tab') === 'users' && ModuleUsersUIUsersTab.userDataTable !== null) {
          var newPageLength = ModuleUsersUIUsersTab.calculatePageLength();
          ModuleUsersUIUsersTab.userDataTable.page.len(newPageLength).draw(false);
        }
      }
    });
    ModuleUsersUIUsersTab.userDataTable = ModuleUsersUIUsersTab.$usersTable.DataTable({
      // destroy: true,
      lengthChange: false,
      paging: true,
      pageLength: ModuleUsersUIUsersTab.calculatePageLength(),
      scrollCollapse: true,
      columns: [// Username
      {
        orderable: true,
        // This column is orderable
        searchable: true // This column is searchable

      }, // Extension
      {
        orderable: true,
        // This column is orderable
        searchable: true // This column is searchable

      }, // Use LDAP
      {
        orderable: false,
        // This column is not orderable
        searchable: false // This column is not searchable

      }, // Login
      {
        orderable: true,
        // This column is orderable
        searchable: true // This column is searchable

      }, // Password
      {
        orderable: false,
        // This column is not orderable
        searchable: false // This column is not searchable

      }, // Access group
      {
        orderable: true,
        // This column is orderable
        searchable: true // This column is searchable

      }],
      order: [0, 'asc'],
      language: SemanticLocalization.dataTableLocalisation
    });
  },

  /**
   * Creates a dropdown list for users.
   * @param {string} selected - The selected value.
   * @returns {Array} - The dropdown list.
   */
  makeDropdownList: function makeDropdownList(selected) {
    var values = [];
    $('#users-groups-list option').each(function (index, obj) {
      var displayText = obj.text.length > 50 ? obj.text.substring(0, 50) + '...' : obj.text;

      if (selected === obj.text || selected === obj.value) {
        values.push({
          name: displayText,
          value: obj.value,
          selected: true
        });
      } else {
        values.push({
          name: displayText,
          value: obj.value
        });
      }
    });
    return values;
  },

  /**
   * Handles the change of group in the list.
   * @param {string} value - The selected value.
   * @param {string} text - The selected text.
   * @param {jQuery} $choice - The dropdown element.
   */
  changeGroupInList: function changeGroupInList(value, text, $choice) {
    var rowId = $($choice).closest('tr').attr('id');
    ModuleUsersUIUsersTab.addProgressIcon(rowId);
    $.api({
      url: "".concat(globalRootUrl, "module-users-u-i/users-credentials/change-user-group"),
      on: 'now',
      method: 'POST',
      data: {
        user_id: rowId,
        group_id: value
      },
      successTest: function successTest(response) {
        // test whether a JSON response is valid
        return response !== undefined && Object.keys(response).length > 0 && response.success === true;
      },
      onSuccess: function onSuccess() {
        ModuleUsersUIUsersTab.removeProgressIcon(rowId);
        $('.ui.message.ajax').remove();
      },
      onError: function onError(response) {
        if (response.message !== undefined) {
          UserMessage.showMultiString(response.message);
        }

        ModuleUsersUIUsersTab.removeProgressIcon(rowId);
      },
      onFailure: function onFailure(response) {
        if (response.message !== undefined) {
          UserMessage.showMultiString(response.message);
        }

        ModuleUsersUIUsersTab.removeProgressIcon(rowId);
      }
    });
  },

  /**
   * Handles the change of LDAP checkbox in the list.
   */
  changeLdapInList: function changeLdapInList() {
    var rowId = $(this).closest('tr').attr('id');
    ModuleUsersUIUsersTab.addProgressIcon(rowId);
    $.api({
      url: "".concat(globalRootUrl, "module-users-u-i/users-credentials/change-user-use-ldap"),
      on: 'now',
      method: 'POST',
      data: {
        user_id: rowId,
        useLdap: $(this).parent('.checkbox').checkbox('is checked')
      },
      successTest: function successTest(response) {
        // test whether a JSON response is valid
        return response !== undefined && Object.keys(response).length > 0 && response.success === true;
      },
      onSuccess: function onSuccess() {
        ModuleUsersUIUsersTab.removeProgressIcon(rowId);

        if ($("tr#".concat(rowId, " .user-use-ldap-checkbox")).checkbox('is checked')) {
          $("tr#".concat(rowId, " td.password")).hide();
          $("tr#".concat(rowId, " td.login")).attr('colspan', 2);
        } else {
          $("tr#".concat(rowId, " td.password")).show();
          $("tr#".concat(rowId, " td.login")).attr('colspan', 1);
        }

        $('.ui.message.ajax').remove();
      },
      onError: function onError(response) {
        if (response.message !== undefined) {
          UserMessage.showMultiString(response.message);
        }

        ModuleUsersUIUsersTab.removeProgressIcon(rowId);
      },
      onFailure: function onFailure(response) {
        if (response.message !== undefined) {
          UserMessage.showMultiString(response.message);
        }

        ModuleUsersUIUsersTab.removeProgressIcon(rowId);
      }
    });
  },

  /**
   * Changes the login and password in the list.
   * @param {string} rowId - The ID of the row.
   */
  changeLoginPasswordInList: function changeLoginPasswordInList(rowId) {
    var login = $("#".concat(rowId, " input.user-login-input")).val();
    var password = $("#".concat(rowId, " input.user-password-input")).val();
    ModuleUsersUIUsersTab.addProgressIcon(rowId);
    $.api({
      url: "".concat(globalRootUrl, "module-users-u-i/users-credentials/change-user-credentials"),
      on: 'now',
      method: 'POST',
      data: {
        user_id: rowId,
        login: login,
        password: password
      },
      successTest: function successTest(response) {
        // test whether a JSON response is valid
        return response !== undefined && Object.keys(response).length > 0 && response.success === true;
      },
      onSuccess: function onSuccess() {
        ModuleUsersUIUsersTab.removeProgressIcon(rowId);
        $("tr#".concat(rowId, " .changed-field input")).attr('readonly', true);
        $("tr#".concat(rowId, " div.changed-field")).removeClass('changed-field loading').addClass('transparent');
        $('.ui.message.ajax').remove();
      },
      onError: function onError(response) {
        if (response.message !== undefined) {
          UserMessage.showMultiString(response.message);
        }

        ModuleUsersUIUsersTab.removeProgressIcon(rowId);
      },
      onFailure: function onFailure(response) {
        if (response.message !== undefined) {
          UserMessage.showMultiString(response.message);
        }

        ModuleUsersUIUsersTab.removeProgressIcon(rowId);
      }
    });
  },

  /**
   * Adds save icon from the row
   */
  addProgressIcon: function addProgressIcon(rowId) {
    $("tr#".concat(rowId, " .changed-field")).find('.ui.spinner.loading.icon').show();
  },

  /**
   * Removes save icon from the row
   */
  removeProgressIcon: function removeProgressIcon(rowId) {
    $("tr#".concat(rowId, " .changed-field")).find('.ui.spinner.loading.icon').hide();
    $("tr#".concat(rowId, " .changed-field")).closest('div').search('hide results').search('destroy');
  },

  /**
   * Calculate data table page length
   *
   * @returns {number}
   */
  calculatePageLength: function calculatePageLength() {
    // Calculate row height
    var rowHeight = ModuleUsersUIUsersTab.$usersTable.find('tr').first().outerHeight(); // Calculate window height and available space for table

    var windowHeight = window.innerHeight;
    var headerFooterHeight = 400; // Estimate height for header, footer, and other elements
    // Calculate new page length

    return Math.max(Math.floor((windowHeight - headerFooterHeight) / rowHeight), 10);
  }
};
$(document).ready(function () {
  ModuleUsersUIUsersTab.initialize();
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9tb2R1bGUtdXNlcnMtdWktaW5kZXgtdXNlcnMuanMiXSwibmFtZXMiOlsiTW9kdWxlVXNlcnNVSVVzZXJzVGFiIiwiJHVzZXJzVGFibGUiLCIkIiwidXNlckRhdGFUYWJsZSIsIiRzZWxlY3RHcm91cCIsIiR1c2VyVXNlTGRhcFRhYmxlQ2hlY2tib3giLCIkYm9keSIsImluaXRpYWxpemUiLCJpbml0aWFsaXplRGF0YVRhYmxlIiwiZWFjaCIsImluZGV4Iiwib2JqIiwiZHJvcGRvd24iLCJ2YWx1ZXMiLCJtYWtlRHJvcGRvd25MaXN0IiwiYXR0ciIsIm9uQ2hhbmdlIiwiY2hhbmdlR3JvdXBJbkxpc3QiLCJjaGVja2JveCIsImNoYW5nZUxkYXBJbkxpc3QiLCJvbiIsImUiLCJ0YXJnZXQiLCJ0cmFuc2l0aW9uIiwiY2xvc2VzdCIsInJlbW92ZUNsYXNzIiwiYWRkQ2xhc3MiLCJtb2R1bGVVc2Vyc1VpSW5kZXhMZGFwIiwiJHVzZUxkYXBDaGVja2JveCIsImZpbmQiLCIkaW5wdXRGaWVsZCIsInNlYXJjaCIsInNlYXJjaERlbGF5IiwibWluQ2hhcmFjdGVycyIsImFwaVNldHRpbmdzIiwidXJsIiwiZ2xvYmFsUm9vdFVybCIsImV2ZW50Iiwia2V5IiwicHJldmVudERlZmF1bHQiLCIkc2VhcmNoUmVzdWx0cyIsImxlbmd0aCIsInJlc3VsdCIsImZpcnN0IiwiZGF0YSIsInZhbCIsInRpdGxlIiwiZG9jdW1lbnQiLCJrZXlDb2RlIiwid2hpY2giLCJoYXNDbGFzcyIsIiRlbCIsImN1cnJlbnRSb3dJZCIsInVuZGVmaW5lZCIsImNoYW5nZUxvZ2luUGFzc3dvcmRJbkxpc3QiLCJ0YWIiLCJvblZpc2libGUiLCJuZXdQYWdlTGVuZ3RoIiwiY2FsY3VsYXRlUGFnZUxlbmd0aCIsInBhZ2UiLCJsZW4iLCJkcmF3IiwiRGF0YVRhYmxlIiwibGVuZ3RoQ2hhbmdlIiwicGFnaW5nIiwicGFnZUxlbmd0aCIsInNjcm9sbENvbGxhcHNlIiwiY29sdW1ucyIsIm9yZGVyYWJsZSIsInNlYXJjaGFibGUiLCJvcmRlciIsImxhbmd1YWdlIiwiU2VtYW50aWNMb2NhbGl6YXRpb24iLCJkYXRhVGFibGVMb2NhbGlzYXRpb24iLCJzZWxlY3RlZCIsImRpc3BsYXlUZXh0IiwidGV4dCIsInN1YnN0cmluZyIsInZhbHVlIiwicHVzaCIsIm5hbWUiLCIkY2hvaWNlIiwicm93SWQiLCJhZGRQcm9ncmVzc0ljb24iLCJhcGkiLCJtZXRob2QiLCJ1c2VyX2lkIiwiZ3JvdXBfaWQiLCJzdWNjZXNzVGVzdCIsInJlc3BvbnNlIiwiT2JqZWN0Iiwia2V5cyIsInN1Y2Nlc3MiLCJvblN1Y2Nlc3MiLCJyZW1vdmVQcm9ncmVzc0ljb24iLCJyZW1vdmUiLCJvbkVycm9yIiwibWVzc2FnZSIsIlVzZXJNZXNzYWdlIiwic2hvd011bHRpU3RyaW5nIiwib25GYWlsdXJlIiwidXNlTGRhcCIsInBhcmVudCIsImhpZGUiLCJzaG93IiwibG9naW4iLCJwYXNzd29yZCIsInJvd0hlaWdodCIsIm91dGVySGVpZ2h0Iiwid2luZG93SGVpZ2h0Iiwid2luZG93IiwiaW5uZXJIZWlnaHQiLCJoZWFkZXJGb290ZXJIZWlnaHQiLCJNYXRoIiwibWF4IiwiZmxvb3IiLCJyZWFkeSJdLCJtYXBwaW5ncyI6Ijs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBRUEsSUFBTUEscUJBQXFCLEdBQUc7QUFFMUI7QUFDSjtBQUNBO0FBQ0E7QUFDSUMsRUFBQUEsV0FBVyxFQUFFQyxDQUFDLENBQUMsY0FBRCxDQU5ZOztBQVExQjtBQUNKO0FBQ0E7QUFDQTtBQUNJQyxFQUFBQSxhQUFhLEVBQUUsSUFaVzs7QUFjMUI7QUFDSjtBQUNBO0FBQ0E7QUFDSUMsRUFBQUEsWUFBWSxFQUFFRixDQUFDLENBQUMsZUFBRCxDQWxCVzs7QUFvQjFCO0FBQ0o7QUFDQTtBQUNBO0FBQ0lHLEVBQUFBLHlCQUF5QixF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QVksR0FBR0csa0JBQWhCLElBQXNDTCxTQUFqRCxDQUFULEVBQXNFLEVBQXRFLENBQVA7QUFDSDtBQTNXeUIsQ0FBOUI7QUE4V0F6RyxDQUFDLENBQUM2QyxRQUFELENBQUQsQ0FBWXFFLEtBQVosQ0FBa0IsWUFBTTtBQUNwQnBILEVBQUFBLHFCQUFxQixDQUFDTyxVQUF0QjtBQUNILENBRkQiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuICogTWlrb1BCWCAtIGZyZWUgcGhvbmUgc3lzdGVtIGZvciBzbWFsbCBidXNpbmVzc1xuICogQ29weXJpZ2h0IMKpIDIwMTctMjAyMyBBbGV4ZXkgUG9ydG5vdiBhbmQgTmlrb2xheSBCZWtldG92XG4gKlxuICogVGhpcyBwcm9ncmFtIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnlcbiAqIGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5XG4gKiB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uOyBlaXRoZXIgdmVyc2lvbiAzIG9mIHRoZSBMaWNlbnNlLCBvclxuICogKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi5cbiAqXG4gKiBUaGlzIHByb2dyYW0gaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCxcbiAqIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mXG4gKiBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlXG4gKiBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLlxuICpcbiAqIFlvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFsb25nIHdpdGggdGhpcyBwcm9ncmFtLlxuICogSWYgbm90LCBzZWUgPGh0dHBzOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvPi5cbiAqL1xuXG4vKiBnbG9iYWwgU2VtYW50aWNMb2NhbGl6YXRpb24sIGdsb2JhbFJvb3RVcmwsIG1vZHVsZVVzZXJzVWlJbmRleExkYXAsIFVzZXJNZXNzYWdlLCBEYXRhdGFibGUgKi9cblxuY29uc3QgTW9kdWxlVXNlcnNVSVVzZXJzVGFiID0ge1xuXG4gICAgLyoqXG4gICAgICogVXNlcnMgdGFibGUuXG4gICAgICogQHR5cGUge2pRdWVyeX1cbiAgICAgKi9cbiAgICAkdXNlcnNUYWJsZTogJCgnI3VzZXJzLXRhYmxlJyksXG5cbiAgICAvKipcbiAgICAgKiBVc2VyIGRhdGEgdGFibGUuXG4gICAgICogQHR5cGUge0RhdGF0YWJsZX1cbiAgICAgKi9cbiAgICB1c2VyRGF0YVRhYmxlOiBudWxsLFxuXG4gICAgLyoqXG4gICAgICogU2VsZWN0IGdyb3VwIGRyb3Bkb3ducy5cbiAgICAgKiBAdHlwZSB7alF1ZXJ5fVxuICAgICAqL1xuICAgICRzZWxlY3RHcm91cDogJCgnLnNlbGVjdC1ncm91cCcpLFxuXG4gICAgLyoqXG4gICAgICogVXNlciB1c2UgTERBUCB0YWJsZSBjaGVja2JveGVzLlxuICAgICAqIEB0eXBlIHtqUXVlcnl9XG4gICAgICovXG4gICAgJHVzZXJVc2VMZGFwVGFibGVDaGVja2JveDogJCgnLnVzZXItdXNlLWxkYXAtY2hlY2tib3gnKSxcblxuICAgIC8qKlxuICAgICAqIEJvZHkuXG4gICAgICogQHR5cGUge2pRdWVyeX1cbiAgICAgKi9cbiAgICAkYm9keTogJCgnYm9keScpLFxuXG4gICAgLyoqXG4gICAgICogSW5pdGlhbGl6ZXMgdGhlIE1vZHVsZVVzZXJzVUlJbmRleCBtb2R1bGUuXG4gICAgICovXG4gICAgaW5pdGlhbGl6ZSgpIHtcblxuICAgICAgICBNb2R1bGVVc2Vyc1VJVXNlcnNUYWIuaW5pdGlhbGl6ZURhdGFUYWJsZSgpO1xuXG4gICAgICAgIE1vZHVsZVVzZXJzVUlVc2Vyc1RhYi4kc2VsZWN0R3JvdXAuZWFjaCgoaW5kZXgsIG9iaikgPT4ge1xuICAgICAgICAgICAgJChvYmopLmRyb3Bkb3duKHtcbiAgICAgICAgICAgICAgICB2YWx1ZXM6IE1vZHVsZVVzZXJzVUlVc2Vyc1RhYi5tYWtlRHJvcGRvd25MaXN0KCQob2JqKS5hdHRyKCdkYXRhLXZhbHVlJykpLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgICBNb2R1bGVVc2Vyc1VJVXNlcnNUYWIuJHNlbGVjdEdyb3VwLmRyb3Bkb3duKHtcbiAgICAgICAgICAgIG9uQ2hhbmdlOiBNb2R1bGVVc2Vyc1VJVXNlcnNUYWIuY2hhbmdlR3JvdXBJbkxpc3QsXG4gICAgICAgIH0pO1xuXG4gICAgICAgIE1vZHVsZVVzZXJzVUlVc2Vyc1RhYi4kdXNlclVzZUxkYXBUYWJsZUNoZWNrYm94LmNoZWNrYm94KHtcbiAgICAgICAgICAgIG9uQ2hhbmdlOiBNb2R1bGVVc2Vyc1VJVXNlcnNUYWIuY2hhbmdlTGRhcEluTGlzdCxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gRG91YmxlIGNsaWNrIG9uIHBhc3N3b3JkIG9yIGxvZ2luIGlucHV0IGZpZWxkIGluIHRoZSB0YWJsZVxuICAgICAgICBNb2R1bGVVc2Vyc1VJVXNlcnNUYWIuJGJvZHkub24oJ2ZvY3VzaW4nLCAnLnVzZXItbG9naW4taW5wdXQsIC51c2VyLXBhc3N3b3JkLWlucHV0JywgKGUpID0+IHtcbiAgICAgICAgICAgICQoZS50YXJnZXQpLnRyYW5zaXRpb24oJ2dsb3cnKTtcblxuICAgICAgICAgICAgJChlLnRhcmdldCkuY2xvc2VzdCgnZGl2JylcbiAgICAgICAgICAgICAgICAucmVtb3ZlQ2xhc3MoJ3RyYW5zcGFyZW50JylcbiAgICAgICAgICAgICAgICAuYWRkQ2xhc3MoJ2NoYW5nZWQtZmllbGQnKTtcbiAgICAgICAgICAgICQoZS50YXJnZXQpLmF0dHIoJ3JlYWRvbmx5JywgZmFsc2UpO1xuXG4gICAgICAgICAgICBpZiAobW9kdWxlVXNlcnNVaUluZGV4TGRhcC4kdXNlTGRhcENoZWNrYm94LmNoZWNrYm94KCdpcyBjaGVja2VkJylcbiAgICAgICAgICAgICAgICAmJiAkKGUudGFyZ2V0KS5jbG9zZXN0KCd0cicpLmZpbmQoJy51c2VyLXVzZS1sZGFwLWNoZWNrYm94JykuY2hlY2tib3goJ2lzIGNoZWNrZWQnKSl7XG5cbiAgICAgICAgICAgICAgICBjb25zdCAkaW5wdXRGaWVsZCA9ICQoZS50YXJnZXQpO1xuICAgICAgICAgICAgICAgICRpbnB1dEZpZWxkLmNsb3Nlc3QoJ2RpdicpLnNlYXJjaCh7XG4gICAgICAgICAgICAgICAgICAgIHNlYXJjaERlbGF5OiAzMDAsXG4gICAgICAgICAgICAgICAgICAgIG1pbkNoYXJhY3RlcnM6IDIsXG4gICAgICAgICAgICAgICAgICAgIC8vIGNoYW5nZSB0aGUgc2VhcmNoIGVuZHBvaW50IHRvIGEgY3VzdG9tIGVuZHBvaW50IGJ5IG1hbmlwdWxhdGluZyBhcGlTZXR0aW5nc1xuICAgICAgICAgICAgICAgICAgICBhcGlTZXR0aW5nczoge1xuICAgICAgICAgICAgICAgICAgICAgICAgdXJsOiBgJHtnbG9iYWxSb290VXJsfW1vZHVsZS11c2Vycy11LWkvbGRhcC1jb25maWcvc2VhcmNoLWxkYXAtdXNlci97cXVlcnl9YFxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIC8vIEhhbmRsZSBFbnRlcnMga2V5IHByZXNzIGV2ZW50XG4gICAgICAgICAgICAgICAgJGlucHV0RmllbGQub24oJ2tleWRvd24nLCBmdW5jdGlvbihldmVudCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoZXZlbnQua2V5ID09PSAnRW50ZXInKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBQcmV2ZW50IGRlZmF1bHQgYWN0aW9uIChpZiBmb3JtLCBwcmV2ZW50IHN1Ym1pc3Npb24pXG4gICAgICAgICAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgJHNlYXJjaFJlc3VsdHMgPSAkaW5wdXRGaWVsZC5jbG9zZXN0KCdkaXYnKS5maW5kKCcucmVzdWx0cyAucmVzdWx0Jyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBJZiB0aGVyZSBpcyBvbmUgcmVzdWx0LCBpbnNlcnQgaXQgaW50byB0aGUgZmllbGRcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkc2VhcmNoUmVzdWx0cy5sZW5ndGggPT09IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCByZXN1bHQgPSAkc2VhcmNoUmVzdWx0cy5maXJzdCgpLmRhdGEoJ3Jlc3VsdCcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRpbnB1dEZpZWxkLnZhbChyZXN1bHQudGl0bGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gU3VibWl0IGZvcm0gb24gRW50ZXIgb3IgVGFiXG4gICAgICAgICQoZG9jdW1lbnQpLm9uKCdrZXlkb3duJywgKGUpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGtleUNvZGUgPSBlLmtleUNvZGUgfHwgZS53aGljaDtcbiAgICAgICAgICAgIGlmIChrZXlDb2RlID09PSAxM1xuICAgICAgICAgICAgICAgIHx8IChrZXlDb2RlID09PSA5ICYmICEkKCc6Zm9jdXMnKS5oYXNDbGFzcygnLnVzZXItbG9naW4taW5wdXQnKSlcbiAgICAgICAgICAgICAgICB8fCAoa2V5Q29kZSA9PT0gOSAmJiAhJCgnOmZvY3VzJykuaGFzQ2xhc3MoJy51c2VyLXBhc3N3b3JkLWlucHV0JykpXG4gICAgICAgICAgICApIHtcbiAgICAgICAgICAgICAgICBjb25zdCAkZWwgPSAkKCcuY2hhbmdlZC1maWVsZCcpLmNsb3Nlc3QoJ3RyJyk7XG4gICAgICAgICAgICAgICAgJGVsLmVhY2goKGluZGV4LCBvYmopID0+IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY3VycmVudFJvd0lkID0gJChvYmopLmF0dHIoJ2lkJyk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChjdXJyZW50Um93SWQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgTW9kdWxlVXNlcnNVSVVzZXJzVGFiLmNoYW5nZUxvZ2luUGFzc3dvcmRJbkxpc3QoY3VycmVudFJvd0lkKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICAvLyBTdWJtaXQgZm9ybSBvbiBmb2N1cyBvdXQgZnJvbSBwYXNzd29yZCBvciBsb2dpbiBpbnB1dCBmaWVsZFxuICAgICAgICBNb2R1bGVVc2Vyc1VJVXNlcnNUYWIuJGJvZHkub24oJ2ZvY3Vzb3V0JywgJy51c2VyLWxvZ2luLWlucHV0LCAudXNlci1wYXNzd29yZC1pbnB1dCcsIChlKSA9PiB7XG4gICAgICAgICAgICBjb25zdCAkZWwgPSAkKCcuY2hhbmdlZC1maWVsZCcpLmNsb3Nlc3QoJ3RyJyk7XG4gICAgICAgICAgICAkZWwuZWFjaCgoaW5kZXgsIG9iaikgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRSb3dJZCA9ICQob2JqKS5hdHRyKCdpZCcpO1xuICAgICAgICAgICAgICAgIGlmIChjdXJyZW50Um93SWQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICBNb2R1bGVVc2Vyc1VJVXNlcnNUYWIuY2hhbmdlTG9naW5QYXNzd29yZEluTGlzdChjdXJyZW50Um93SWQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcblxuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBJbml0aWFsaXplcyB0aGUgdXNlcnMgdGFibGUgRGF0YVRhYmxlLlxuICAgICAqL1xuICAgIGluaXRpYWxpemVEYXRhVGFibGUoKSB7XG5cbiAgICAgICAgJCgnI21haW4tdXNlcnMtdWktdGFiLW1lbnUgLml0ZW0nKS50YWIoe1xuICAgICAgICAgICAgb25WaXNpYmxlKCl7XG4gICAgICAgICAgICAgICAgaWYgKCQodGhpcykuZGF0YSgndGFiJyk9PT0ndXNlcnMnICYmIE1vZHVsZVVzZXJzVUlVc2Vyc1RhYi51c2VyRGF0YVRhYmxlIT09bnVsbCl7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG5ld1BhZ2VMZW5ndGggPSBNb2R1bGVVc2Vyc1VJVXNlcnNUYWIuY2FsY3VsYXRlUGFnZUxlbmd0aCgpO1xuICAgICAgICAgICAgICAgICAgICBNb2R1bGVVc2Vyc1VJVXNlcnNUYWIudXNlckRhdGFUYWJsZS5wYWdlLmxlbihuZXdQYWdlTGVuZ3RoKS5kcmF3KGZhbHNlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIE1vZHVsZVVzZXJzVUlVc2Vyc1RhYi51c2VyRGF0YVRhYmxlID0gTW9kdWxlVXNlcnNVSVVzZXJzVGFiLiR1c2Vyc1RhYmxlLkRhdGFUYWJsZSh7XG4gICAgICAgICAgICAvLyBkZXN0cm95OiB0cnVlLFxuICAgICAgICAgICAgbGVuZ3RoQ2hhbmdlOiBmYWxzZSxcbiAgICAgICAgICAgIHBhZ2luZzogdHJ1ZSxcbiAgICAgICAgICAgIHBhZ2VMZW5ndGg6IE1vZHVsZVVzZXJzVUlVc2Vyc1RhYi5jYWxjdWxhdGVQYWdlTGVuZ3RoKCksXG4gICAgICAgICAgICBzY3JvbGxDb2xsYXBzZTogdHJ1ZSxcbiAgICAgICAgICAgIGNvbHVtbnM6IFtcbiAgICAgICAgICAgICAgICAvLyBVc2VybmFtZVxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgb3JkZXJhYmxlOiB0cnVlLCAgLy8gVGhpcyBjb2x1bW4gaXMgb3JkZXJhYmxlXG4gICAgICAgICAgICAgICAgICAgIHNlYXJjaGFibGU6IHRydWUgIC8vIFRoaXMgY29sdW1uIGlzIHNlYXJjaGFibGVcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIC8vIEV4dGVuc2lvblxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgb3JkZXJhYmxlOiB0cnVlLCAgLy8gVGhpcyBjb2x1bW4gaXMgb3JkZXJhYmxlXG4gICAgICAgICAgICAgICAgICAgIHNlYXJjaGFibGU6IHRydWUgIC8vIFRoaXMgY29sdW1uIGlzIHNlYXJjaGFibGVcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIC8vIFVzZSBMREFQXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBvcmRlcmFibGU6IGZhbHNlLCAgLy8gVGhpcyBjb2x1bW4gaXMgbm90IG9yZGVyYWJsZVxuICAgICAgICAgICAgICAgICAgICBzZWFyY2hhYmxlOiBmYWxzZSAgLy8gVGhpcyBjb2x1bW4gaXMgbm90IHNlYXJjaGFibGVcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIC8vIExvZ2luXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBvcmRlcmFibGU6IHRydWUsICAvLyBUaGlzIGNvbHVtbiBpcyBvcmRlcmFibGVcbiAgICAgICAgICAgICAgICAgICAgc2VhcmNoYWJsZTogdHJ1ZSAgLy8gVGhpcyBjb2x1bW4gaXMgc2VhcmNoYWJsZVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgLy8gUGFzc3dvcmRcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIG9yZGVyYWJsZTogZmFsc2UsICAvLyBUaGlzIGNvbHVtbiBpcyBub3Qgb3JkZXJhYmxlXG4gICAgICAgICAgICAgICAgICAgIHNlYXJjaGFibGU6IGZhbHNlICAvLyBUaGlzIGNvbHVtbiBpcyBub3Qgc2VhcmNoYWJsZVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgLy8gQWNjZXNzIGdyb3VwXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBvcmRlcmFibGU6IHRydWUsICAvLyBUaGlzIGNvbHVtbiBpcyBvcmRlcmFibGVcbiAgICAgICAgICAgICAgICAgICAgc2VhcmNoYWJsZTogdHJ1ZSAgLy8gVGhpcyBjb2x1bW4gaXMgc2VhcmNoYWJsZVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBdLFxuICAgICAgICAgICAgb3JkZXI6IFswLCAnYXNjJ10sXG4gICAgICAgICAgICBsYW5ndWFnZTogU2VtYW50aWNMb2NhbGl6YXRpb24uZGF0YVRhYmxlTG9jYWxpc2F0aW9uLFxuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhIGRyb3Bkb3duIGxpc3QgZm9yIHVzZXJzLlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBzZWxlY3RlZCAtIFRoZSBzZWxlY3RlZCB2YWx1ZS5cbiAgICAgKiBAcmV0dXJucyB7QXJyYXl9IC0gVGhlIGRyb3Bkb3duIGxpc3QuXG4gICAgICovXG4gICAgbWFrZURyb3Bkb3duTGlzdChzZWxlY3RlZCkge1xuICAgICAgICBjb25zdCB2YWx1ZXMgPSBbXTtcbiAgICAgICAgJCgnI3VzZXJzLWdyb3Vwcy1saXN0IG9wdGlvbicpLmVhY2goKGluZGV4LCBvYmopID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGRpc3BsYXlUZXh0ID0gb2JqLnRleHQubGVuZ3RoID4gNTAgPyBvYmoudGV4dC5zdWJzdHJpbmcoMCwgNTApICsgJy4uLicgOiBvYmoudGV4dDtcbiAgICAgICAgICAgIGlmIChzZWxlY3RlZCA9PT0gb2JqLnRleHQgfHwgc2VsZWN0ZWQgPT09IG9iai52YWx1ZSkge1xuICAgICAgICAgICAgICAgIHZhbHVlcy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgbmFtZTogZGlzcGxheVRleHQsXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlOiBvYmoudmFsdWUsXG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdGVkOiB0cnVlLFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB2YWx1ZXMucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgIG5hbWU6IGRpc3BsYXlUZXh0LFxuICAgICAgICAgICAgICAgICAgICB2YWx1ZTogb2JqLnZhbHVlLFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIHZhbHVlcztcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogSGFuZGxlcyB0aGUgY2hhbmdlIG9mIGdyb3VwIGluIHRoZSBsaXN0LlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSB2YWx1ZSAtIFRoZSBzZWxlY3RlZCB2YWx1ZS5cbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gdGV4dCAtIFRoZSBzZWxlY3RlZCB0ZXh0LlxuICAgICAqIEBwYXJhbSB7alF1ZXJ5fSAkY2hvaWNlIC0gVGhlIGRyb3Bkb3duIGVsZW1lbnQuXG4gICAgICovXG4gICAgY2hhbmdlR3JvdXBJbkxpc3QodmFsdWUsIHRleHQsICRjaG9pY2UpIHtcbiAgICAgICAgY29uc3Qgcm93SWQgPSAkKCRjaG9pY2UpLmNsb3Nlc3QoJ3RyJykuYXR0cignaWQnKTtcbiAgICAgICAgTW9kdWxlVXNlcnNVSVVzZXJzVGFiLmFkZFByb2dyZXNzSWNvbihyb3dJZCk7XG4gICAgICAgICQuYXBpKHtcbiAgICAgICAgICAgIHVybDogYCR7Z2xvYmFsUm9vdFVybH1tb2R1bGUtdXNlcnMtdS1pL3VzZXJzLWNyZWRlbnRpYWxzL2NoYW5nZS11c2VyLWdyb3VwYCxcbiAgICAgICAgICAgIG9uOiAnbm93JyxcbiAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgIHVzZXJfaWQ6IHJvd0lkLFxuICAgICAgICAgICAgICAgIGdyb3VwX2lkOiB2YWx1ZSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzdWNjZXNzVGVzdChyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgIC8vIHRlc3Qgd2hldGhlciBhIEpTT04gcmVzcG9uc2UgaXMgdmFsaWRcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UgIT09IHVuZGVmaW5lZFxuICAgICAgICAgICAgICAgICAgICAmJiBPYmplY3Qua2V5cyhyZXNwb25zZSkubGVuZ3RoID4gMFxuICAgICAgICAgICAgICAgICAgICAmJiByZXNwb25zZS5zdWNjZXNzID09PSB0cnVlO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG9uU3VjY2VzcygpIHtcbiAgICAgICAgICAgICAgICBNb2R1bGVVc2Vyc1VJVXNlcnNUYWIucmVtb3ZlUHJvZ3Jlc3NJY29uKHJvd0lkKTtcbiAgICAgICAgICAgICAgICAkKCcudWkubWVzc2FnZS5hamF4JykucmVtb3ZlKCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgb25FcnJvcihyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5tZXNzYWdlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgVXNlck1lc3NhZ2Uuc2hvd011bHRpU3RyaW5nKHJlc3BvbnNlLm1lc3NhZ2UpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBNb2R1bGVVc2Vyc1VJVXNlcnNUYWIucmVtb3ZlUHJvZ3Jlc3NJY29uKHJvd0lkKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBvbkZhaWx1cmUocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UubWVzc2FnZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIFVzZXJNZXNzYWdlLnNob3dNdWx0aVN0cmluZyhyZXNwb25zZS5tZXNzYWdlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgTW9kdWxlVXNlcnNVSVVzZXJzVGFiLnJlbW92ZVByb2dyZXNzSWNvbihyb3dJZCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogSGFuZGxlcyB0aGUgY2hhbmdlIG9mIExEQVAgY2hlY2tib3ggaW4gdGhlIGxpc3QuXG4gICAgICovXG4gICAgY2hhbmdlTGRhcEluTGlzdCgpIHtcbiAgICAgICAgY29uc3Qgcm93SWQgPSAkKHRoaXMpLmNsb3Nlc3QoJ3RyJykuYXR0cignaWQnKTtcbiAgICAgICAgTW9kdWxlVXNlcnNVSVVzZXJzVGFiLmFkZFByb2dyZXNzSWNvbihyb3dJZCk7XG4gICAgICAgICQuYXBpKHtcbiAgICAgICAgICAgIHVybDogYCR7Z2xvYmFsUm9vdFVybH1tb2R1bGUtdXNlcnMtdS1pL3VzZXJzLWNyZWRlbnRpYWxzL2NoYW5nZS11c2VyLXVzZS1sZGFwYCxcbiAgICAgICAgICAgIG9uOiAnbm93JyxcbiAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgIHVzZXJfaWQ6IHJvd0lkLFxuICAgICAgICAgICAgICAgIHVzZUxkYXA6ICQodGhpcykucGFyZW50KCcuY2hlY2tib3gnKS5jaGVja2JveCgnaXMgY2hlY2tlZCcpLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHN1Y2Nlc3NUZXN0KHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgLy8gdGVzdCB3aGV0aGVyIGEgSlNPTiByZXNwb25zZSBpcyB2YWxpZFxuICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZSAhPT0gdW5kZWZpbmVkXG4gICAgICAgICAgICAgICAgICAgICYmIE9iamVjdC5rZXlzKHJlc3BvbnNlKS5sZW5ndGggPiAwXG4gICAgICAgICAgICAgICAgICAgICYmIHJlc3BvbnNlLnN1Y2Nlc3MgPT09IHRydWU7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgb25TdWNjZXNzKCkge1xuICAgICAgICAgICAgICAgIE1vZHVsZVVzZXJzVUlVc2Vyc1RhYi5yZW1vdmVQcm9ncmVzc0ljb24ocm93SWQpO1xuICAgICAgICAgICAgICAgIGlmICgkKGB0ciMke3Jvd0lkfSAudXNlci11c2UtbGRhcC1jaGVja2JveGApLmNoZWNrYm94KCdpcyBjaGVja2VkJykpe1xuICAgICAgICAgICAgICAgICAgICAkKGB0ciMke3Jvd0lkfSB0ZC5wYXNzd29yZGApLmhpZGUoKTtcbiAgICAgICAgICAgICAgICAgICAgJChgdHIjJHtyb3dJZH0gdGQubG9naW5gKS5hdHRyKCdjb2xzcGFuJywyKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAkKGB0ciMke3Jvd0lkfSB0ZC5wYXNzd29yZGApLnNob3coKTtcbiAgICAgICAgICAgICAgICAgICAgJChgdHIjJHtyb3dJZH0gdGQubG9naW5gKS5hdHRyKCdjb2xzcGFuJywxKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgJCgnLnVpLm1lc3NhZ2UuYWpheCcpLnJlbW92ZSgpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG9uRXJyb3IocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UubWVzc2FnZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIFVzZXJNZXNzYWdlLnNob3dNdWx0aVN0cmluZyhyZXNwb25zZS5tZXNzYWdlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgTW9kdWxlVXNlcnNVSVVzZXJzVGFiLnJlbW92ZVByb2dyZXNzSWNvbihyb3dJZCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgb25GYWlsdXJlKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLm1lc3NhZ2UgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICBVc2VyTWVzc2FnZS5zaG93TXVsdGlTdHJpbmcocmVzcG9uc2UubWVzc2FnZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIE1vZHVsZVVzZXJzVUlVc2Vyc1RhYi5yZW1vdmVQcm9ncmVzc0ljb24ocm93SWQpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIENoYW5nZXMgdGhlIGxvZ2luIGFuZCBwYXNzd29yZCBpbiB0aGUgbGlzdC5cbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gcm93SWQgLSBUaGUgSUQgb2YgdGhlIHJvdy5cbiAgICAgKi9cbiAgICBjaGFuZ2VMb2dpblBhc3N3b3JkSW5MaXN0KHJvd0lkKSB7XG4gICAgICAgIGNvbnN0IGxvZ2luID0gJChgIyR7cm93SWR9IGlucHV0LnVzZXItbG9naW4taW5wdXRgKS52YWwoKTtcbiAgICAgICAgY29uc3QgcGFzc3dvcmQgPSAkKGAjJHtyb3dJZH0gaW5wdXQudXNlci1wYXNzd29yZC1pbnB1dGApLnZhbCgpO1xuXG4gICAgICAgIE1vZHVsZVVzZXJzVUlVc2Vyc1RhYi5hZGRQcm9ncmVzc0ljb24ocm93SWQpO1xuXG4gICAgICAgICQuYXBpKHtcbiAgICAgICAgICAgIHVybDogYCR7Z2xvYmFsUm9vdFVybH1tb2R1bGUtdXNlcnMtdS1pL3VzZXJzLWNyZWRlbnRpYWxzL2NoYW5nZS11c2VyLWNyZWRlbnRpYWxzYCxcbiAgICAgICAgICAgIG9uOiAnbm93JyxcbiAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgIHVzZXJfaWQ6IHJvd0lkLFxuICAgICAgICAgICAgICAgIGxvZ2luOiBsb2dpbixcbiAgICAgICAgICAgICAgICBwYXNzd29yZDogcGFzc3dvcmQsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc3VjY2Vzc1Rlc3QocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAvLyB0ZXN0IHdoZXRoZXIgYSBKU09OIHJlc3BvbnNlIGlzIHZhbGlkXG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlICE9PSB1bmRlZmluZWRcbiAgICAgICAgICAgICAgICAgICAgJiYgT2JqZWN0LmtleXMocmVzcG9uc2UpLmxlbmd0aCA+IDBcbiAgICAgICAgICAgICAgICAgICAgJiYgcmVzcG9uc2Uuc3VjY2VzcyA9PT0gdHJ1ZTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBvblN1Y2Nlc3MoKSB7XG4gICAgICAgICAgICAgICAgTW9kdWxlVXNlcnNVSVVzZXJzVGFiLnJlbW92ZVByb2dyZXNzSWNvbihyb3dJZCk7XG4gICAgICAgICAgICAgICAgJChgdHIjJHtyb3dJZH0gLmNoYW5nZWQtZmllbGQgaW5wdXRgKS5hdHRyKCdyZWFkb25seScsIHRydWUpO1xuICAgICAgICAgICAgICAgICQoYHRyIyR7cm93SWR9IGRpdi5jaGFuZ2VkLWZpZWxkYCkucmVtb3ZlQ2xhc3MoJ2NoYW5nZWQtZmllbGQgbG9hZGluZycpLmFkZENsYXNzKCd0cmFuc3BhcmVudCcpO1xuICAgICAgICAgICAgICAgICQoJy51aS5tZXNzYWdlLmFqYXgnKS5yZW1vdmUoKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBvbkVycm9yKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLm1lc3NhZ2UgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICBVc2VyTWVzc2FnZS5zaG93TXVsdGlTdHJpbmcocmVzcG9uc2UubWVzc2FnZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIE1vZHVsZVVzZXJzVUlVc2Vyc1RhYi5yZW1vdmVQcm9ncmVzc0ljb24ocm93SWQpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG9uRmFpbHVyZShyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5tZXNzYWdlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgVXNlck1lc3NhZ2Uuc2hvd011bHRpU3RyaW5nKHJlc3BvbnNlLm1lc3NhZ2UpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBNb2R1bGVVc2Vyc1VJVXNlcnNUYWIucmVtb3ZlUHJvZ3Jlc3NJY29uKHJvd0lkKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0pO1xuICAgIH0sXG4gICAgLyoqXG4gICAgICogQWRkcyBzYXZlIGljb24gZnJvbSB0aGUgcm93XG4gICAgICovXG4gICAgYWRkUHJvZ3Jlc3NJY29uKHJvd0lkKXtcbiAgICAgICAgJChgdHIjJHtyb3dJZH0gLmNoYW5nZWQtZmllbGRgKS5maW5kKCcudWkuc3Bpbm5lci5sb2FkaW5nLmljb24nKS5zaG93KCk7XG4gICAgfSxcbiAgICAvKipcbiAgICAgKiBSZW1vdmVzIHNhdmUgaWNvbiBmcm9tIHRoZSByb3dcbiAgICAgKi9cbiAgICByZW1vdmVQcm9ncmVzc0ljb24ocm93SWQpIHtcbiAgICAgICAgJChgdHIjJHtyb3dJZH0gLmNoYW5nZWQtZmllbGRgKS5maW5kKCcudWkuc3Bpbm5lci5sb2FkaW5nLmljb24nKS5oaWRlKCk7XG4gICAgICAgICQoYHRyIyR7cm93SWR9IC5jaGFuZ2VkLWZpZWxkYCkuY2xvc2VzdCgnZGl2Jykuc2VhcmNoKCdoaWRlIHJlc3VsdHMnKS5zZWFyY2goJ2Rlc3Ryb3knKTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogQ2FsY3VsYXRlIGRhdGEgdGFibGUgcGFnZSBsZW5ndGhcbiAgICAgKlxuICAgICAqIEByZXR1cm5zIHtudW1iZXJ9XG4gICAgICovXG4gICAgY2FsY3VsYXRlUGFnZUxlbmd0aCgpIHtcbiAgICAgICAgLy8gQ2FsY3VsYXRlIHJvdyBoZWlnaHRcbiAgICAgICAgbGV0IHJvd0hlaWdodCA9IE1vZHVsZVVzZXJzVUlVc2Vyc1RhYi4kdXNlcnNUYWJsZS5maW5kKCd0cicpLmZpcnN0KCkub3V0ZXJIZWlnaHQoKTtcbiAgICAgICAgLy8gQ2FsY3VsYXRlIHdpbmRvdyBoZWlnaHQgYW5kIGF2YWlsYWJsZSBzcGFjZSBmb3IgdGFibGVcbiAgICAgICAgY29uc3Qgd2luZG93SGVpZ2h0ID0gd2luZG93LmlubmVySGVpZ2h0O1xuICAgICAgICBjb25zdCBoZWFkZXJGb290ZXJIZWlnaHQgPSA0MDA7IC8vIEVzdGltYXRlIGhlaWdodCBmb3IgaGVhZGVyLCBmb290ZXIsIGFuZCBvdGhlciBlbGVtZW50c1xuXG4gICAgICAgIC8vIENhbGN1bGF0ZSBuZXcgcGFnZSBsZW5ndGhcbiAgICAgICAgcmV0dXJuIE1hdGgubWF4KE1hdGguZmxvb3IoKHdpbmRvd0hlaWdodCAtIGhlYWRlckZvb3RlckhlaWdodCkgLyByb3dIZWlnaHQpLCAxMCk7XG4gICAgfSxcbn07XG5cbiQoZG9jdW1lbnQpLnJlYWR5KCgpID0+IHtcbiAgICBNb2R1bGVVc2Vyc1VJVXNlcnNUYWIuaW5pdGlhbGl6ZSgpO1xufSk7XG5cbiJdfQ==