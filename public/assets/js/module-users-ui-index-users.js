"use strict";

/*
 * MikoPBX - free phone system for small business
 * Copyright Â© 2017-2023 Alexey Portnov and Nikolay Beketov
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation; either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License along with this program.
 * If not, see <https://www.gnu.org/licenses/>.
 */

/* global SemanticLocalization, globalRootUrl, moduleUsersUiIndexLdap, UserMessage, Datatable */
var ModuleUsersUIUsersTab = {
  /**
   * Users table.
   * @type {jQuery}
   */
  $usersTable: $('#users-table'),

  /**
   * User data table.
   * @type {Datatable}
   */
  userDataTable: null,

  /**
   * Select group dropdowns.
   * @type {jQuery}
   */
  $selectGroup: $('.select-group'),

  /**
   * User use LDAP table checkboxes.
   * @type {jQuery}
   */
  $userUseLdapTableCheckbox: $('.user-use-ldap-checkbox'),

  /**
   * Body.
   * @type {jQuery}
   */
  $body: $('body'),

  /**
   * Initializes the ModuleUsersUIIndex module.
   */
  initialize: function initialize() {
    ModuleUsersUIUsersTab.initializeDataTable();
    ModuleUsersUIUsersTab.$selectGroup.each(function (index, obj) {
      $(obj).dropdown({
        values: ModuleUsersUIUsersTab.makeDropdownList($(obj).attr('data-value'))
      });
    });
    ModuleUsersUIUsersTab.$selectGroup.dropdown({
      onChange: ModuleUsersUIUsersTab.changeGroupInList
    });
    ModuleUsersUIUsersTab.$userUseLdapTableCheckbox.checkbox({
      onChange: ModuleUsersUIUsersTab.changeLdapInList
    }); // Double click on password or login input field in the table

    ModuleUsersUIUsersTab.$body.on('focusin', '.user-login-input, .user-password-input', function (e) {
      $(e.target).transition('glow');
      $(e.target).closest('div').removeClass('transparent').addClass('changed-field');
      $(e.target).attr('readonly', false);

      if (moduleUsersUiIndexLdap.$useLdapCheckbox.checkbox('is checked') && $(e.target).closest('tr').find('.user-use-ldap-checkbox').checkbox('is checked')) {
        var $inputField = $(e.target);
        $inputField.closest('div').search({
          // change the search endpoint to a custom endpoint by manipulating apiSettings
          apiSettings: {
            url: "".concat(globalRootUrl, "module-users-u-i/ldap-config/search-ldap-user/{query}")
          }
        }); // Handle Enters key press event

        $inputField.on('keydown', function (event) {
          if (event.key === 'Enter') {
            // Prevent default action (if form, prevent submission)
            event.preventDefault();
            var $searchResults = $inputField.closest('div').find('.results .result'); // If there is one result, insert it into the field

            if ($searchResults.length === 1) {
              var result = $searchResults.first().data('result');
              $inputField.val(result.title);
            }
          }
        });
      }
    }); // Submit form on Enter or Tab

    $(document).on('keydown', function (e) {
      var keyCode = e.keyCode || e.which;

      if (keyCode === 13 || keyCode === 9 && !$(':focus').hasClass('.user-login-input') || keyCode === 9 && !$(':focus').hasClass('.user-password-input')) {
        var $el = $('.changed-field').closest('tr');
        $el.each(function (index, obj) {
          var currentRowId = $(obj).attr('id');

          if (currentRowId !== undefined) {
            ModuleUsersUIUsersTab.changeLoginPasswordInList(currentRowId);
          }
        });
      }
    }); // Submit form on focus out from password or login input field

    ModuleUsersUIUsersTab.$body.on('focusout', '.user-login-input, .user-password-input', function (e) {
      var $el = $('.changed-field').closest('tr');
      $el.each(function (index, obj) {
        var currentRowId = $(obj).attr('id');

        if (currentRowId !== undefined) {
          ModuleUsersUIUsersTab.changeLoginPasswordInList(currentRowId);
        }
      });
    });
  },

  /**
   * Initializes the users table DataTable.
   */
  initializeDataTable: function initializeDataTable() {
    $('#main-users-ui-tab-menu .item').tab({
      onVisible: function onVisible() {
        if ($(this).data('tab') === 'users' && ModuleUsersUIUsersTab.userDataTable !== null) {
          var newPageLength = ModuleUsersUIUsersTab.calculatePageLength();
          ModuleUsersUIUsersTab.userDataTable.page.len(newPageLength).draw(false);
        }
      }
    });
    ModuleUsersUIUsersTab.userDataTable = ModuleUsersUIUsersTab.$usersTable.DataTable({
      // destroy: true,
      lengthChange: false,
      paging: true,
      pageLength: ModuleUsersUIUsersTab.calculatePageLength(),
      scrollCollapse: true,
      columns: [// Username
      {
        orderable: true,
        // This column is orderable
        searchable: true // This column is searchable

      }, // Extension
      {
        orderable: true,
        // This column is orderable
        searchable: true // This column is searchable

      }, // Use LDAP
      {
        orderable: false,
        // This column is not orderable
        searchable: false // This column is not searchable

      }, // Login
      {
        orderable: true,
        // This column is orderable
        searchable: true // This column is searchable

      }, // Password
      {
        orderable: false,
        // This column is not orderable
        searchable: false // This column is not searchable

      }, // Access group
      {
        orderable: true,
        // This column is orderable
        searchable: true // This column is searchable

      }],
      order: [0, 'asc'],
      language: SemanticLocalization.dataTableLocalisation
    });
  },

  /**
   * Creates a dropdown list for users.
   * @param {string} selected - The selected value.
   * @returns {Array} - The dropdown list.
   */
  makeDropdownList: function makeDropdownList(selected) {
    var values = [];
    $('#users-groups-list option').each(function (index, obj) {
      var displayText = obj.text.length > 50 ? obj.text.substring(0, 50) + '...' : obj.text;

      if (selected === obj.text || selected === obj.value) {
        values.push({
          name: displayText,
          value: obj.value,
          selected: true
        });
      } else {
        values.push({
          name: displayText,
          value: obj.value
        });
      }
    });
    return values;
  },

  /**
   * Handles the change of group in the list.
   * @param {string} value - The selected value.
   * @param {string} text - The selected text.
   * @param {jQuery} $choice - The dropdown element.
   */
  changeGroupInList: function changeGroupInList(value, text, $choice) {
    var rowId = $($choice).closest('tr').attr('id');
    ModuleUsersUIUsersTab.addProgressIcon(rowId);
    $.api({
      url: "".concat(globalRootUrl, "module-users-u-i/users-credentials/change-user-group"),
      on: 'now',
      method: 'POST',
      data: {
        user_id: rowId,
        group_id: value
      },
      successTest: function successTest(response) {
        // test whether a JSON response is valid
        return response !== undefined && Object.keys(response).length > 0 && response.success === true;
      },
      onSuccess: function onSuccess() {
        ModuleUsersUIUsersTab.removeProgressIcon(rowId);
        $('.ui.message.ajax').remove();
      },
      onError: function onError(response) {
        if (response.message !== undefined) {
          UserMessage.showMultiString(response.message);
        }

        ModuleUsersUIUsersTab.removeProgressIcon(rowId);
      },
      onFailure: function onFailure(response) {
        if (response.message !== undefined) {
          UserMessage.showMultiString(response.message);
        }

        ModuleUsersUIUsersTab.removeProgressIcon(rowId);
      }
    });
  },

  /**
   * Handles the change of LDAP checkbox in the list.
   */
  changeLdapInList: function changeLdapInList() {
    var rowId = $(this).closest('tr').attr('id');
    ModuleUsersUIUsersTab.addProgressIcon(rowId);
    $.api({
      url: "".concat(globalRootUrl, "module-users-u-i/users-credentials/change-user-use-ldap"),
      on: 'now',
      method: 'POST',
      data: {
        user_id: rowId,
        useLdap: $(this).parent('.checkbox').checkbox('is checked')
      },
      successTest: function successTest(response) {
        // test whether a JSON response is valid
        return response !== undefined && Object.keys(response).length > 0 && response.success === true;
      },
      onSuccess: function onSuccess() {
        ModuleUsersUIUsersTab.removeProgressIcon(rowId);

        if ($("tr#".concat(rowId, " .user-use-ldap-checkbox")).checkbox('is checked')) {
          $("tr#".concat(rowId, " td.password")).hide();
          $("tr#".concat(rowId, " td.login")).attr('colspan', 2);
        } else {
          $("tr#".concat(rowId, " td.password")).show();
          $("tr#".concat(rowId, " td.login")).attr('colspan', 1);
        }

        $('.ui.message.ajax').remove();
      },
      onError: function onError(response) {
        if (response.message !== undefined) {
          UserMessage.showMultiString(response.message);
        }

        ModuleUsersUIUsersTab.removeProgressIcon(rowId);
      },
      onFailure: function onFailure(response) {
        if (response.message !== undefined) {
          UserMessage.showMultiString(response.message);
        }

        ModuleUsersUIUsersTab.removeProgressIcon(rowId);
      }
    });
  },

  /**
   * Changes the login and password in the list.
   * @param {string} rowId - The ID of the row.
   */
  changeLoginPasswordInList: function changeLoginPasswordInList(rowId) {
    var login = $("#".concat(rowId, " input.user-login-input")).val();
    var password = $("#".concat(rowId, " input.user-password-input")).val();
    ModuleUsersUIUsersTab.addProgressIcon(rowId);
    $.api({
      url: "".concat(globalRootUrl, "module-users-u-i/users-credentials/change-user-credentials"),
      on: 'now',
      method: 'POST',
      data: {
        user_id: rowId,
        login: login,
        password: password
      },
      successTest: function successTest(response) {
        // test whether a JSON response is valid
        return response !== undefined && Object.keys(response).length > 0 && response.success === true;
      },
      onSuccess: function onSuccess() {
        ModuleUsersUIUsersTab.removeProgressIcon(rowId);
        $("tr#".concat(rowId, " .changed-field input")).attr('readonly', true);
        $("tr#".concat(rowId, " div.changed-field")).removeClass('changed-field loading').addClass('transparent');
        $('.ui.message.ajax').remove();
      },
      onError: function onError(response) {
        if (response.message !== undefined) {
          UserMessage.showMultiString(response.message);
        }

        ModuleUsersUIUsersTab.removeProgressIcon(rowId);
      },
      onFailure: function onFailure(response) {
        if (response.message !== undefined) {
          UserMessage.showMultiString(response.message);
        }

        ModuleUsersUIUsersTab.removeProgressIcon(rowId);
      }
    });
  },

  /**
   * Adds save icon from the row
   */
  addProgressIcon: function addProgressIcon(rowId) {
    $("tr#".concat(rowId, " .changed-field")).find('.ui.spinner.loading.icon').show();
  },

  /**
   * Removes save icon from the row
   */
  removeProgressIcon: function removeProgressIcon(rowId) {
    $("tr#".concat(rowId, " .changed-field")).find('.ui.spinner.loading.icon').hide();
    $("tr#".concat(rowId, " .changed-field")).closest('div').search('hide results').search('destroy');
  },

  /**
   * Calculate data table page length
   *
   * @returns {number}
   */
  calculatePageLength: function calculatePageLength() {
    // Calculate row height
    var rowHeight = ModuleUsersUIUsersTab.$usersTable.find('tr').first().outerHeight(); // Calculate window height and available space for table

    var windowHeight = window.innerHeight;
    var headerFooterHeight = 400; // Estimate height for header, footer, and other elements
    // Calculate new page length

    return Math.max(Math.floor((windowHeight - headerFooterHeight) / rowHeight), 10);
  }
};
$(document).ready(function () {
  ModuleUsersUIUsersTab.initialize();
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9tb2R1bGUtdXNlcnMtdWktaW5kZXgtdXNlcnMuanMiXSwibmFtZXMiOlsiTW9kdWxlVXNlcnNVSVVzZXJzVGFiIiwiJHVzZXJzVGFibGUiLCIkIiwidXNlckRhdGFUYWJsZSIsIiRzZWxlY3RHcm91cCIsIiR1c2VyVXNlTGRhcFRhYmxlQ2hlY2tib3giLCIkYm9keSIsImluaXRpYWxpemUiLCJpbml0aWFsaXplRGF0YVRhYmxlIiwiZWFjaCIsImluZGV4Iiwib2JqIiwiZHJvcGRvd24iLCJ2YWx1ZXMiLCJtYWtlRHJvcGRvd25MaXN0IiwiYXR0ciIsIm9uQ2hhbmdlIiwiY2hhbmdlR3JvdXBJbkxpc3QiLCJjaGVja2JveCIsImNoYW5nZUxkYXBJbkxpc3QiLCJvbiIsImUiLCJ0YXJnZXQiLCJ0cmFuc2l0aW9uIiwiY2xvc2VzdCIsInJlbW92ZUNsYXNzIiwiYWRkQ2xhc3MiLCJtb2R1bGVVc2Vyc1VpSW5kZXhMZGFwIiwiJHVzZUxkYXBDaGVja2JveCIsImZpbmQiLCIkaW5wdXRGaWVsZCIsInNlYXJjaCIsImFwaVNldHRpbmdzIiwidXJsIiwiZ2xvYmFsUm9vdFVybCIsImV2ZW50Iiwia2V5IiwicHJldmVudERlZmF1bHQiLCIkc2VhcmNoUmVzdWx0cyIsImxlbmd0aCIsInJlc3VsdCIsImZpcnN0IiwiZGF0YSIsInZhbCIsInRpdGxlIiwiZG9jdW1lbnQiLCJrZXlDb2RlIiwid2hpY2giLCJoYXNDbGFzcyIsIiRlbCIsImN1cnJlbnRSb3dJZCIsInVuZGVmaW5lZCIsImNoYW5nZUxvZ2luUGFzc3dvcmRJbkxpc3QiLCJ0YWIiLCJvblZpc2libGUiLCJuZXdQYWdlTGVuZ3RoIiwiY2FsY3VsYXRlUGFnZUxlbmd0aCIsInBhZ2UiLCJsZW4iLCJkcmF3IiwiRGF0YVRhYmxlIiwibGVuZ3RoQ2hhbmdlIiwicGFnaW5nIiwicGFnZUxlbmd0aCIsInNjcm9sbENvbGxhcHNlIiwiY29sdW1ucyIsIm9yZGVyYWJsZSIsInNlYXJjaGFibGUiLCJvcmRlciIsImxhbmd1YWdlIiwiU2VtYW50aWNMb2NhbGl6YXRpb24iLCJkYXRhVGFibGVMb2NhbGlzYXRpb24iLCJzZWxlY3RlZCIsImRpc3BsYXlUZXh0IiwidGV4dCIsInN1YnN0cmluZyIsInZhbHVlIiwicHVzaCIsIm5hbWUiLCIkY2hvaWNlIiwicm93SWQiLCJhZGRQcm9ncmVzc0ljb24iLCJhcGkiLCJtZXRob2QiLCJ1c2VyX2lkIiwiZ3JvdXBfaWQiLCJzdWNjZXNzVGVzdCIsInJlc3BvbnNlIiwiT2JqZWN0Iiwia2V5cyIsInN1Y2Nlc3MiLCJvblN1Y2Nlc3MiLCJyZW1vdmVQcm9ncmVzc0ljb24iLCJyZW1vdmUiLCJvbkVycm9yIiwibWVzc2FnZSIsIlVzZXJNZXNzYWdlIiwic2hvd011bHRpU3RyaW5nIiwib25GYWlsdXJlIiwidXNlTGRhcCIsInBhcmVudCIsImhpZGUiLCJzaG93IiwibG9naW4iLCJwYXNzd29yZCIsInJvd0hlaWdodCIsIm91dGVySGVpZ2h0Iiwid2luZG93SGVpZ2h0Iiwid2luZG93IiwiaW5uZXJIZWlnaHQiLCJoZWFkZXJGb290ZXJIZWlnaHQiLCJNYXRoIiwibWF4IiwiZmxvb3IiLCJyZWFkeSJdLCJtYXBwaW5ncyI6Ijs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBRUEsSUFBTUEscUJBQXFCLEdBQUc7QUFFMUI7QUFDSjtBQUNBO0FBQ0E7QUFDSUMsRUFBQUEsV0FBVyxFQUFFQyxDQUFDLENBQUMsY0FBRCxDQU5ZOztBQVExQjtBQUNKO0FBQ0E7QUFDQTtBQUNJQyxFQUFBQSxhQUFhLEVBQUUsSUFaVzs7QUFjMUI7QUFDSjtBQUNBO0FBQ0E7QUFDSUMsRUFBQUEsWUFBWSxFQUFFRixDQUFDLENBQUMsZUFBRCxDQWxCVzs7QUFvQjFCO0FBQ0o7QUFDQTtBQUNBO0FBQ0lHLEVBQUFBLHlCQUF5QixFQUFFSCxDQUFDLENBQUMseUJBQUQsQ0F4QkY7O0FB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QUQsQ0FBRCxDQUFZcUUsS0FBWixDQUFrQixZQUFNO0FBQ3BCbEgsRUFBQUEscUJBQXFCLENBQUNPLFVBQXRCO0FBQ0gsQ0FGRCIsInNvdXJjZXNDb250ZW50IjpbIi8qXG4gKiBNaWtvUEJYIC0gZnJlZSBwaG9uZSBzeXN0ZW0gZm9yIHNtYWxsIGJ1c2luZXNzXG4gKiBDb3B5cmlnaHQgwqkgMjAxNy0yMDIzIEFsZXhleSBQb3J0bm92IGFuZCBOaWtvbGF5IEJla2V0b3ZcbiAqXG4gKiBUaGlzIHByb2dyYW0gaXMgZnJlZSBzb2Z0d2FyZTogeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yIG1vZGlmeVxuICogaXQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBhcyBwdWJsaXNoZWQgYnlcbiAqIHRoZSBGcmVlIFNvZnR3YXJlIEZvdW5kYXRpb247IGVpdGhlciB2ZXJzaW9uIDMgb2YgdGhlIExpY2Vuc2UsIG9yXG4gKiAoYXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2ZXJzaW9uLlxuICpcbiAqIFRoaXMgcHJvZ3JhbSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLFxuICogYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2ZcbiAqIE1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gIFNlZSB0aGVcbiAqIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuXG4gKlxuICogWW91IHNob3VsZCBoYXZlIHJlY2VpdmVkIGEgY29weSBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYWxvbmcgd2l0aCB0aGlzIHByb2dyYW0uXG4gKiBJZiBub3QsIHNlZSA8aHR0cHM6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy8+LlxuICovXG5cbi8qIGdsb2JhbCBTZW1hbnRpY0xvY2FsaXphdGlvbiwgZ2xvYmFsUm9vdFVybCwgbW9kdWxlVXNlcnNVaUluZGV4TGRhcCwgVXNlck1lc3NhZ2UsIERhdGF0YWJsZSAqL1xuXG5jb25zdCBNb2R1bGVVc2Vyc1VJVXNlcnNUYWIgPSB7XG5cbiAgICAvKipcbiAgICAgKiBVc2VycyB0YWJsZS5cbiAgICAgKiBAdHlwZSB7alF1ZXJ5fVxuICAgICAqL1xuICAgICR1c2Vyc1RhYmxlOiAkKCcjdXNlcnMtdGFibGUnKSxcblxuICAgIC8qKlxuICAgICAqIFVzZXIgZGF0YSB0YWJsZS5cbiAgICAgKiBAdHlwZSB7RGF0YXRhYmxlfVxuICAgICAqL1xuICAgIHVzZXJEYXRhVGFibGU6IG51bGwsXG5cbiAgICAvKipcbiAgICAgKiBTZWxlY3QgZ3JvdXAgZHJvcGRvd25zLlxuICAgICAqIEB0eXBlIHtqUXVlcnl9XG4gICAgICovXG4gICAgJHNlbGVjdEdyb3VwOiAkKCcuc2VsZWN0LWdyb3VwJyksXG5cbiAgICAvKipcbiAgICAgKiBVc2VyIHVzZSBMREFQIHRhYmxlIGNoZWNrYm94ZXMuXG4gICAgICogQHR5cGUge2pRdWVyeX1cbiAgICAgKi9cbiAgICAkdXNlclVzZUxkYXBUYWJsZUNoZWNrYm94OiAkKCcudXNlci11c2UtbGRhcC1jaGVja2JveCcpLFxuXG4gICAgLyoqXG4gICAgICogQm9keS5cbiAgICAgKiBAdHlwZSB7alF1ZXJ5fVxuICAgICAqL1xuICAgICRib2R5OiAkKCdib2R5JyksXG5cbiAgICAvKipcbiAgICAgKiBJbml0aWFsaXplcyB0aGUgTW9kdWxlVXNlcnNVSUluZGV4IG1vZHVsZS5cbiAgICAgKi9cbiAgICBpbml0aWFsaXplKCkge1xuXG4gICAgICAgIE1vZHVsZVVzZXJzVUlVc2Vyc1RhYi5pbml0aWFsaXplRGF0YVRhYmxlKCk7XG5cbiAgICAgICAgTW9kdWxlVXNlcnNVSVVzZXJzVGFiLiRzZWxlY3RHcm91cC5lYWNoKChpbmRleCwgb2JqKSA9PiB7XG4gICAgICAgICAgICAkKG9iaikuZHJvcGRvd24oe1xuICAgICAgICAgICAgICAgIHZhbHVlczogTW9kdWxlVXNlcnNVSVVzZXJzVGFiLm1ha2VEcm9wZG93bkxpc3QoJChvYmopLmF0dHIoJ2RhdGEtdmFsdWUnKSksXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICAgIE1vZHVsZVVzZXJzVUlVc2Vyc1RhYi4kc2VsZWN0R3JvdXAuZHJvcGRvd24oe1xuICAgICAgICAgICAgb25DaGFuZ2U6IE1vZHVsZVVzZXJzVUlVc2Vyc1RhYi5jaGFuZ2VHcm91cEluTGlzdCxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgTW9kdWxlVXNlcnNVSVVzZXJzVGFiLiR1c2VyVXNlTGRhcFRhYmxlQ2hlY2tib3guY2hlY2tib3goe1xuICAgICAgICAgICAgb25DaGFuZ2U6IE1vZHVsZVVzZXJzVUlVc2Vyc1RhYi5jaGFuZ2VMZGFwSW5MaXN0LFxuICAgICAgICB9KTtcblxuICAgICAgICAvLyBEb3VibGUgY2xpY2sgb24gcGFzc3dvcmQgb3IgbG9naW4gaW5wdXQgZmllbGQgaW4gdGhlIHRhYmxlXG4gICAgICAgIE1vZHVsZVVzZXJzVUlVc2Vyc1RhYi4kYm9keS5vbignZm9jdXNpbicsICcudXNlci1sb2dpbi1pbnB1dCwgLnVzZXItcGFzc3dvcmQtaW5wdXQnLCAoZSkgPT4ge1xuICAgICAgICAgICAgJChlLnRhcmdldCkudHJhbnNpdGlvbignZ2xvdycpO1xuXG4gICAgICAgICAgICAkKGUudGFyZ2V0KS5jbG9zZXN0KCdkaXYnKVxuICAgICAgICAgICAgICAgIC5yZW1vdmVDbGFzcygndHJhbnNwYXJlbnQnKVxuICAgICAgICAgICAgICAgIC5hZGRDbGFzcygnY2hhbmdlZC1maWVsZCcpO1xuICAgICAgICAgICAgJChlLnRhcmdldCkuYXR0cigncmVhZG9ubHknLCBmYWxzZSk7XG5cbiAgICAgICAgICAgIGlmIChtb2R1bGVVc2Vyc1VpSW5kZXhMZGFwLiR1c2VMZGFwQ2hlY2tib3guY2hlY2tib3goJ2lzIGNoZWNrZWQnKVxuICAgICAgICAgICAgICAgICYmICQoZS50YXJnZXQpLmNsb3Nlc3QoJ3RyJykuZmluZCgnLnVzZXItdXNlLWxkYXAtY2hlY2tib3gnKS5jaGVja2JveCgnaXMgY2hlY2tlZCcpKXtcblxuICAgICAgICAgICAgICAgIGNvbnN0ICRpbnB1dEZpZWxkID0gJChlLnRhcmdldCk7XG4gICAgICAgICAgICAgICAgJGlucHV0RmllbGQuY2xvc2VzdCgnZGl2Jykuc2VhcmNoKHtcbiAgICAgICAgICAgICAgICAgICAgLy8gY2hhbmdlIHRoZSBzZWFyY2ggZW5kcG9pbnQgdG8gYSBjdXN0b20gZW5kcG9pbnQgYnkgbWFuaXB1bGF0aW5nIGFwaVNldHRpbmdzXG4gICAgICAgICAgICAgICAgICAgIGFwaVNldHRpbmdzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB1cmw6IGAke2dsb2JhbFJvb3RVcmx9bW9kdWxlLXVzZXJzLXUtaS9sZGFwLWNvbmZpZy9zZWFyY2gtbGRhcC11c2VyL3txdWVyeX1gXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgLy8gSGFuZGxlIEVudGVycyBrZXkgcHJlc3MgZXZlbnRcbiAgICAgICAgICAgICAgICAkaW5wdXRGaWVsZC5vbigna2V5ZG93bicsIGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChldmVudC5rZXkgPT09ICdFbnRlcicpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFByZXZlbnQgZGVmYXVsdCBhY3Rpb24gKGlmIGZvcm0sIHByZXZlbnQgc3VibWlzc2lvbilcbiAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCAkc2VhcmNoUmVzdWx0cyA9ICRpbnB1dEZpZWxkLmNsb3Nlc3QoJ2RpdicpLmZpbmQoJy5yZXN1bHRzIC5yZXN1bHQnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIElmIHRoZXJlIGlzIG9uZSByZXN1bHQsIGluc2VydCBpdCBpbnRvIHRoZSBmaWVsZFxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRzZWFyY2hSZXN1bHRzLmxlbmd0aCA9PT0gMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9ICRzZWFyY2hSZXN1bHRzLmZpcnN0KCkuZGF0YSgncmVzdWx0Jyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJGlucHV0RmllbGQudmFsKHJlc3VsdC50aXRsZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICB9KTtcblxuICAgICAgICAvLyBTdWJtaXQgZm9ybSBvbiBFbnRlciBvciBUYWJcbiAgICAgICAgJChkb2N1bWVudCkub24oJ2tleWRvd24nLCAoZSkgPT4ge1xuICAgICAgICAgICAgY29uc3Qga2V5Q29kZSA9IGUua2V5Q29kZSB8fCBlLndoaWNoO1xuICAgICAgICAgICAgaWYgKGtleUNvZGUgPT09IDEzXG4gICAgICAgICAgICAgICAgfHwgKGtleUNvZGUgPT09IDkgJiYgISQoJzpmb2N1cycpLmhhc0NsYXNzKCcudXNlci1sb2dpbi1pbnB1dCcpKVxuICAgICAgICAgICAgICAgIHx8IChrZXlDb2RlID09PSA5ICYmICEkKCc6Zm9jdXMnKS5oYXNDbGFzcygnLnVzZXItcGFzc3dvcmQtaW5wdXQnKSlcbiAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICAgIGNvbnN0ICRlbCA9ICQoJy5jaGFuZ2VkLWZpZWxkJykuY2xvc2VzdCgndHInKTtcbiAgICAgICAgICAgICAgICAkZWwuZWFjaCgoaW5kZXgsIG9iaikgPT4ge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBjdXJyZW50Um93SWQgPSAkKG9iaikuYXR0cignaWQnKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRSb3dJZCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBNb2R1bGVVc2Vyc1VJVXNlcnNUYWIuY2hhbmdlTG9naW5QYXNzd29yZEluTGlzdChjdXJyZW50Um93SWQpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIFN1Ym1pdCBmb3JtIG9uIGZvY3VzIG91dCBmcm9tIHBhc3N3b3JkIG9yIGxvZ2luIGlucHV0IGZpZWxkXG4gICAgICAgIE1vZHVsZVVzZXJzVUlVc2Vyc1RhYi4kYm9keS5vbignZm9jdXNvdXQnLCAnLnVzZXItbG9naW4taW5wdXQsIC51c2VyLXBhc3N3b3JkLWlucHV0JywgKGUpID0+IHtcbiAgICAgICAgICAgIGNvbnN0ICRlbCA9ICQoJy5jaGFuZ2VkLWZpZWxkJykuY2xvc2VzdCgndHInKTtcbiAgICAgICAgICAgICRlbC5lYWNoKChpbmRleCwgb2JqKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgY3VycmVudFJvd0lkID0gJChvYmopLmF0dHIoJ2lkJyk7XG4gICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRSb3dJZCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIE1vZHVsZVVzZXJzVUlVc2Vyc1RhYi5jaGFuZ2VMb2dpblBhc3N3b3JkSW5MaXN0KGN1cnJlbnRSb3dJZCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuXG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEluaXRpYWxpemVzIHRoZSB1c2VycyB0YWJsZSBEYXRhVGFibGUuXG4gICAgICovXG4gICAgaW5pdGlhbGl6ZURhdGFUYWJsZSgpIHtcblxuICAgICAgICAkKCcjbWFpbi11c2Vycy11aS10YWItbWVudSAuaXRlbScpLnRhYih7XG4gICAgICAgICAgICBvblZpc2libGUoKXtcbiAgICAgICAgICAgICAgICBpZiAoJCh0aGlzKS5kYXRhKCd0YWInKT09PSd1c2VycycgJiYgTW9kdWxlVXNlcnNVSVVzZXJzVGFiLnVzZXJEYXRhVGFibGUhPT1udWxsKXtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgbmV3UGFnZUxlbmd0aCA9IE1vZHVsZVVzZXJzVUlVc2Vyc1RhYi5jYWxjdWxhdGVQYWdlTGVuZ3RoKCk7XG4gICAgICAgICAgICAgICAgICAgIE1vZHVsZVVzZXJzVUlVc2Vyc1RhYi51c2VyRGF0YVRhYmxlLnBhZ2UubGVuKG5ld1BhZ2VMZW5ndGgpLmRyYXcoZmFsc2UpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgTW9kdWxlVXNlcnNVSVVzZXJzVGFiLnVzZXJEYXRhVGFibGUgPSBNb2R1bGVVc2Vyc1VJVXNlcnNUYWIuJHVzZXJzVGFibGUuRGF0YVRhYmxlKHtcbiAgICAgICAgICAgIC8vIGRlc3Ryb3k6IHRydWUsXG4gICAgICAgICAgICBsZW5ndGhDaGFuZ2U6IGZhbHNlLFxuICAgICAgICAgICAgcGFnaW5nOiB0cnVlLFxuICAgICAgICAgICAgcGFnZUxlbmd0aDogTW9kdWxlVXNlcnNVSVVzZXJzVGFiLmNhbGN1bGF0ZVBhZ2VMZW5ndGgoKSxcbiAgICAgICAgICAgIHNjcm9sbENvbGxhcHNlOiB0cnVlLFxuICAgICAgICAgICAgY29sdW1uczogW1xuICAgICAgICAgICAgICAgIC8vIFVzZXJuYW1lXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBvcmRlcmFibGU6IHRydWUsICAvLyBUaGlzIGNvbHVtbiBpcyBvcmRlcmFibGVcbiAgICAgICAgICAgICAgICAgICAgc2VhcmNoYWJsZTogdHJ1ZSAgLy8gVGhpcyBjb2x1bW4gaXMgc2VhcmNoYWJsZVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgLy8gRXh0ZW5zaW9uXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBvcmRlcmFibGU6IHRydWUsICAvLyBUaGlzIGNvbHVtbiBpcyBvcmRlcmFibGVcbiAgICAgICAgICAgICAgICAgICAgc2VhcmNoYWJsZTogdHJ1ZSAgLy8gVGhpcyBjb2x1bW4gaXMgc2VhcmNoYWJsZVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgLy8gVXNlIExEQVBcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIG9yZGVyYWJsZTogZmFsc2UsICAvLyBUaGlzIGNvbHVtbiBpcyBub3Qgb3JkZXJhYmxlXG4gICAgICAgICAgICAgICAgICAgIHNlYXJjaGFibGU6IGZhbHNlICAvLyBUaGlzIGNvbHVtbiBpcyBub3Qgc2VhcmNoYWJsZVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgLy8gTG9naW5cbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIG9yZGVyYWJsZTogdHJ1ZSwgIC8vIFRoaXMgY29sdW1uIGlzIG9yZGVyYWJsZVxuICAgICAgICAgICAgICAgICAgICBzZWFyY2hhYmxlOiB0cnVlICAvLyBUaGlzIGNvbHVtbiBpcyBzZWFyY2hhYmxlXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAvLyBQYXNzd29yZFxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgb3JkZXJhYmxlOiBmYWxzZSwgIC8vIFRoaXMgY29sdW1uIGlzIG5vdCBvcmRlcmFibGVcbiAgICAgICAgICAgICAgICAgICAgc2VhcmNoYWJsZTogZmFsc2UgIC8vIFRoaXMgY29sdW1uIGlzIG5vdCBzZWFyY2hhYmxlXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAvLyBBY2Nlc3MgZ3JvdXBcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIG9yZGVyYWJsZTogdHJ1ZSwgIC8vIFRoaXMgY29sdW1uIGlzIG9yZGVyYWJsZVxuICAgICAgICAgICAgICAgICAgICBzZWFyY2hhYmxlOiB0cnVlICAvLyBUaGlzIGNvbHVtbiBpcyBzZWFyY2hhYmxlXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF0sXG4gICAgICAgICAgICBvcmRlcjogWzAsICdhc2MnXSxcbiAgICAgICAgICAgIGxhbmd1YWdlOiBTZW1hbnRpY0xvY2FsaXphdGlvbi5kYXRhVGFibGVMb2NhbGlzYXRpb24sXG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGEgZHJvcGRvd24gbGlzdCBmb3IgdXNlcnMuXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IHNlbGVjdGVkIC0gVGhlIHNlbGVjdGVkIHZhbHVlLlxuICAgICAqIEByZXR1cm5zIHtBcnJheX0gLSBUaGUgZHJvcGRvd24gbGlzdC5cbiAgICAgKi9cbiAgICBtYWtlRHJvcGRvd25MaXN0KHNlbGVjdGVkKSB7XG4gICAgICAgIGNvbnN0IHZhbHVlcyA9IFtdO1xuICAgICAgICAkKCcjdXNlcnMtZ3JvdXBzLWxpc3Qgb3B0aW9uJykuZWFjaCgoaW5kZXgsIG9iaikgPT4ge1xuICAgICAgICAgICAgY29uc3QgZGlzcGxheVRleHQgPSBvYmoudGV4dC5sZW5ndGggPiA1MCA/IG9iai50ZXh0LnN1YnN0cmluZygwLCA1MCkgKyAnLi4uJyA6IG9iai50ZXh0O1xuICAgICAgICAgICAgaWYgKHNlbGVjdGVkID09PSBvYmoudGV4dCB8fCBzZWxlY3RlZCA9PT0gb2JqLnZhbHVlKSB7XG4gICAgICAgICAgICAgICAgdmFsdWVzLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICBuYW1lOiBkaXNwbGF5VGV4dCxcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IG9iai52YWx1ZSxcbiAgICAgICAgICAgICAgICAgICAgc2VsZWN0ZWQ6IHRydWUsXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHZhbHVlcy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgbmFtZTogZGlzcGxheVRleHQsXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlOiBvYmoudmFsdWUsXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gdmFsdWVzO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBIYW5kbGVzIHRoZSBjaGFuZ2Ugb2YgZ3JvdXAgaW4gdGhlIGxpc3QuXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IHZhbHVlIC0gVGhlIHNlbGVjdGVkIHZhbHVlLlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSB0ZXh0IC0gVGhlIHNlbGVjdGVkIHRleHQuXG4gICAgICogQHBhcmFtIHtqUXVlcnl9ICRjaG9pY2UgLSBUaGUgZHJvcGRvd24gZWxlbWVudC5cbiAgICAgKi9cbiAgICBjaGFuZ2VHcm91cEluTGlzdCh2YWx1ZSwgdGV4dCwgJGNob2ljZSkge1xuICAgICAgICBjb25zdCByb3dJZCA9ICQoJGNob2ljZSkuY2xvc2VzdCgndHInKS5hdHRyKCdpZCcpO1xuICAgICAgICBNb2R1bGVVc2Vyc1VJVXNlcnNUYWIuYWRkUHJvZ3Jlc3NJY29uKHJvd0lkKTtcbiAgICAgICAgJC5hcGkoe1xuICAgICAgICAgICAgdXJsOiBgJHtnbG9iYWxSb290VXJsfW1vZHVsZS11c2Vycy11LWkvdXNlcnMtY3JlZGVudGlhbHMvY2hhbmdlLXVzZXItZ3JvdXBgLFxuICAgICAgICAgICAgb246ICdub3cnLFxuICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgdXNlcl9pZDogcm93SWQsXG4gICAgICAgICAgICAgICAgZ3JvdXBfaWQ6IHZhbHVlLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHN1Y2Nlc3NUZXN0KHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgLy8gdGVzdCB3aGV0aGVyIGEgSlNPTiByZXNwb25zZSBpcyB2YWxpZFxuICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZSAhPT0gdW5kZWZpbmVkXG4gICAgICAgICAgICAgICAgICAgICYmIE9iamVjdC5rZXlzKHJlc3BvbnNlKS5sZW5ndGggPiAwXG4gICAgICAgICAgICAgICAgICAgICYmIHJlc3BvbnNlLnN1Y2Nlc3MgPT09IHRydWU7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgb25TdWNjZXNzKCkge1xuICAgICAgICAgICAgICAgIE1vZHVsZVVzZXJzVUlVc2Vyc1RhYi5yZW1vdmVQcm9ncmVzc0ljb24ocm93SWQpO1xuICAgICAgICAgICAgICAgICQoJy51aS5tZXNzYWdlLmFqYXgnKS5yZW1vdmUoKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBvbkVycm9yKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLm1lc3NhZ2UgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICBVc2VyTWVzc2FnZS5zaG93TXVsdGlTdHJpbmcocmVzcG9uc2UubWVzc2FnZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIE1vZHVsZVVzZXJzVUlVc2Vyc1RhYi5yZW1vdmVQcm9ncmVzc0ljb24ocm93SWQpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG9uRmFpbHVyZShyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5tZXNzYWdlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgVXNlck1lc3NhZ2Uuc2hvd011bHRpU3RyaW5nKHJlc3BvbnNlLm1lc3NhZ2UpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBNb2R1bGVVc2Vyc1VJVXNlcnNUYWIucmVtb3ZlUHJvZ3Jlc3NJY29uKHJvd0lkKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBIYW5kbGVzIHRoZSBjaGFuZ2Ugb2YgTERBUCBjaGVja2JveCBpbiB0aGUgbGlzdC5cbiAgICAgKi9cbiAgICBjaGFuZ2VMZGFwSW5MaXN0KCkge1xuICAgICAgICBjb25zdCByb3dJZCA9ICQodGhpcykuY2xvc2VzdCgndHInKS5hdHRyKCdpZCcpO1xuICAgICAgICBNb2R1bGVVc2Vyc1VJVXNlcnNUYWIuYWRkUHJvZ3Jlc3NJY29uKHJvd0lkKTtcbiAgICAgICAgJC5hcGkoe1xuICAgICAgICAgICAgdXJsOiBgJHtnbG9iYWxSb290VXJsfW1vZHVsZS11c2Vycy11LWkvdXNlcnMtY3JlZGVudGlhbHMvY2hhbmdlLXVzZXItdXNlLWxkYXBgLFxuICAgICAgICAgICAgb246ICdub3cnLFxuICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgdXNlcl9pZDogcm93SWQsXG4gICAgICAgICAgICAgICAgdXNlTGRhcDogJCh0aGlzKS5wYXJlbnQoJy5jaGVja2JveCcpLmNoZWNrYm94KCdpcyBjaGVja2VkJyksXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc3VjY2Vzc1Rlc3QocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAvLyB0ZXN0IHdoZXRoZXIgYSBKU09OIHJlc3BvbnNlIGlzIHZhbGlkXG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlICE9PSB1bmRlZmluZWRcbiAgICAgICAgICAgICAgICAgICAgJiYgT2JqZWN0LmtleXMocmVzcG9uc2UpLmxlbmd0aCA+IDBcbiAgICAgICAgICAgICAgICAgICAgJiYgcmVzcG9uc2Uuc3VjY2VzcyA9PT0gdHJ1ZTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBvblN1Y2Nlc3MoKSB7XG4gICAgICAgICAgICAgICAgTW9kdWxlVXNlcnNVSVVzZXJzVGFiLnJlbW92ZVByb2dyZXNzSWNvbihyb3dJZCk7XG4gICAgICAgICAgICAgICAgaWYgKCQoYHRyIyR7cm93SWR9IC51c2VyLXVzZS1sZGFwLWNoZWNrYm94YCkuY2hlY2tib3goJ2lzIGNoZWNrZWQnKSl7XG4gICAgICAgICAgICAgICAgICAgICQoYHRyIyR7cm93SWR9IHRkLnBhc3N3b3JkYCkuaGlkZSgpO1xuICAgICAgICAgICAgICAgICAgICAkKGB0ciMke3Jvd0lkfSB0ZC5sb2dpbmApLmF0dHIoJ2NvbHNwYW4nLDIpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICQoYHRyIyR7cm93SWR9IHRkLnBhc3N3b3JkYCkuc2hvdygpO1xuICAgICAgICAgICAgICAgICAgICAkKGB0ciMke3Jvd0lkfSB0ZC5sb2dpbmApLmF0dHIoJ2NvbHNwYW4nLDEpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAkKCcudWkubWVzc2FnZS5hamF4JykucmVtb3ZlKCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgb25FcnJvcihyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5tZXNzYWdlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgVXNlck1lc3NhZ2Uuc2hvd011bHRpU3RyaW5nKHJlc3BvbnNlLm1lc3NhZ2UpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBNb2R1bGVVc2Vyc1VJVXNlcnNUYWIucmVtb3ZlUHJvZ3Jlc3NJY29uKHJvd0lkKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBvbkZhaWx1cmUocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UubWVzc2FnZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIFVzZXJNZXNzYWdlLnNob3dNdWx0aVN0cmluZyhyZXNwb25zZS5tZXNzYWdlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgTW9kdWxlVXNlcnNVSVVzZXJzVGFiLnJlbW92ZVByb2dyZXNzSWNvbihyb3dJZCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogQ2hhbmdlcyB0aGUgbG9naW4gYW5kIHBhc3N3b3JkIGluIHRoZSBsaXN0LlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSByb3dJZCAtIFRoZSBJRCBvZiB0aGUgcm93LlxuICAgICAqL1xuICAgIGNoYW5nZUxvZ2luUGFzc3dvcmRJbkxpc3Qocm93SWQpIHtcbiAgICAgICAgY29uc3QgbG9naW4gPSAkKGAjJHtyb3dJZH0gaW5wdXQudXNlci1sb2dpbi1pbnB1dGApLnZhbCgpO1xuICAgICAgICBjb25zdCBwYXNzd29yZCA9ICQoYCMke3Jvd0lkfSBpbnB1dC51c2VyLXBhc3N3b3JkLWlucHV0YCkudmFsKCk7XG5cbiAgICAgICAgTW9kdWxlVXNlcnNVSVVzZXJzVGFiLmFkZFByb2dyZXNzSWNvbihyb3dJZCk7XG5cbiAgICAgICAgJC5hcGkoe1xuICAgICAgICAgICAgdXJsOiBgJHtnbG9iYWxSb290VXJsfW1vZHVsZS11c2Vycy11LWkvdXNlcnMtY3JlZGVudGlhbHMvY2hhbmdlLXVzZXItY3JlZGVudGlhbHNgLFxuICAgICAgICAgICAgb246ICdub3cnLFxuICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgdXNlcl9pZDogcm93SWQsXG4gICAgICAgICAgICAgICAgbG9naW46IGxvZ2luLFxuICAgICAgICAgICAgICAgIHBhc3N3b3JkOiBwYXNzd29yZCxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzdWNjZXNzVGVzdChyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgIC8vIHRlc3Qgd2hldGhlciBhIEpTT04gcmVzcG9uc2UgaXMgdmFsaWRcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UgIT09IHVuZGVmaW5lZFxuICAgICAgICAgICAgICAgICAgICAmJiBPYmplY3Qua2V5cyhyZXNwb25zZSkubGVuZ3RoID4gMFxuICAgICAgICAgICAgICAgICAgICAmJiByZXNwb25zZS5zdWNjZXNzID09PSB0cnVlO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG9uU3VjY2VzcygpIHtcbiAgICAgICAgICAgICAgICBNb2R1bGVVc2Vyc1VJVXNlcnNUYWIucmVtb3ZlUHJvZ3Jlc3NJY29uKHJvd0lkKTtcbiAgICAgICAgICAgICAgICAkKGB0ciMke3Jvd0lkfSAuY2hhbmdlZC1maWVsZCBpbnB1dGApLmF0dHIoJ3JlYWRvbmx5JywgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgJChgdHIjJHtyb3dJZH0gZGl2LmNoYW5nZWQtZmllbGRgKS5yZW1vdmVDbGFzcygnY2hhbmdlZC1maWVsZCBsb2FkaW5nJykuYWRkQ2xhc3MoJ3RyYW5zcGFyZW50Jyk7XG4gICAgICAgICAgICAgICAgJCgnLnVpLm1lc3NhZ2UuYWpheCcpLnJlbW92ZSgpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG9uRXJyb3IocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UubWVzc2FnZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIFVzZXJNZXNzYWdlLnNob3dNdWx0aVN0cmluZyhyZXNwb25zZS5tZXNzYWdlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgTW9kdWxlVXNlcnNVSVVzZXJzVGFiLnJlbW92ZVByb2dyZXNzSWNvbihyb3dJZCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgb25GYWlsdXJlKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLm1lc3NhZ2UgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICBVc2VyTWVzc2FnZS5zaG93TXVsdGlTdHJpbmcocmVzcG9uc2UubWVzc2FnZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIE1vZHVsZVVzZXJzVUlVc2Vyc1RhYi5yZW1vdmVQcm9ncmVzc0ljb24ocm93SWQpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSk7XG4gICAgfSxcbiAgICAvKipcbiAgICAgKiBBZGRzIHNhdmUgaWNvbiBmcm9tIHRoZSByb3dcbiAgICAgKi9cbiAgICBhZGRQcm9ncmVzc0ljb24ocm93SWQpe1xuICAgICAgICAkKGB0ciMke3Jvd0lkfSAuY2hhbmdlZC1maWVsZGApLmZpbmQoJy51aS5zcGlubmVyLmxvYWRpbmcuaWNvbicpLnNob3coKTtcbiAgICB9LFxuICAgIC8qKlxuICAgICAqIFJlbW92ZXMgc2F2ZSBpY29uIGZyb20gdGhlIHJvd1xuICAgICAqL1xuICAgIHJlbW92ZVByb2dyZXNzSWNvbihyb3dJZCkge1xuICAgICAgICAkKGB0ciMke3Jvd0lkfSAuY2hhbmdlZC1maWVsZGApLmZpbmQoJy51aS5zcGlubmVyLmxvYWRpbmcuaWNvbicpLmhpZGUoKTtcbiAgICAgICAgJChgdHIjJHtyb3dJZH0gLmNoYW5nZWQtZmllbGRgKS5jbG9zZXN0KCdkaXYnKS5zZWFyY2goJ2hpZGUgcmVzdWx0cycpLnNlYXJjaCgnZGVzdHJveScpO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBDYWxjdWxhdGUgZGF0YSB0YWJsZSBwYWdlIGxlbmd0aFxuICAgICAqXG4gICAgICogQHJldHVybnMge251bWJlcn1cbiAgICAgKi9cbiAgICBjYWxjdWxhdGVQYWdlTGVuZ3RoKCkge1xuICAgICAgICAvLyBDYWxjdWxhdGUgcm93IGhlaWdodFxuICAgICAgICBsZXQgcm93SGVpZ2h0ID0gTW9kdWxlVXNlcnNVSVVzZXJzVGFiLiR1c2Vyc1RhYmxlLmZpbmQoJ3RyJykuZmlyc3QoKS5vdXRlckhlaWdodCgpO1xuICAgICAgICAvLyBDYWxjdWxhdGUgd2luZG93IGhlaWdodCBhbmQgYXZhaWxhYmxlIHNwYWNlIGZvciB0YWJsZVxuICAgICAgICBjb25zdCB3aW5kb3dIZWlnaHQgPSB3aW5kb3cuaW5uZXJIZWlnaHQ7XG4gICAgICAgIGNvbnN0IGhlYWRlckZvb3RlckhlaWdodCA9IDQwMDsgLy8gRXN0aW1hdGUgaGVpZ2h0IGZvciBoZWFkZXIsIGZvb3RlciwgYW5kIG90aGVyIGVsZW1lbnRzXG5cbiAgICAgICAgLy8gQ2FsY3VsYXRlIG5ldyBwYWdlIGxlbmd0aFxuICAgICAgICByZXR1cm4gTWF0aC5tYXgoTWF0aC5mbG9vcigod2luZG93SGVpZ2h0IC0gaGVhZGVyRm9vdGVySGVpZ2h0KSAvIHJvd0hlaWdodCksIDEwKTtcbiAgICB9LFxufTtcblxuJChkb2N1bWVudCkucmVhZHkoKCkgPT4ge1xuICAgIE1vZHVsZVVzZXJzVUlVc2Vyc1RhYi5pbml0aWFsaXplKCk7XG59KTtcblxuIl19