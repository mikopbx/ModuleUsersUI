"use strict";

/*
 * MikoPBX - free phone system for small business
 * Copyright Â© 2017-2023 Alexey Portnov and Nikolay Beketov
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation; either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License along with this program.
 * If not, see <https://www.gnu.org/licenses/>.
 */

/* global SemanticLocalization, globalRootUrl, moduleUsersUiIndexLdap, UserMessage */
var ModuleUsersUIUsersTab = {
  /**
   * Users table.
   * @type {jQuery}
   */
  $usersTable: $('#users-table'),

  /**
   * Select group dropdowns.
   * @type {jQuery}
   */
  $selectGroup: $('.select-group'),

  /**
   * User use LDAP table checkboxes.
   * @type {jQuery}
   */
  $userUseLdapTableCheckbox: $('.user-use-ldap-checkbox'),

  /**
   * Body.
   * @type {jQuery}
   */
  $body: $('body'),

  /**
   * Initializes the ModuleUsersUIIndex module.
   */
  initialize: function initialize() {
    ModuleUsersUIUsersTab.initializeDataTable();
    ModuleUsersUIUsersTab.$selectGroup.each(function (index, obj) {
      $(obj).dropdown({
        values: ModuleUsersUIUsersTab.makeDropdownList($(obj).attr('data-value'))
      });
    });
    ModuleUsersUIUsersTab.$selectGroup.dropdown({
      onChange: ModuleUsersUIUsersTab.changeGroupInList
    });
    ModuleUsersUIUsersTab.$userUseLdapTableCheckbox.checkbox({
      onChange: ModuleUsersUIUsersTab.changeLdapInList
    }); // Double click on password or login input field in the table

    ModuleUsersUIUsersTab.$body.on('focusin', '.user-login-input, .user-password-input', function (e) {
      $(e.target).transition('glow');
      $(e.target).closest('div').removeClass('transparent').addClass('changed-field');
      $(e.target).attr('readonly', false);

      if (moduleUsersUiIndexLdap.$useLdapCheckbox.checkbox('is checked') && $(e.target).closest('tr').find('.user-use-ldap-checkbox').checkbox('is checked')) {
        $(e.target).closest('div').search({
          // change search endpoint to a custom endpoint by manipulating apiSettings
          apiSettings: {
            url: "".concat(globalRootUrl, "module-users-u-i/ldap-config/search-ldap-user/{query}")
          }
        });
      }
    }); // Submit form on Enter or Tab

    $(document).on('keydown', function (e) {
      var keyCode = e.keyCode || e.which;

      if (keyCode === 13 || keyCode === 9 && !$(':focus').hasClass('.user-login-input') || keyCode === 9 && !$(':focus').hasClass('.user-password-input')) {
        var $el = $('.changed-field').closest('tr');
        $el.each(function (index, obj) {
          var currentRowId = $(obj).attr('id');

          if (currentRowId !== undefined) {
            ModuleUsersUIUsersTab.changeLoginPasswordInList(currentRowId);
          }
        });
      }
    }); // Submit form on focus out from password or login input field

    ModuleUsersUIUsersTab.$body.on('focusout', '.user-login-input, .user-password-input', function (e) {
      var $el = $('.changed-field').closest('tr');
      $el.each(function (index, obj) {
        var currentRowId = $(obj).attr('id');

        if (currentRowId !== undefined) {
          ModuleUsersUIUsersTab.changeLoginPasswordInList(currentRowId);
        }
      });
    });
  },

  /**
   * Initializes the users table DataTable.
   */
  initializeDataTable: function initializeDataTable() {
    ModuleUsersUIUsersTab.$usersTable.DataTable({
      // destroy: true,
      lengthChange: false,
      paging: false,
      columns: [// Username
      {
        orderable: true,
        // This column is orderable
        searchable: true // This column is searchable

      }, // Extension
      {
        orderable: true,
        // This column is orderable
        searchable: true // This column is searchable

      }, // Use LDAP
      {
        orderable: false,
        // This column is not orderable
        searchable: false // This column is not searchable

      }, // Login
      {
        orderable: true,
        // This column is orderable
        searchable: true // This column is searchable

      }, // Password
      {
        orderable: false,
        // This column is not orderable
        searchable: false // This column is not searchable

      }, // Access group
      {
        orderable: true,
        // This column is orderable
        searchable: true // This column is searchable

      }],
      order: [0, 'asc'],
      language: SemanticLocalization.dataTableLocalisation
    });
  },

  /**
   * Creates a dropdown list for users.
   * @param {string} selected - The selected value.
   * @returns {Array} - The dropdown list.
   */
  makeDropdownList: function makeDropdownList(selected) {
    var values = [];
    $('#users-groups-list option').each(function (index, obj) {
      if (selected === obj.text || selected === obj.value) {
        values.push({
          name: obj.text,
          value: obj.value,
          selected: true
        });
      } else {
        values.push({
          name: obj.text,
          value: obj.value
        });
      }
    });
    return values;
  },

  /**
   * Handles the change of group in the list.
   * @param {string} value - The selected value.
   * @param {string} text - The selected text.
   * @param {jQuery} $choice - The dropdown element.
   */
  changeGroupInList: function changeGroupInList(value, text, $choice) {
    var rowId = $($choice).closest('tr').attr('id');
    ModuleUsersUIUsersTab.addProgressIcon(rowId);
    $.api({
      url: "".concat(globalRootUrl, "module-users-u-i/users-credentials/change-user-group"),
      on: 'now',
      method: 'POST',
      data: {
        user_id: rowId,
        group_id: value
      },
      successTest: function successTest(response) {
        // test whether a JSON response is valid
        return response !== undefined && Object.keys(response).length > 0 && response.success === true;
      },
      onSuccess: function onSuccess() {
        ModuleUsersUIUsersTab.removeProgressIcon(rowId);
        $('.ui.message.ajax').remove();
      },
      onError: function onError(response) {
        if (response.message !== undefined) {
          UserMessage.showMultiString(response.message);
        }

        ModuleUsersUIUsersTab.removeProgressIcon(rowId);
      },
      onFailure: function onFailure(response) {
        if (response.message !== undefined) {
          UserMessage.showMultiString(response.message);
        }

        ModuleUsersUIUsersTab.removeProgressIcon(rowId);
      }
    });
  },

  /**
   * Handles the change of LDAP checkbox in the list.
   */
  changeLdapInList: function changeLdapInList() {
    var rowId = $(this).closest('tr').attr('id');
    ModuleUsersUIUsersTab.addProgressIcon(rowId);
    $.api({
      url: "".concat(globalRootUrl, "module-users-u-i/users-credentials/change-user-use-ldap"),
      on: 'now',
      method: 'POST',
      data: {
        user_id: rowId,
        useLdap: $(this).parent('.checkbox').checkbox('is checked')
      },
      successTest: function successTest(response) {
        // test whether a JSON response is valid
        return response !== undefined && Object.keys(response).length > 0 && response.success === true;
      },
      onSuccess: function onSuccess() {
        ModuleUsersUIUsersTab.removeProgressIcon(rowId);

        if ($("tr#".concat(rowId, " .user-use-ldap-checkbox")).checkbox('is checked')) {
          $("tr#".concat(rowId, " td.password")).hide();
          $("tr#".concat(rowId, " td.login")).attr('colspan', 2);
        } else {
          $("tr#".concat(rowId, " td.password")).show();
          $("tr#".concat(rowId, " td.login")).attr('colspan', 1);
        }

        $('.ui.message.ajax').remove();
      },
      onError: function onError(response) {
        if (response.message !== undefined) {
          UserMessage.showMultiString(response.message);
        }

        ModuleUsersUIUsersTab.removeProgressIcon(rowId);
      },
      onFailure: function onFailure(response) {
        if (response.message !== undefined) {
          UserMessage.showMultiString(response.message);
        }

        ModuleUsersUIUsersTab.removeProgressIcon(rowId);
      }
    });
  },

  /**
   * Changes the login and password in the list.
   * @param {string} rowId - The ID of the row.
   */
  changeLoginPasswordInList: function changeLoginPasswordInList(rowId) {
    var login = $("#".concat(rowId, " input.user-login-input")).val();
    var password = $("#".concat(rowId, " input.user-password-input")).val();
    ModuleUsersUIUsersTab.addProgressIcon(rowId);
    $.api({
      url: "".concat(globalRootUrl, "module-users-u-i/users-credentials/change-user-credentials"),
      on: 'now',
      method: 'POST',
      data: {
        user_id: rowId,
        login: login,
        password: password
      },
      successTest: function successTest(response) {
        // test whether a JSON response is valid
        return response !== undefined && Object.keys(response).length > 0 && response.success === true;
      },
      onSuccess: function onSuccess() {
        ModuleUsersUIUsersTab.removeProgressIcon(rowId);
        $("tr#".concat(rowId, " .changed-field input")).attr('readonly', true);
        $("tr#".concat(rowId, " div.changed-field")).removeClass('changed-field loading').addClass('transparent');
        $('.ui.message.ajax').remove();
      },
      onError: function onError(response) {
        if (response.message !== undefined) {
          UserMessage.showMultiString(response.message);
        }

        ModuleUsersUIUsersTab.removeProgressIcon(rowId);
      },
      onFailure: function onFailure(response) {
        if (response.message !== undefined) {
          UserMessage.showMultiString(response.message);
        }

        ModuleUsersUIUsersTab.removeProgressIcon(rowId);
      }
    });
  },

  /**
   * Adds save icon from the row
   */
  addProgressIcon: function addProgressIcon(rowId) {
    $("tr#".concat(rowId, " .changed-field")).find('.ui.spinner.loading.icon').show();
  },

  /**
   * Removes save icon from the row
   */
  removeProgressIcon: function removeProgressIcon(rowId) {
    $("tr#".concat(rowId, " .changed-field")).find('.ui.spinner.loading.icon').hide();
    $("tr#".concat(rowId, " .changed-field")).closest('div').search('hide results').search('destroy');
  }
};
$(document).ready(function () {
  ModuleUsersUIUsersTab.initialize();
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9tb2R1bGUtdXNlcnMtdWktaW5kZXgtdXNlcnMuanMiXSwibmFtZXMiOlsiTW9kdWxlVXNlcnNVSVVzZXJzVGFiIiwiJHVzZXJzVGFibGUiLCIkIiwiJHNlbGVjdEdyb3VwIiwiJHVzZXJVc2VMZGFwVGFibGVDaGVja2JveCIsIiRib2R5IiwiaW5pdGlhbGl6ZSIsImluaXRpYWxpemVEYXRhVGFibGUiLCJlYWNoIiwiaW5kZXgiLCJvYmoiLCJkcm9wZG93biIsInZhbHVlcyIsIm1ha2VEcm9wZG93bkxpc3QiLCJhdHRyIiwib25DaGFuZ2UiLCJjaGFuZ2VHcm91cEluTGlzdCIsImNoZWNrYm94IiwiY2hhbmdlTGRhcEluTGlzdCIsIm9uIiwiZSIsInRhcmdldCIsInRyYW5zaXRpb24iLCJjbG9zZXN0IiwicmVtb3ZlQ2xhc3MiLCJhZGRDbGFzcyIsIm1vZHVsZVVzZXJzVWlJbmRleExkYXAiLCIkdXNlTGRhcENoZWNrYm94IiwiZmluZCIsInNlYXJjaCIsImFwaVNldHRpbmdzIiwidXJsIiwiZ2xvYmFsUm9vdFVybCIsImRvY3VtZW50Iiwia2V5Q29kZSIsIndoaWNoIiwiaGFzQ2xhc3MiLCIkZWwiLCJjdXJyZW50Um93SWQiLCJ1bmRlZmluZWQiLCJjaGFuZ2VMb2dpblBhc3N3b3JkSW5MaXN0IiwiRGF0YVRhYmxlIiwibGVuZ3RoQ2hhbmdlIiwicGFnaW5nIiwiY29sdW1ucyIsIm9yZGVyYWJsZSIsInNlYXJjaGFibGUiLCJvcmRlciIsImxhbmd1YWdlIiwiU2VtYW50aWNMb2NhbGl6YXRpb24iLCJkYXRhVGFibGVMb2NhbGlzYXRpb24iLCJzZWxlY3RlZCIsInRleHQiLCJ2YWx1ZSIsInB1c2giLCJuYW1lIiwiJGNob2ljZSIsInJvd0lkIiwiYWRkUHJvZ3Jlc3NJY29uIiwiYXBpIiwibWV0aG9kIiwiZGF0YSIsInVzZXJfaWQiLCJncm91cF9pZCIsInN1Y2Nlc3NUZXN0IiwicmVzcG9uc2UiLCJPYmplY3QiLCJrZXlzIiwibGVuZ3RoIiwic3VjY2VzcyIsIm9uU3VjY2VzcyIsInJlbW92ZVByb2dyZXNzSWNvbiIsInJlbW92ZSIsIm9uRXJyb3IiLCJtZXNzYWdlIiwiVXNlck1lc3NhZ2UiLCJzaG93TXVsdGlTdHJpbmciLCJvbkZhaWx1cmUiLCJ1c2VMZGFwIiwicGFyZW50IiwiaGlkZSIsInNob3ciLCJsb2dpbiIsInZhbCIsInBhc3N3b3JkIiwicmVhZHkiXSwibWFwcGluZ3MiOiI7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUVBLElBQU1BLHFCQUFxQixHQUFHO0FBRTFCO0FBQ0o7QUFDQTtBQUNBO0FBQ0lDLEVBQUFBLFdBQVcsRUFBRUMsQ0FBQyxDQUFDLGNBQUQsQ0FOWTs7QUFRMUI7QUFDSjtBQUNBO0FBQ0E7QUFDSUMsRUFBQUEsWUFBWSxFQUFFRCxDQUFDLENBQUMsZUFBRCxDQVpXOztBQWMxQjtBQUNKO0FBQ0E7QUFDQTtBQUNJRSxFQUFBQSx5QkFBeUIsRUFBRUYsQ0FBQyxDQUFDLHlCQUFELENBbEJGOztBQW9CMUI7QUFDSjtBQUNBO0FBQ0E7QUFDSUcsRUFBQUEsS0FBSyxFQUFFSCxDQUFDLENBQUMsTUFBRCxDQXhCa0I7O0FBMEIxQjtBQUNKO0FBQ0E7QUFDSUksRUFBQUEsVUE3QjBCLHdCQTZCYjtBQUNUTixJQUFBQSxxQkFBcUIsQ0FBQ08sbUJBQXRCO0FBQ0FQLElBQUFBLHFCQUFxQixDQUFDRyxZQUF0QixDQUFtQ0ssSUFBbkMsQ0FBd0MsVUFBQ0MsS0FBRCxFQUFRQyxHQUFSLEVBQWdCO0FBQ3BEUixNQUFBQSxDQUFDLENBQUNRLEdBQUQsQ0FBRCxDQUFPQyxRQUFQLENBQWdCO0FBQ1pDLFFBQUFBLE1BQU0sRUFBRVoscUJBQXFCLENBQUNhLGdCQUF0QixDQUF1Q1gsQ0FBQyxDQUFDUSxHQUFELENBQUQsQ0FBT0ksSUFBUCxDQUFZLFlBQVosQ0FBdkM7QUFESSxPQUFoQjtBQUdILEtBSkQ7QUFL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bnRlbnQiOlsiLypcbiAqIE1pa29QQlggLSBmcmVlIHBob25lIHN5c3RlbSBmb3Igc21hbGwgYnVzaW5lc3NcbiAqIENvcHlyaWdodCDCqSAyMDE3LTIwMjMgQWxleGV5IFBvcnRub3YgYW5kIE5pa29sYXkgQmVrZXRvdlxuICpcbiAqIFRoaXMgcHJvZ3JhbSBpcyBmcmVlIHNvZnR3YXJlOiB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IgbW9kaWZ5XG4gKiBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieVxuICogdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbjsgZWl0aGVyIHZlcnNpb24gMyBvZiB0aGUgTGljZW5zZSwgb3JcbiAqIChhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uXG4gKlxuICogVGhpcyBwcm9ncmFtIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsXG4gKiBidXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZlxuICogTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZVxuICogR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy5cbiAqXG4gKiBZb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBhbG9uZyB3aXRoIHRoaXMgcHJvZ3JhbS5cbiAqIElmIG5vdCwgc2VlIDxodHRwczovL3d3dy5nbnUub3JnL2xpY2Vuc2VzLz4uXG4gKi9cblxuLyogZ2xvYmFsIFNlbWFudGljTG9jYWxpemF0aW9uLCBnbG9iYWxSb290VXJsLCBtb2R1bGVVc2Vyc1VpSW5kZXhMZGFwLCBVc2VyTWVzc2FnZSAqL1xuXG5jb25zdCBNb2R1bGVVc2Vyc1VJVXNlcnNUYWIgPSB7XG5cbiAgICAvKipcbiAgICAgKiBVc2VycyB0YWJsZS5cbiAgICAgKiBAdHlwZSB7alF1ZXJ5fVxuICAgICAqL1xuICAgICR1c2Vyc1RhYmxlOiAkKCcjdXNlcnMtdGFibGUnKSxcblxuICAgIC8qKlxuICAgICAqIFNlbGVjdCBncm91cCBkcm9wZG93bnMuXG4gICAgICogQHR5cGUge2pRdWVyeX1cbiAgICAgKi9cbiAgICAkc2VsZWN0R3JvdXA6ICQoJy5zZWxlY3QtZ3JvdXAnKSxcblxuICAgIC8qKlxuICAgICAqIFVzZXIgdXNlIExEQVAgdGFibGUgY2hlY2tib3hlcy5cbiAgICAgKiBAdHlwZSB7alF1ZXJ5fVxuICAgICAqL1xuICAgICR1c2VyVXNlTGRhcFRhYmxlQ2hlY2tib3g6ICQoJy51c2VyLXVzZS1sZGFwLWNoZWNrYm94JyksXG5cbiAgICAvKipcbiAgICAgKiBCb2R5LlxuICAgICAqIEB0eXBlIHtqUXVlcnl9XG4gICAgICovXG4gICAgJGJvZHk6ICQoJ2JvZHknKSxcblxuICAgIC8qKlxuICAgICAqIEluaXRpYWxpemVzIHRoZSBNb2R1bGVVc2Vyc1VJSW5kZXggbW9kdWxlLlxuICAgICAqL1xuICAgIGluaXRpYWxpemUoKSB7XG4gICAgICAgIE1vZHVsZVVzZXJzVUlVc2Vyc1RhYi5pbml0aWFsaXplRGF0YVRhYmxlKCk7XG4gICAgICAgIE1vZHVsZVVzZXJzVUlVc2Vyc1RhYi4kc2VsZWN0R3JvdXAuZWFjaCgoaW5kZXgsIG9iaikgPT4ge1xuICAgICAgICAgICAgJChvYmopLmRyb3Bkb3duKHtcbiAgICAgICAgICAgICAgICB2YWx1ZXM6IE1vZHVsZVVzZXJzVUlVc2Vyc1RhYi5tYWtlRHJvcGRvd25MaXN0KCQob2JqKS5hdHRyKCdkYXRhLXZhbHVlJykpLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgICBNb2R1bGVVc2Vyc1VJVXNlcnNUYWIuJHNlbGVjdEdyb3VwLmRyb3Bkb3duKHtcbiAgICAgICAgICAgIG9uQ2hhbmdlOiBNb2R1bGVVc2Vyc1VJVXNlcnNUYWIuY2hhbmdlR3JvdXBJbkxpc3QsXG4gICAgICAgIH0pO1xuXG4gICAgICAgIE1vZHVsZVVzZXJzVUlVc2Vyc1RhYi4kdXNlclVzZUxkYXBUYWJsZUNoZWNrYm94LmNoZWNrYm94KHtcbiAgICAgICAgICAgIG9uQ2hhbmdlOiBNb2R1bGVVc2Vyc1VJVXNlcnNUYWIuY2hhbmdlTGRhcEluTGlzdCxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gRG91YmxlIGNsaWNrIG9uIHBhc3N3b3JkIG9yIGxvZ2luIGlucHV0IGZpZWxkIGluIHRoZSB0YWJsZVxuICAgICAgICBNb2R1bGVVc2Vyc1VJVXNlcnNUYWIuJGJvZHkub24oJ2ZvY3VzaW4nLCAnLnVzZXItbG9naW4taW5wdXQsIC51c2VyLXBhc3N3b3JkLWlucHV0JywgKGUpID0+IHtcbiAgICAgICAgICAgICQoZS50YXJnZXQpLnRyYW5zaXRpb24oJ2dsb3cnKTtcblxuICAgICAgICAgICAgJChlLnRhcmdldCkuY2xvc2VzdCgnZGl2JylcbiAgICAgICAgICAgICAgICAucmVtb3ZlQ2xhc3MoJ3RyYW5zcGFyZW50JylcbiAgICAgICAgICAgICAgICAuYWRkQ2xhc3MoJ2NoYW5nZWQtZmllbGQnKTtcbiAgICAgICAgICAgICQoZS50YXJnZXQpLmF0dHIoJ3JlYWRvbmx5JywgZmFsc2UpO1xuXG4gICAgICAgICAgICBpZiAobW9kdWxlVXNlcnNVaUluZGV4TGRhcC4kdXNlTGRhcENoZWNrYm94LmNoZWNrYm94KCdpcyBjaGVja2VkJylcbiAgICAgICAgICAgICAgICAmJiAkKGUudGFyZ2V0KS5jbG9zZXN0KCd0cicpLmZpbmQoJy51c2VyLXVzZS1sZGFwLWNoZWNrYm94JykuY2hlY2tib3goJ2lzIGNoZWNrZWQnKSl7XG4gICAgICAgICAgICAgICAgJChlLnRhcmdldCkuY2xvc2VzdCgnZGl2Jykuc2VhcmNoKHtcbiAgICAgICAgICAgICAgICAgICAgLy8gY2hhbmdlIHNlYXJjaCBlbmRwb2ludCB0byBhIGN1c3RvbSBlbmRwb2ludCBieSBtYW5pcHVsYXRpbmcgYXBpU2V0dGluZ3NcbiAgICAgICAgICAgICAgICAgICAgYXBpU2V0dGluZ3M6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHVybDogYCR7Z2xvYmFsUm9vdFVybH1tb2R1bGUtdXNlcnMtdS1pL2xkYXAtY29uZmlnL3NlYXJjaC1sZGFwLXVzZXIve3F1ZXJ5fWBcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gU3VibWl0IGZvcm0gb24gRW50ZXIgb3IgVGFiXG4gICAgICAgICQoZG9jdW1lbnQpLm9uKCdrZXlkb3duJywgKGUpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGtleUNvZGUgPSBlLmtleUNvZGUgfHwgZS53aGljaDtcbiAgICAgICAgICAgIGlmIChrZXlDb2RlID09PSAxM1xuICAgICAgICAgICAgICAgIHx8IChrZXlDb2RlID09PSA5ICYmICEkKCc6Zm9jdXMnKS5oYXNDbGFzcygnLnVzZXItbG9naW4taW5wdXQnKSlcbiAgICAgICAgICAgICAgICB8fCAoa2V5Q29kZSA9PT0gOSAmJiAhJCgnOmZvY3VzJykuaGFzQ2xhc3MoJy51c2VyLXBhc3N3b3JkLWlucHV0JykpXG4gICAgICAgICAgICApIHtcbiAgICAgICAgICAgICAgICBjb25zdCAkZWwgPSAkKCcuY2hhbmdlZC1maWVsZCcpLmNsb3Nlc3QoJ3RyJyk7XG4gICAgICAgICAgICAgICAgJGVsLmVhY2goKGluZGV4LCBvYmopID0+IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY3VycmVudFJvd0lkID0gJChvYmopLmF0dHIoJ2lkJyk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChjdXJyZW50Um93SWQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgTW9kdWxlVXNlcnNVSVVzZXJzVGFiLmNoYW5nZUxvZ2luUGFzc3dvcmRJbkxpc3QoY3VycmVudFJvd0lkKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICAvLyBTdWJtaXQgZm9ybSBvbiBmb2N1cyBvdXQgZnJvbSBwYXNzd29yZCBvciBsb2dpbiBpbnB1dCBmaWVsZFxuICAgICAgICBNb2R1bGVVc2Vyc1VJVXNlcnNUYWIuJGJvZHkub24oJ2ZvY3Vzb3V0JywgJy51c2VyLWxvZ2luLWlucHV0LCAudXNlci1wYXNzd29yZC1pbnB1dCcsIChlKSA9PiB7XG4gICAgICAgICAgICBjb25zdCAkZWwgPSAkKCcuY2hhbmdlZC1maWVsZCcpLmNsb3Nlc3QoJ3RyJyk7XG4gICAgICAgICAgICAkZWwuZWFjaCgoaW5kZXgsIG9iaikgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRSb3dJZCA9ICQob2JqKS5hdHRyKCdpZCcpO1xuICAgICAgICAgICAgICAgIGlmIChjdXJyZW50Um93SWQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICBNb2R1bGVVc2Vyc1VJVXNlcnNUYWIuY2hhbmdlTG9naW5QYXNzd29yZEluTGlzdChjdXJyZW50Um93SWQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcblxuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBJbml0aWFsaXplcyB0aGUgdXNlcnMgdGFibGUgRGF0YVRhYmxlLlxuICAgICAqL1xuICAgIGluaXRpYWxpemVEYXRhVGFibGUoKSB7XG4gICAgICAgIE1vZHVsZVVzZXJzVUlVc2Vyc1RhYi4kdXNlcnNUYWJsZS5EYXRhVGFibGUoe1xuICAgICAgICAgICAgLy8gZGVzdHJveTogdHJ1ZSxcbiAgICAgICAgICAgIGxlbmd0aENoYW5nZTogZmFsc2UsXG4gICAgICAgICAgICBwYWdpbmc6IGZhbHNlLFxuICAgICAgICAgICAgY29sdW1uczogW1xuICAgICAgICAgICAgICAgIC8vIFVzZXJuYW1lXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBvcmRlcmFibGU6IHRydWUsICAvLyBUaGlzIGNvbHVtbiBpcyBvcmRlcmFibGVcbiAgICAgICAgICAgICAgICAgICAgc2VhcmNoYWJsZTogdHJ1ZSAgLy8gVGhpcyBjb2x1bW4gaXMgc2VhcmNoYWJsZVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgLy8gRXh0ZW5zaW9uXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBvcmRlcmFibGU6IHRydWUsICAvLyBUaGlzIGNvbHVtbiBpcyBvcmRlcmFibGVcbiAgICAgICAgICAgICAgICAgICAgc2VhcmNoYWJsZTogdHJ1ZSAgLy8gVGhpcyBjb2x1bW4gaXMgc2VhcmNoYWJsZVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgLy8gVXNlIExEQVBcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIG9yZGVyYWJsZTogZmFsc2UsICAvLyBUaGlzIGNvbHVtbiBpcyBub3Qgb3JkZXJhYmxlXG4gICAgICAgICAgICAgICAgICAgIHNlYXJjaGFibGU6IGZhbHNlICAvLyBUaGlzIGNvbHVtbiBpcyBub3Qgc2VhcmNoYWJsZVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgLy8gTG9naW5cbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIG9yZGVyYWJsZTogdHJ1ZSwgIC8vIFRoaXMgY29sdW1uIGlzIG9yZGVyYWJsZVxuICAgICAgICAgICAgICAgICAgICBzZWFyY2hhYmxlOiB0cnVlICAvLyBUaGlzIGNvbHVtbiBpcyBzZWFyY2hhYmxlXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAvLyBQYXNzd29yZFxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgb3JkZXJhYmxlOiBmYWxzZSwgIC8vIFRoaXMgY29sdW1uIGlzIG5vdCBvcmRlcmFibGVcbiAgICAgICAgICAgICAgICAgICAgc2VhcmNoYWJsZTogZmFsc2UgIC8vIFRoaXMgY29sdW1uIGlzIG5vdCBzZWFyY2hhYmxlXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAvLyBBY2Nlc3MgZ3JvdXBcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIG9yZGVyYWJsZTogdHJ1ZSwgIC8vIFRoaXMgY29sdW1uIGlzIG9yZGVyYWJsZVxuICAgICAgICAgICAgICAgICAgICBzZWFyY2hhYmxlOiB0cnVlICAvLyBUaGlzIGNvbHVtbiBpcyBzZWFyY2hhYmxlXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF0sXG4gICAgICAgICAgICBvcmRlcjogWzAsICdhc2MnXSxcbiAgICAgICAgICAgIGxhbmd1YWdlOiBTZW1hbnRpY0xvY2FsaXphdGlvbi5kYXRhVGFibGVMb2NhbGlzYXRpb24sXG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGEgZHJvcGRvd24gbGlzdCBmb3IgdXNlcnMuXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IHNlbGVjdGVkIC0gVGhlIHNlbGVjdGVkIHZhbHVlLlxuICAgICAqIEByZXR1cm5zIHtBcnJheX0gLSBUaGUgZHJvcGRvd24gbGlzdC5cbiAgICAgKi9cbiAgICBtYWtlRHJvcGRvd25MaXN0KHNlbGVjdGVkKSB7XG4gICAgICAgIGNvbnN0IHZhbHVlcyA9IFtdO1xuICAgICAgICAkKCcjdXNlcnMtZ3JvdXBzLWxpc3Qgb3B0aW9uJykuZWFjaCgoaW5kZXgsIG9iaikgPT4ge1xuICAgICAgICAgICAgaWYgKHNlbGVjdGVkID09PSBvYmoudGV4dCB8fCBzZWxlY3RlZCA9PT0gb2JqLnZhbHVlKSB7XG4gICAgICAgICAgICAgICAgdmFsdWVzLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICBuYW1lOiBvYmoudGV4dCxcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IG9iai52YWx1ZSxcbiAgICAgICAgICAgICAgICAgICAgc2VsZWN0ZWQ6IHRydWUsXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHZhbHVlcy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgbmFtZTogb2JqLnRleHQsXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlOiBvYmoudmFsdWUsXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gdmFsdWVzO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBIYW5kbGVzIHRoZSBjaGFuZ2Ugb2YgZ3JvdXAgaW4gdGhlIGxpc3QuXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IHZhbHVlIC0gVGhlIHNlbGVjdGVkIHZhbHVlLlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSB0ZXh0IC0gVGhlIHNlbGVjdGVkIHRleHQuXG4gICAgICogQHBhcmFtIHtqUXVlcnl9ICRjaG9pY2UgLSBUaGUgZHJvcGRvd24gZWxlbWVudC5cbiAgICAgKi9cbiAgICBjaGFuZ2VHcm91cEluTGlzdCh2YWx1ZSwgdGV4dCwgJGNob2ljZSkge1xuICAgICAgICBjb25zdCByb3dJZCA9ICQoJGNob2ljZSkuY2xvc2VzdCgndHInKS5hdHRyKCdpZCcpO1xuICAgICAgICBNb2R1bGVVc2Vyc1VJVXNlcnNUYWIuYWRkUHJvZ3Jlc3NJY29uKHJvd0lkKTtcbiAgICAgICAgJC5hcGkoe1xuICAgICAgICAgICAgdXJsOiBgJHtnbG9iYWxSb290VXJsfW1vZHVsZS11c2Vycy11LWkvdXNlcnMtY3JlZGVudGlhbHMvY2hhbmdlLXVzZXItZ3JvdXBgLFxuICAgICAgICAgICAgb246ICdub3cnLFxuICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgdXNlcl9pZDogcm93SWQsXG4gICAgICAgICAgICAgICAgZ3JvdXBfaWQ6IHZhbHVlLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHN1Y2Nlc3NUZXN0KHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgLy8gdGVzdCB3aGV0aGVyIGEgSlNPTiByZXNwb25zZSBpcyB2YWxpZFxuICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZSAhPT0gdW5kZWZpbmVkXG4gICAgICAgICAgICAgICAgICAgICYmIE9iamVjdC5rZXlzKHJlc3BvbnNlKS5sZW5ndGggPiAwXG4gICAgICAgICAgICAgICAgICAgICYmIHJlc3BvbnNlLnN1Y2Nlc3MgPT09IHRydWU7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgb25TdWNjZXNzKCkge1xuICAgICAgICAgICAgICAgIE1vZHVsZVVzZXJzVUlVc2Vyc1RhYi5yZW1vdmVQcm9ncmVzc0ljb24ocm93SWQpO1xuICAgICAgICAgICAgICAgICQoJy51aS5tZXNzYWdlLmFqYXgnKS5yZW1vdmUoKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBvbkVycm9yKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLm1lc3NhZ2UgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICBVc2VyTWVzc2FnZS5zaG93TXVsdGlTdHJpbmcocmVzcG9uc2UubWVzc2FnZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIE1vZHVsZVVzZXJzVUlVc2Vyc1RhYi5yZW1vdmVQcm9ncmVzc0ljb24ocm93SWQpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG9uRmFpbHVyZShyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5tZXNzYWdlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgVXNlck1lc3NhZ2Uuc2hvd011bHRpU3RyaW5nKHJlc3BvbnNlLm1lc3NhZ2UpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBNb2R1bGVVc2Vyc1VJVXNlcnNUYWIucmVtb3ZlUHJvZ3Jlc3NJY29uKHJvd0lkKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBIYW5kbGVzIHRoZSBjaGFuZ2Ugb2YgTERBUCBjaGVja2JveCBpbiB0aGUgbGlzdC5cbiAgICAgKi9cbiAgICBjaGFuZ2VMZGFwSW5MaXN0KCkge1xuICAgICAgICBjb25zdCByb3dJZCA9ICQodGhpcykuY2xvc2VzdCgndHInKS5hdHRyKCdpZCcpO1xuICAgICAgICBNb2R1bGVVc2Vyc1VJVXNlcnNUYWIuYWRkUHJvZ3Jlc3NJY29uKHJvd0lkKTtcbiAgICAgICAgJC5hcGkoe1xuICAgICAgICAgICAgdXJsOiBgJHtnbG9iYWxSb290VXJsfW1vZHVsZS11c2Vycy11LWkvdXNlcnMtY3JlZGVudGlhbHMvY2hhbmdlLXVzZXItdXNlLWxkYXBgLFxuICAgICAgICAgICAgb246ICdub3cnLFxuICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgdXNlcl9pZDogcm93SWQsXG4gICAgICAgICAgICAgICAgdXNlTGRhcDogJCh0aGlzKS5wYXJlbnQoJy5jaGVja2JveCcpLmNoZWNrYm94KCdpcyBjaGVja2VkJyksXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc3VjY2Vzc1Rlc3QocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAvLyB0ZXN0IHdoZXRoZXIgYSBKU09OIHJlc3BvbnNlIGlzIHZhbGlkXG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlICE9PSB1bmRlZmluZWRcbiAgICAgICAgICAgICAgICAgICAgJiYgT2JqZWN0LmtleXMocmVzcG9uc2UpLmxlbmd0aCA+IDBcbiAgICAgICAgICAgICAgICAgICAgJiYgcmVzcG9uc2Uuc3VjY2VzcyA9PT0gdHJ1ZTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBvblN1Y2Nlc3MoKSB7XG4gICAgICAgICAgICAgICAgTW9kdWxlVXNlcnNVSVVzZXJzVGFiLnJlbW92ZVByb2dyZXNzSWNvbihyb3dJZCk7XG4gICAgICAgICAgICAgICAgaWYgKCQoYHRyIyR7cm93SWR9IC51c2VyLXVzZS1sZGFwLWNoZWNrYm94YCkuY2hlY2tib3goJ2lzIGNoZWNrZWQnKSl7XG4gICAgICAgICAgICAgICAgICAgICQoYHRyIyR7cm93SWR9IHRkLnBhc3N3b3JkYCkuaGlkZSgpO1xuICAgICAgICAgICAgICAgICAgICAkKGB0ciMke3Jvd0lkfSB0ZC5sb2dpbmApLmF0dHIoJ2NvbHNwYW4nLDIpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICQoYHRyIyR7cm93SWR9IHRkLnBhc3N3b3JkYCkuc2hvdygpO1xuICAgICAgICAgICAgICAgICAgICAkKGB0ciMke3Jvd0lkfSB0ZC5sb2dpbmApLmF0dHIoJ2NvbHNwYW4nLDEpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAkKCcudWkubWVzc2FnZS5hamF4JykucmVtb3ZlKCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgb25FcnJvcihyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5tZXNzYWdlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgVXNlck1lc3NhZ2Uuc2hvd011bHRpU3RyaW5nKHJlc3BvbnNlLm1lc3NhZ2UpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBNb2R1bGVVc2Vyc1VJVXNlcnNUYWIucmVtb3ZlUHJvZ3Jlc3NJY29uKHJvd0lkKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBvbkZhaWx1cmUocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UubWVzc2FnZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIFVzZXJNZXNzYWdlLnNob3dNdWx0aVN0cmluZyhyZXNwb25zZS5tZXNzYWdlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgTW9kdWxlVXNlcnNVSVVzZXJzVGFiLnJlbW92ZVByb2dyZXNzSWNvbihyb3dJZCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogQ2hhbmdlcyB0aGUgbG9naW4gYW5kIHBhc3N3b3JkIGluIHRoZSBsaXN0LlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSByb3dJZCAtIFRoZSBJRCBvZiB0aGUgcm93LlxuICAgICAqL1xuICAgIGNoYW5nZUxvZ2luUGFzc3dvcmRJbkxpc3Qocm93SWQpIHtcbiAgICAgICAgY29uc3QgbG9naW4gPSAkKGAjJHtyb3dJZH0gaW5wdXQudXNlci1sb2dpbi1pbnB1dGApLnZhbCgpO1xuICAgICAgICBjb25zdCBwYXNzd29yZCA9ICQoYCMke3Jvd0lkfSBpbnB1dC51c2VyLXBhc3N3b3JkLWlucHV0YCkudmFsKCk7XG5cbiAgICAgICAgTW9kdWxlVXNlcnNVSVVzZXJzVGFiLmFkZFByb2dyZXNzSWNvbihyb3dJZCk7XG5cbiAgICAgICAgJC5hcGkoe1xuICAgICAgICAgICAgdXJsOiBgJHtnbG9iYWxSb290VXJsfW1vZHVsZS11c2Vycy11LWkvdXNlcnMtY3JlZGVudGlhbHMvY2hhbmdlLXVzZXItY3JlZGVudGlhbHNgLFxuICAgICAgICAgICAgb246ICdub3cnLFxuICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgdXNlcl9pZDogcm93SWQsXG4gICAgICAgICAgICAgICAgbG9naW46IGxvZ2luLFxuICAgICAgICAgICAgICAgIHBhc3N3b3JkOiBwYXNzd29yZCxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzdWNjZXNzVGVzdChyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgIC8vIHRlc3Qgd2hldGhlciBhIEpTT04gcmVzcG9uc2UgaXMgdmFsaWRcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UgIT09IHVuZGVmaW5lZFxuICAgICAgICAgICAgICAgICAgICAmJiBPYmplY3Qua2V5cyhyZXNwb25zZSkubGVuZ3RoID4gMFxuICAgICAgICAgICAgICAgICAgICAmJiByZXNwb25zZS5zdWNjZXNzID09PSB0cnVlO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG9uU3VjY2VzcygpIHtcbiAgICAgICAgICAgICAgICBNb2R1bGVVc2Vyc1VJVXNlcnNUYWIucmVtb3ZlUHJvZ3Jlc3NJY29uKHJvd0lkKTtcbiAgICAgICAgICAgICAgICAkKGB0ciMke3Jvd0lkfSAuY2hhbmdlZC1maWVsZCBpbnB1dGApLmF0dHIoJ3JlYWRvbmx5JywgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgJChgdHIjJHtyb3dJZH0gZGl2LmNoYW5nZWQtZmllbGRgKS5yZW1vdmVDbGFzcygnY2hhbmdlZC1maWVsZCBsb2FkaW5nJykuYWRkQ2xhc3MoJ3RyYW5zcGFyZW50Jyk7XG4gICAgICAgICAgICAgICAgJCgnLnVpLm1lc3NhZ2UuYWpheCcpLnJlbW92ZSgpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG9uRXJyb3IocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UubWVzc2FnZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIFVzZXJNZXNzYWdlLnNob3dNdWx0aVN0cmluZyhyZXNwb25zZS5tZXNzYWdlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgTW9kdWxlVXNlcnNVSVVzZXJzVGFiLnJlbW92ZVByb2dyZXNzSWNvbihyb3dJZCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgb25GYWlsdXJlKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLm1lc3NhZ2UgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICBVc2VyTWVzc2FnZS5zaG93TXVsdGlTdHJpbmcocmVzcG9uc2UubWVzc2FnZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIE1vZHVsZVVzZXJzVUlVc2Vyc1RhYi5yZW1vdmVQcm9ncmVzc0ljb24ocm93SWQpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSk7XG4gICAgfSxcbiAgICAvKipcbiAgICAgKiBBZGRzIHNhdmUgaWNvbiBmcm9tIHRoZSByb3dcbiAgICAgKi9cbiAgICBhZGRQcm9ncmVzc0ljb24ocm93SWQpe1xuICAgICAgICAkKGB0ciMke3Jvd0lkfSAuY2hhbmdlZC1maWVsZGApLmZpbmQoJy51aS5zcGlubmVyLmxvYWRpbmcuaWNvbicpLnNob3coKTtcbiAgICB9LFxuICAgIC8qKlxuICAgICAqIFJlbW92ZXMgc2F2ZSBpY29uIGZyb20gdGhlIHJvd1xuICAgICAqL1xuICAgIHJlbW92ZVByb2dyZXNzSWNvbihyb3dJZCkge1xuICAgICAgICAkKGB0ciMke3Jvd0lkfSAuY2hhbmdlZC1maWVsZGApLmZpbmQoJy51aS5zcGlubmVyLmxvYWRpbmcuaWNvbicpLmhpZGUoKTtcbiAgICAgICAgJChgdHIjJHtyb3dJZH0gLmNoYW5nZWQtZmllbGRgKS5jbG9zZXN0KCdkaXYnKS5zZWFyY2goJ2hpZGUgcmVzdWx0cycpLnNlYXJjaCgnZGVzdHJveScpO1xuICAgIH1cbn07XG5cbiQoZG9jdW1lbnQpLnJlYWR5KCgpID0+IHtcbiAgICBNb2R1bGVVc2Vyc1VJVXNlcnNUYWIuaW5pdGlhbGl6ZSgpO1xufSk7XG5cbiJdfQ==