"use strict";

/*
 * MikoPBX - free phone system for small business
 * Copyright © 2017-2023 Alexey Portnov and Nikolay Beketov
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation; either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License along with this program.
 * If not, see <https://www.gnu.org/licenses/>.
 */

/* global SemanticLocalization, globalRootUrl, moduleUsersUiIndexLdap, UserMessage, Datatable */
var ModuleUsersUIUsersTab = {
  /**
   * Users table.
   * @type {jQuery}
   */
  $usersTable: $('#users-table'),

  /**
   * User data table.
   * @type {Datatable}
   */
  userDataTable: null,

  /**
   * Select group dropdowns.
   * @type {jQuery}
   */
  $selectGroup: $('.select-group'),

  /**
   * User use LDAP table checkboxes.
   * @type {jQuery}
   */
  $userUseLdapTableCheckbox: $('.user-use-ldap-checkbox'),

  /**
   * Body.
   * @type {jQuery}
   */
  $body: $('body'),

  /**
   * Initializes the ModuleUsersUIIndex module.
   */
  initialize: function initialize() {
    ModuleUsersUIUsersTab.initializeDataTable();
    ModuleUsersUIUsersTab.$selectGroup.each(function (index, obj) {
      $(obj).dropdown({
        values: ModuleUsersUIUsersTab.makeDropdownList($(obj).attr('data-value'))
      });
    });
    ModuleUsersUIUsersTab.$selectGroup.dropdown({
      onChange: ModuleUsersUIUsersTab.changeGroupInList
    });
    ModuleUsersUIUsersTab.$userUseLdapTableCheckbox.checkbox({
      onChange: ModuleUsersUIUsersTab.changeLdapInList
    }); // Double click on password or login input field in the table

    ModuleUsersUIUsersTab.$body.on('focusin', '.user-login-input, .user-password-input', function (e) {
      $(e.target).transition('glow');
      $(e.target).closest('div').removeClass('transparent').addClass('changed-field');
      $(e.target).attr('readonly', false);

      if (moduleUsersUiIndexLdap.$useLdapCheckbox.checkbox('is checked') && $(e.target).closest('tr').find('.user-use-ldap-checkbox').checkbox('is checked')) {
        var $inputField = $(e.target);
        $inputField.closest('div').search({
          // change search endpoint to a custom endpoint by manipulating apiSettings
          apiSettings: {
            url: "".concat(globalRootUrl, "module-users-u-i/ldap-config/search-ldap-user/{query}")
          }
        }); // Обрабатываем событие нажатия клавиши Enter

        $inputField.on('keydown', function (event) {
          if (event.key === 'Enter') {
            // Прекращаем действие по умолчанию (если форма, то предотвратим отправку)
            event.preventDefault();
            var $searchResults = $inputField.closest('div').find('.results .result'); // Если есть один результат, подставляем его в поле

            if ($searchResults.length === 1) {
              var result = $searchResults.first().data('result');
              $inputField.val(result.title);
            }
          }
        });
      }
    }); // Submit form on Enter or Tab

    $(document).on('keydown', function (e) {
      var keyCode = e.keyCode || e.which;

      if (keyCode === 13 || keyCode === 9 && !$(':focus').hasClass('.user-login-input') || keyCode === 9 && !$(':focus').hasClass('.user-password-input')) {
        var $el = $('.changed-field').closest('tr');
        $el.each(function (index, obj) {
          var currentRowId = $(obj).attr('id');

          if (currentRowId !== undefined) {
            ModuleUsersUIUsersTab.changeLoginPasswordInList(currentRowId);
          }
        });
      }
    }); // Submit form on focus out from password or login input field

    ModuleUsersUIUsersTab.$body.on('focusout', '.user-login-input, .user-password-input', function (e) {
      var $el = $('.changed-field').closest('tr');
      $el.each(function (index, obj) {
        var currentRowId = $(obj).attr('id');

        if (currentRowId !== undefined) {
          ModuleUsersUIUsersTab.changeLoginPasswordInList(currentRowId);
        }
      });
    });
  },

  /**
   * Initializes the users table DataTable.
   */
  initializeDataTable: function initializeDataTable() {
    $('#main-users-ui-tab-menu .item').tab({
      onVisible: function onVisible() {
        if ($(this).data('tab') === 'users' && ModuleUsersUIUsersTab.userDataTable !== null) {
          var newPageLength = ModuleUsersUIUsersTab.calculatePageLength();
          ModuleUsersUIUsersTab.userDataTable.page.len(newPageLength).draw(false);
        }
      }
    });
    ModuleUsersUIUsersTab.userDataTable = ModuleUsersUIUsersTab.$usersTable.DataTable({
      // destroy: true,
      lengthChange: false,
      paging: true,
      pageLength: ModuleUsersUIUsersTab.calculatePageLength(),
      scrollCollapse: true,
      columns: [// Username
      {
        orderable: true,
        // This column is orderable
        searchable: true // This column is searchable

      }, // Extension
      {
        orderable: true,
        // This column is orderable
        searchable: true // This column is searchable

      }, // Use LDAP
      {
        orderable: false,
        // This column is not orderable
        searchable: false // This column is not searchable

      }, // Login
      {
        orderable: true,
        // This column is orderable
        searchable: true // This column is searchable

      }, // Password
      {
        orderable: false,
        // This column is not orderable
        searchable: false // This column is not searchable

      }, // Access group
      {
        orderable: true,
        // This column is orderable
        searchable: true // This column is searchable

      }],
      order: [0, 'asc'],
      language: SemanticLocalization.dataTableLocalisation
    });
  },

  /**
   * Creates a dropdown list for users.
   * @param {string} selected - The selected value.
   * @returns {Array} - The dropdown list.
   */
  makeDropdownList: function makeDropdownList(selected) {
    var values = [];
    $('#users-groups-list option').each(function (index, obj) {
      if (selected === obj.text || selected === obj.value) {
        values.push({
          name: obj.text,
          value: obj.value,
          selected: true
        });
      } else {
        values.push({
          name: obj.text,
          value: obj.value
        });
      }
    });
    return values;
  },

  /**
   * Handles the change of group in the list.
   * @param {string} value - The selected value.
   * @param {string} text - The selected text.
   * @param {jQuery} $choice - The dropdown element.
   */
  changeGroupInList: function changeGroupInList(value, text, $choice) {
    var rowId = $($choice).closest('tr').attr('id');
    ModuleUsersUIUsersTab.addProgressIcon(rowId);
    $.api({
      url: "".concat(globalRootUrl, "module-users-u-i/users-credentials/change-user-group"),
      on: 'now',
      method: 'POST',
      data: {
        user_id: rowId,
        group_id: value
      },
      successTest: function successTest(response) {
        // test whether a JSON response is valid
        return response !== undefined && Object.keys(response).length > 0 && response.success === true;
      },
      onSuccess: function onSuccess() {
        ModuleUsersUIUsersTab.removeProgressIcon(rowId);
        $('.ui.message.ajax').remove();
      },
      onError: function onError(response) {
        if (response.message !== undefined) {
          UserMessage.showMultiString(response.message);
        }

        ModuleUsersUIUsersTab.removeProgressIcon(rowId);
      },
      onFailure: function onFailure(response) {
        if (response.message !== undefined) {
          UserMessage.showMultiString(response.message);
        }

        ModuleUsersUIUsersTab.removeProgressIcon(rowId);
      }
    });
  },

  /**
   * Handles the change of LDAP checkbox in the list.
   */
  changeLdapInList: function changeLdapInList() {
    var rowId = $(this).closest('tr').attr('id');
    ModuleUsersUIUsersTab.addProgressIcon(rowId);
    $.api({
      url: "".concat(globalRootUrl, "module-users-u-i/users-credentials/change-user-use-ldap"),
      on: 'now',
      method: 'POST',
      data: {
        user_id: rowId,
        useLdap: $(this).parent('.checkbox').checkbox('is checked')
      },
      successTest: function successTest(response) {
        // test whether a JSON response is valid
        return response !== undefined && Object.keys(response).length > 0 && response.success === true;
      },
      onSuccess: function onSuccess() {
        ModuleUsersUIUsersTab.removeProgressIcon(rowId);

        if ($("tr#".concat(rowId, " .user-use-ldap-checkbox")).checkbox('is checked')) {
          $("tr#".concat(rowId, " td.password")).hide();
          $("tr#".concat(rowId, " td.login")).attr('colspan', 2);
        } else {
          $("tr#".concat(rowId, " td.password")).show();
          $("tr#".concat(rowId, " td.login")).attr('colspan', 1);
        }

        $('.ui.message.ajax').remove();
      },
      onError: function onError(response) {
        if (response.message !== undefined) {
          UserMessage.showMultiString(response.message);
        }

        ModuleUsersUIUsersTab.removeProgressIcon(rowId);
      },
      onFailure: function onFailure(response) {
        if (response.message !== undefined) {
          UserMessage.showMultiString(response.message);
        }

        ModuleUsersUIUsersTab.removeProgressIcon(rowId);
      }
    });
  },

  /**
   * Changes the login and password in the list.
   * @param {string} rowId - The ID of the row.
   */
  changeLoginPasswordInList: function changeLoginPasswordInList(rowId) {
    var login = $("#".concat(rowId, " input.user-login-input")).val();
    var password = $("#".concat(rowId, " input.user-password-input")).val();
    ModuleUsersUIUsersTab.addProgressIcon(rowId);
    $.api({
      url: "".concat(globalRootUrl, "module-users-u-i/users-credentials/change-user-credentials"),
      on: 'now',
      method: 'POST',
      data: {
        user_id: rowId,
        login: login,
        password: password
      },
      successTest: function successTest(response) {
        // test whether a JSON response is valid
        return response !== undefined && Object.keys(response).length > 0 && response.success === true;
      },
      onSuccess: function onSuccess() {
        ModuleUsersUIUsersTab.removeProgressIcon(rowId);
        $("tr#".concat(rowId, " .changed-field input")).attr('readonly', true);
        $("tr#".concat(rowId, " div.changed-field")).removeClass('changed-field loading').addClass('transparent');
        $('.ui.message.ajax').remove();
      },
      onError: function onError(response) {
        if (response.message !== undefined) {
          UserMessage.showMultiString(response.message);
        }

        ModuleUsersUIUsersTab.removeProgressIcon(rowId);
      },
      onFailure: function onFailure(response) {
        if (response.message !== undefined) {
          UserMessage.showMultiString(response.message);
        }

        ModuleUsersUIUsersTab.removeProgressIcon(rowId);
      }
    });
  },

  /**
   * Adds save icon from the row
   */
  addProgressIcon: function addProgressIcon(rowId) {
    $("tr#".concat(rowId, " .changed-field")).find('.ui.spinner.loading.icon').show();
  },

  /**
   * Removes save icon from the row
   */
  removeProgressIcon: function removeProgressIcon(rowId) {
    $("tr#".concat(rowId, " .changed-field")).find('.ui.spinner.loading.icon').hide();
    $("tr#".concat(rowId, " .changed-field")).closest('div').search('hide results').search('destroy');
  },

  /**
   * Calculate data table page length
   *
   * @returns {number}
   */
  calculatePageLength: function calculatePageLength() {
    // Calculate row height
    var rowHeight = ModuleUsersUIUsersTab.$usersTable.find('tr').first().outerHeight(); // Calculate window height and available space for table

    var windowHeight = window.innerHeight;
    var headerFooterHeight = 400; // Estimate height for header, footer, and other elements
    // Calculate new page length

    return Math.max(Math.floor((windowHeight - headerFooterHeight) / rowHeight), 10);
  }
};
$(document).ready(function () {
  ModuleUsersUIUsersTab.initialize();
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9tb2R1bGUtdXNlcnMtdWktaW5kZXgtdXNlcnMuanMiXSwibmFtZXMiOlsiTW9kdWxlVXNlcnNVSVVzZXJzVGFiIiwiJHVzZXJzVGFibGUiLCIkIiwidXNlckRhdGFUYWJsZSIsIiRzZWxlY3RHcm91cCIsIiR1c2VyVXNlTGRhcFRhYmxlQ2hlY2tib3giLCIkYm9keSIsImluaXRpYWxpemUiLCJpbml0aWFsaXplRGF0YVRhYmxlIiwiZWFjaCIsImluZGV4Iiwib2JqIiwiZHJvcGRvd24iLCJ2YWx1ZXMiLCJtYWtlRHJvcGRvd25MaXN0IiwiYXR0ciIsIm9uQ2hhbmdlIiwiY2hhbmdlR3JvdXBJbkxpc3QiLCJjaGVja2JveCIsImNoYW5nZUxkYXBJbkxpc3QiLCJvbiIsImUiLCJ0YXJnZXQiLCJ0cmFuc2l0aW9uIiwiY2xvc2VzdCIsInJlbW92ZUNsYXNzIiwiYWRkQ2xhc3MiLCJtb2R1bGVVc2Vyc1VpSW5kZXhMZGFwIiwiJHVzZUxkYXBDaGVja2JveCIsImZpbmQiLCIkaW5wdXRGaWVsZCIsInNlYXJjaCIsImFwaVNldHRpbmdzIiwidXJsIiwiZ2xvYmFsUm9vdFVybCIsImV2ZW50Iiwia2V5IiwicHJldmVudERlZmF1bHQiLCIkc2VhcmNoUmVzdWx0cyIsImxlbmd0aCIsInJlc3VsdCIsImZpcnN0IiwiZGF0YSIsInZhbCIsInRpdGxlIiwiZG9jdW1lbnQiLCJrZXlDb2RlIiwid2hpY2giLCJoYXNDbGFzcyIsIiRlbCIsImN1cnJlbnRSb3dJZCIsInVuZGVmaW5lZCIsImNoYW5nZUxvZ2luUGFzc3dvcmRJbkxpc3QiLCJ0YWIiLCJvblZpc2libGUiLCJuZXdQYWdlTGVuZ3RoIiwiY2FsY3VsYXRlUGFnZUxlbmd0aCIsInBhZ2UiLCJsZW4iLCJkcmF3IiwiRGF0YVRhYmxlIiwibGVuZ3RoQ2hhbmdlIiwicGFnaW5nIiwicGFnZUxlbmd0aCIsInNjcm9sbENvbGxhcHNlIiwiY29sdW1ucyIsIm9yZGVyYWJsZSIsInNlYXJjaGFibGUiLCJvcmRlciIsImxhbmd1YWdlIiwiU2VtYW50aWNMb2NhbGl6YXRpb24iLCJkYXRhVGFibGVMb2NhbGlzYXRpb24iLCJzZWxlY3RlZCIsInRleHQiLCJ2YWx1ZSIsInB1c2giLCJuYW1lIiwiJGNob2ljZSIsInJvd0lkIiwiYWRkUHJvZ3Jlc3NJY29uIiwiYXBpIiwibWV0aG9kIiwidXNlcl9pZCIsImdyb3VwX2lkIiwic3VjY2Vzc1Rlc3QiLCJyZXNwb25zZSIsIk9iamVjdCIsImtleXMiLCJzdWNjZXNzIiwib25TdWNjZXNzIiwicmVtb3ZlUHJvZ3Jlc3NJY29uIiwicmVtb3ZlIiwib25FcnJvciIsIm1lc3NhZ2UiLCJVc2VyTWVzc2FnZSIsInNob3dNdWx0aVN0cmluZyIsIm9uRmFpbHVyZSIsInVzZUxkYXAiLCJwYXJlbnQiLCJoaWRlIiwic2hvdyIsImxvZ2luIiwicGFzc3dvcmQiLCJyb3dIZWlnaHQiLCJvdXRlckhlaWdodCIsIndpbmRvd0hlaWdodCIsIndpbmRvdyIsImlubmVySGVpZ2h0IiwiaGVhZGVyRm9vdGVySGVpZ2h0IiwiTWF0aCIsIm1heCIsImZsb29yIiwicmVhZHkiXSwibWFwcGluZ3MiOiI7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUVBLElBQU1BLHFCQUFxQixHQUFHO0FBRTFCO0FBQ0o7QUFDQTtBQUNBO0FBQ0lDLEVBQUFBLFdBQVcsRUFBRUMsQ0FBQyxDQUFDLGNBQUQsQ0FOWTs7QUFRMUI7QUFDSjtBQUNBO0FBQ0E7QUFDSUMsRUFBQUEsYUFBYSxFQUFFLElBWlc7O0FBYzFCO0FBQ0o7QUFDQTtBQUNBO0FBQ0lDLEVBQUFBLFlBQVksRUFBRUYsQ0FBQyxDQUFDLGVBQUQsQ0FsQlc7O0FBb0IxQjtBQUNKO0FBQ0E7QUFDQTtBQUNJRyxFQUFBQSx5QkFBeUIsRUFBRUgsQ0FBQyxDQUFDLHlCQUFELENBeEJGOztBQTBCMUI7QUFDSjtBQUNBO0FBQ0E7QUFDSUks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UCxxQkFBRCxDQUFnQ2pELElBQWhDLENBQXFDLDBCQUFyQyxFQUFpRXVFLElBQWpFO0FBQ0gsR0FuVnlCOztBQW9WMUI7QUFDSjtBQUNBO0FBQ0lWLEVBQUFBLGtCQXZWMEIsOEJBdVZQWixLQXZWTyxFQXVWQTtBQUN0QjVFLElBQUFBLENBQUMsY0FBTzRFLEtBQVAscUJBQUQsQ0FBZ0NqRCxJQUFoQyxDQUFxQywwQkFBckMsRUFBaUVzRSxJQUFqRTtBQUNBakcsSUFBQUEsQ0FBQyxjQUFPNEUsS0FBUCxxQkFBRCxDQUFnQ3RELE9BQWhDLENBQXdDLEtBQXhDLEVBQStDTyxNQUEvQyxDQUFzRCxjQUF0RCxFQUFzRUEsTUFBdEUsQ0FBNkUsU0FBN0U7QUFDSCxHQTFWeUI7O0FBNFYxQjtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0l5QixFQUFBQSxtQkFqVzBCLGlDQWlXSjtBQUNsQjtBQUNBLFFBQUkrQyxTQUFTLEdBQUd2RyxxQkFBcUIsQ0FBQ0MsV0FBdEIsQ0FBa0M0QixJQUFsQyxDQUF1QyxJQUF2QyxFQUE2Q1ksS0FBN0MsR0FBcUQrRCxXQUFyRCxFQUFoQixDQUZrQixDQUdsQjs7QUFDQSxRQUFNQyxZQUFZLEdBQUdDLE1BQU0sQ0FBQ0MsV0FBNUI7QUFDQSxRQUFNQyxrQkFBa0IsR0FBRyxHQUEzQixDQUxrQixDQUtjO0FBRWhDOztBQUNBLFdBQU9DLElBQUksQ0FBQ0MsR0FBTCxDQUFTRCxJQUFJLENBQUNFLEtBQUwsQ0FBVyxDQUFDTixZQUFZLEdBQUdHLGtCQUFoQixJQUFzQ0wsU0FBakQsQ0FBVCxFQUFzRSxFQUF0RSxDQUFQO0FBQ0g7QUExV3lCLENBQTlCO0FBNldBckcsQ0FBQyxDQUFDMkMsUUFBRCxDQUFELENBQVltRSxLQUFaLENBQWtCLFlBQU07QUFDcEJoSCxFQUFBQSxxQkFBcUIsQ0FBQ08sVUFBdEI7QUFDSCxDQUZEIiwic291cmNlc0NvbnRlbnQiOlsiLypcbiAqIE1pa29QQlggLSBmcmVlIHBob25lIHN5c3RlbSBmb3Igc21hbGwgYnVzaW5lc3NcbiAqIENvcHlyaWdodCDCqSAyMDE3LTIwMjMgQWxleGV5IFBvcnRub3YgYW5kIE5pa29sYXkgQmVrZXRvdlxuICpcbiAqIFRoaXMgcHJvZ3JhbSBpcyBmcmVlIHNvZnR3YXJlOiB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IgbW9kaWZ5XG4gKiBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieVxuICogdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbjsgZWl0aGVyIHZlcnNpb24gMyBvZiB0aGUgTGljZW5zZSwgb3JcbiAqIChhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uXG4gKlxuICogVGhpcyBwcm9ncmFtIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsXG4gKiBidXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZlxuICogTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZVxuICogR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy5cbiAqXG4gKiBZb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBhbG9uZyB3aXRoIHRoaXMgcHJvZ3JhbS5cbiAqIElmIG5vdCwgc2VlIDxodHRwczovL3d3dy5nbnUub3JnL2xpY2Vuc2VzLz4uXG4gKi9cblxuLyogZ2xvYmFsIFNlbWFudGljTG9jYWxpemF0aW9uLCBnbG9iYWxSb290VXJsLCBtb2R1bGVVc2Vyc1VpSW5kZXhMZGFwLCBVc2VyTWVzc2FnZSwgRGF0YXRhYmxlICovXG5cbmNvbnN0IE1vZHVsZVVzZXJzVUlVc2Vyc1RhYiA9IHtcblxuICAgIC8qKlxuICAgICAqIFVzZXJzIHRhYmxlLlxuICAgICAqIEB0eXBlIHtqUXVlcnl9XG4gICAgICovXG4gICAgJHVzZXJzVGFibGU6ICQoJyN1c2Vycy10YWJsZScpLFxuXG4gICAgLyoqXG4gICAgICogVXNlciBkYXRhIHRhYmxlLlxuICAgICAqIEB0eXBlIHtEYXRhdGFibGV9XG4gICAgICovXG4gICAgdXNlckRhdGFUYWJsZTogbnVsbCxcblxuICAgIC8qKlxuICAgICAqIFNlbGVjdCBncm91cCBkcm9wZG93bnMuXG4gICAgICogQHR5cGUge2pRdWVyeX1cbiAgICAgKi9cbiAgICAkc2VsZWN0R3JvdXA6ICQoJy5zZWxlY3QtZ3JvdXAnKSxcblxuICAgIC8qKlxuICAgICAqIFVzZXIgdXNlIExEQVAgdGFibGUgY2hlY2tib3hlcy5cbiAgICAgKiBAdHlwZSB7alF1ZXJ5fVxuICAgICAqL1xuICAgICR1c2VyVXNlTGRhcFRhYmxlQ2hlY2tib3g6ICQoJy51c2VyLXVzZS1sZGFwLWNoZWNrYm94JyksXG5cbiAgICAvKipcbiAgICAgKiBCb2R5LlxuICAgICAqIEB0eXBlIHtqUXVlcnl9XG4gICAgICovXG4gICAgJGJvZHk6ICQoJ2JvZHknKSxcblxuICAgIC8qKlxuICAgICAqIEluaXRpYWxpemVzIHRoZSBNb2R1bGVVc2Vyc1VJSW5kZXggbW9kdWxlLlxuICAgICAqL1xuICAgIGluaXRpYWxpemUoKSB7XG5cbiAgICAgICAgTW9kdWxlVXNlcnNVSVVzZXJzVGFiLmluaXRpYWxpemVEYXRhVGFibGUoKTtcblxuICAgICAgICBNb2R1bGVVc2Vyc1VJVXNlcnNUYWIuJHNlbGVjdEdyb3VwLmVhY2goKGluZGV4LCBvYmopID0+IHtcbiAgICAgICAgICAgICQob2JqKS5kcm9wZG93bih7XG4gICAgICAgICAgICAgICAgdmFsdWVzOiBNb2R1bGVVc2Vyc1VJVXNlcnNUYWIubWFrZURyb3Bkb3duTGlzdCgkKG9iaikuYXR0cignZGF0YS12YWx1ZScpKSxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgICAgTW9kdWxlVXNlcnNVSVVzZXJzVGFiLiRzZWxlY3RHcm91cC5kcm9wZG93bih7XG4gICAgICAgICAgICBvbkNoYW5nZTogTW9kdWxlVXNlcnNVSVVzZXJzVGFiLmNoYW5nZUdyb3VwSW5MaXN0LFxuICAgICAgICB9KTtcblxuICAgICAgICBNb2R1bGVVc2Vyc1VJVXNlcnNUYWIuJHVzZXJVc2VMZGFwVGFibGVDaGVja2JveC5jaGVja2JveCh7XG4gICAgICAgICAgICBvbkNoYW5nZTogTW9kdWxlVXNlcnNVSVVzZXJzVGFiLmNoYW5nZUxkYXBJbkxpc3QsXG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIERvdWJsZSBjbGljayBvbiBwYXNzd29yZCBvciBsb2dpbiBpbnB1dCBmaWVsZCBpbiB0aGUgdGFibGVcbiAgICAgICAgTW9kdWxlVXNlcnNVSVVzZXJzVGFiLiRib2R5Lm9uKCdmb2N1c2luJywgJy51c2VyLWxvZ2luLWlucHV0LCAudXNlci1wYXNzd29yZC1pbnB1dCcsIChlKSA9PiB7XG4gICAgICAgICAgICAkKGUudGFyZ2V0KS50cmFuc2l0aW9uKCdnbG93Jyk7XG5cbiAgICAgICAgICAgICQoZS50YXJnZXQpLmNsb3Nlc3QoJ2RpdicpXG4gICAgICAgICAgICAgICAgLnJlbW92ZUNsYXNzKCd0cmFuc3BhcmVudCcpXG4gICAgICAgICAgICAgICAgLmFkZENsYXNzKCdjaGFuZ2VkLWZpZWxkJyk7XG4gICAgICAgICAgICAkKGUudGFyZ2V0KS5hdHRyKCdyZWFkb25seScsIGZhbHNlKTtcblxuICAgICAgICAgICAgaWYgKG1vZHVsZVVzZXJzVWlJbmRleExkYXAuJHVzZUxkYXBDaGVja2JveC5jaGVja2JveCgnaXMgY2hlY2tlZCcpXG4gICAgICAgICAgICAgICAgJiYgJChlLnRhcmdldCkuY2xvc2VzdCgndHInKS5maW5kKCcudXNlci11c2UtbGRhcC1jaGVja2JveCcpLmNoZWNrYm94KCdpcyBjaGVja2VkJykpe1xuXG4gICAgICAgICAgICAgICAgY29uc3QgJGlucHV0RmllbGQgPSAkKGUudGFyZ2V0KTtcbiAgICAgICAgICAgICAgICAkaW5wdXRGaWVsZC5jbG9zZXN0KCdkaXYnKS5zZWFyY2goe1xuICAgICAgICAgICAgICAgICAgICAvLyBjaGFuZ2Ugc2VhcmNoIGVuZHBvaW50IHRvIGEgY3VzdG9tIGVuZHBvaW50IGJ5IG1hbmlwdWxhdGluZyBhcGlTZXR0aW5nc1xuICAgICAgICAgICAgICAgICAgICBhcGlTZXR0aW5nczoge1xuICAgICAgICAgICAgICAgICAgICAgICAgdXJsOiBgJHtnbG9iYWxSb290VXJsfW1vZHVsZS11c2Vycy11LWkvbGRhcC1jb25maWcvc2VhcmNoLWxkYXAtdXNlci97cXVlcnl9YFxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIC8vINCe0LHRgNCw0LHQsNGC0YvQstCw0LXQvCDRgdC+0LHRi9GC0LjQtSDQvdCw0LbQsNGC0LjRjyDQutC70LDQstC40YjQuCBFbnRlclxuICAgICAgICAgICAgICAgICRpbnB1dEZpZWxkLm9uKCdrZXlkb3duJywgZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGV2ZW50LmtleSA9PT0gJ0VudGVyJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8g0J/RgNC10LrRgNCw0YnQsNC10Lwg0LTQtdC50YHRgtCy0LjQtSDQv9C+INGD0LzQvtC70YfQsNC90LjRjiAo0LXRgdC70Lgg0YTQvtGA0LzQsCwg0YLQviDQv9GA0LXQtNC+0YLQstGA0LDRgtC40Lwg0L7RgtC/0YDQsNCy0LrRgylcbiAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0ICRzZWFyY2hSZXN1bHRzID0gJGlucHV0RmllbGQuY2xvc2VzdCgnZGl2JykuZmluZCgnLnJlc3VsdHMgLnJlc3VsdCcpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyDQldGB0LvQuCDQtdGB0YLRjCDQvtC00LjQvSDRgNC10LfRg9C70YzRgtCw0YIsINC/0L7QtNGB0YLQsNCy0LvRj9C10Lwg0LXQs9C+INCyINC/0L7Qu9C1XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoJHNlYXJjaFJlc3VsdHMubGVuZ3RoID09PSAxKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gJHNlYXJjaFJlc3VsdHMuZmlyc3QoKS5kYXRhKCdyZXN1bHQnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkaW5wdXRGaWVsZC52YWwocmVzdWx0LnRpdGxlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIFN1Ym1pdCBmb3JtIG9uIEVudGVyIG9yIFRhYlxuICAgICAgICAkKGRvY3VtZW50KS5vbigna2V5ZG93bicsIChlKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBrZXlDb2RlID0gZS5rZXlDb2RlIHx8IGUud2hpY2g7XG4gICAgICAgICAgICBpZiAoa2V5Q29kZSA9PT0gMTNcbiAgICAgICAgICAgICAgICB8fCAoa2V5Q29kZSA9PT0gOSAmJiAhJCgnOmZvY3VzJykuaGFzQ2xhc3MoJy51c2VyLWxvZ2luLWlucHV0JykpXG4gICAgICAgICAgICAgICAgfHwgKGtleUNvZGUgPT09IDkgJiYgISQoJzpmb2N1cycpLmhhc0NsYXNzKCcudXNlci1wYXNzd29yZC1pbnB1dCcpKVxuICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgJGVsID0gJCgnLmNoYW5nZWQtZmllbGQnKS5jbG9zZXN0KCd0cicpO1xuICAgICAgICAgICAgICAgICRlbC5lYWNoKChpbmRleCwgb2JqKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRSb3dJZCA9ICQob2JqKS5hdHRyKCdpZCcpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoY3VycmVudFJvd0lkICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIE1vZHVsZVVzZXJzVUlVc2Vyc1RhYi5jaGFuZ2VMb2dpblBhc3N3b3JkSW5MaXN0KGN1cnJlbnRSb3dJZCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gU3VibWl0IGZvcm0gb24gZm9jdXMgb3V0IGZyb20gcGFzc3dvcmQgb3IgbG9naW4gaW5wdXQgZmllbGRcbiAgICAgICAgTW9kdWxlVXNlcnNVSVVzZXJzVGFiLiRib2R5Lm9uKCdmb2N1c291dCcsICcudXNlci1sb2dpbi1pbnB1dCwgLnVzZXItcGFzc3dvcmQtaW5wdXQnLCAoZSkgPT4ge1xuICAgICAgICAgICAgY29uc3QgJGVsID0gJCgnLmNoYW5nZWQtZmllbGQnKS5jbG9zZXN0KCd0cicpO1xuICAgICAgICAgICAgJGVsLmVhY2goKGluZGV4LCBvYmopID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBjdXJyZW50Um93SWQgPSAkKG9iaikuYXR0cignaWQnKTtcbiAgICAgICAgICAgICAgICBpZiAoY3VycmVudFJvd0lkICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgTW9kdWxlVXNlcnNVSVVzZXJzVGFiLmNoYW5nZUxvZ2luUGFzc3dvcmRJbkxpc3QoY3VycmVudFJvd0lkKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG5cbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogSW5pdGlhbGl6ZXMgdGhlIHVzZXJzIHRhYmxlIERhdGFUYWJsZS5cbiAgICAgKi9cbiAgICBpbml0aWFsaXplRGF0YVRhYmxlKCkge1xuXG4gICAgICAgICQoJyNtYWluLXVzZXJzLXVpLXRhYi1tZW51IC5pdGVtJykudGFiKHtcbiAgICAgICAgICAgIG9uVmlzaWJsZSgpe1xuICAgICAgICAgICAgICAgIGlmICgkKHRoaXMpLmRhdGEoJ3RhYicpPT09J3VzZXJzJyAmJiBNb2R1bGVVc2Vyc1VJVXNlcnNUYWIudXNlckRhdGFUYWJsZSE9PW51bGwpe1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBuZXdQYWdlTGVuZ3RoID0gTW9kdWxlVXNlcnNVSVVzZXJzVGFiLmNhbGN1bGF0ZVBhZ2VMZW5ndGgoKTtcbiAgICAgICAgICAgICAgICAgICAgTW9kdWxlVXNlcnNVSVVzZXJzVGFiLnVzZXJEYXRhVGFibGUucGFnZS5sZW4obmV3UGFnZUxlbmd0aCkuZHJhdyhmYWxzZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICBNb2R1bGVVc2Vyc1VJVXNlcnNUYWIudXNlckRhdGFUYWJsZSA9IE1vZHVsZVVzZXJzVUlVc2Vyc1RhYi4kdXNlcnNUYWJsZS5EYXRhVGFibGUoe1xuICAgICAgICAgICAgLy8gZGVzdHJveTogdHJ1ZSxcbiAgICAgICAgICAgIGxlbmd0aENoYW5nZTogZmFsc2UsXG4gICAgICAgICAgICBwYWdpbmc6IHRydWUsXG4gICAgICAgICAgICBwYWdlTGVuZ3RoOiBNb2R1bGVVc2Vyc1VJVXNlcnNUYWIuY2FsY3VsYXRlUGFnZUxlbmd0aCgpLFxuICAgICAgICAgICAgc2Nyb2xsQ29sbGFwc2U6IHRydWUsXG4gICAgICAgICAgICBjb2x1bW5zOiBbXG4gICAgICAgICAgICAgICAgLy8gVXNlcm5hbWVcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIG9yZGVyYWJsZTogdHJ1ZSwgIC8vIFRoaXMgY29sdW1uIGlzIG9yZGVyYWJsZVxuICAgICAgICAgICAgICAgICAgICBzZWFyY2hhYmxlOiB0cnVlICAvLyBUaGlzIGNvbHVtbiBpcyBzZWFyY2hhYmxlXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAvLyBFeHRlbnNpb25cbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIG9yZGVyYWJsZTogdHJ1ZSwgIC8vIFRoaXMgY29sdW1uIGlzIG9yZGVyYWJsZVxuICAgICAgICAgICAgICAgICAgICBzZWFyY2hhYmxlOiB0cnVlICAvLyBUaGlzIGNvbHVtbiBpcyBzZWFyY2hhYmxlXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAvLyBVc2UgTERBUFxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgb3JkZXJhYmxlOiBmYWxzZSwgIC8vIFRoaXMgY29sdW1uIGlzIG5vdCBvcmRlcmFibGVcbiAgICAgICAgICAgICAgICAgICAgc2VhcmNoYWJsZTogZmFsc2UgIC8vIFRoaXMgY29sdW1uIGlzIG5vdCBzZWFyY2hhYmxlXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAvLyBMb2dpblxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgb3JkZXJhYmxlOiB0cnVlLCAgLy8gVGhpcyBjb2x1bW4gaXMgb3JkZXJhYmxlXG4gICAgICAgICAgICAgICAgICAgIHNlYXJjaGFibGU6IHRydWUgIC8vIFRoaXMgY29sdW1uIGlzIHNlYXJjaGFibGVcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIC8vIFBhc3N3b3JkXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBvcmRlcmFibGU6IGZhbHNlLCAgLy8gVGhpcyBjb2x1bW4gaXMgbm90IG9yZGVyYWJsZVxuICAgICAgICAgICAgICAgICAgICBzZWFyY2hhYmxlOiBmYWxzZSAgLy8gVGhpcyBjb2x1bW4gaXMgbm90IHNlYXJjaGFibGVcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIC8vIEFjY2VzcyBncm91cFxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgb3JkZXJhYmxlOiB0cnVlLCAgLy8gVGhpcyBjb2x1bW4gaXMgb3JkZXJhYmxlXG4gICAgICAgICAgICAgICAgICAgIHNlYXJjaGFibGU6IHRydWUgIC8vIFRoaXMgY29sdW1uIGlzIHNlYXJjaGFibGVcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgXSxcbiAgICAgICAgICAgIG9yZGVyOiBbMCwgJ2FzYyddLFxuICAgICAgICAgICAgbGFuZ3VhZ2U6IFNlbWFudGljTG9jYWxpemF0aW9uLmRhdGFUYWJsZUxvY2FsaXNhdGlvbixcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYSBkcm9wZG93biBsaXN0IGZvciB1c2Vycy5cbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gc2VsZWN0ZWQgLSBUaGUgc2VsZWN0ZWQgdmFsdWUuXG4gICAgICogQHJldHVybnMge0FycmF5fSAtIFRoZSBkcm9wZG93biBsaXN0LlxuICAgICAqL1xuICAgIG1ha2VEcm9wZG93bkxpc3Qoc2VsZWN0ZWQpIHtcbiAgICAgICAgY29uc3QgdmFsdWVzID0gW107XG4gICAgICAgICQoJyN1c2Vycy1ncm91cHMtbGlzdCBvcHRpb24nKS5lYWNoKChpbmRleCwgb2JqKSA9PiB7XG4gICAgICAgICAgICBpZiAoc2VsZWN0ZWQgPT09IG9iai50ZXh0IHx8IHNlbGVjdGVkID09PSBvYmoudmFsdWUpIHtcbiAgICAgICAgICAgICAgICB2YWx1ZXMucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgIG5hbWU6IG9iai50ZXh0LFxuICAgICAgICAgICAgICAgICAgICB2YWx1ZTogb2JqLnZhbHVlLFxuICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdmFsdWVzLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICBuYW1lOiBvYmoudGV4dCxcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IG9iai52YWx1ZSxcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiB2YWx1ZXM7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEhhbmRsZXMgdGhlIGNoYW5nZSBvZiBncm91cCBpbiB0aGUgbGlzdC5cbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gdmFsdWUgLSBUaGUgc2VsZWN0ZWQgdmFsdWUuXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IHRleHQgLSBUaGUgc2VsZWN0ZWQgdGV4dC5cbiAgICAgKiBAcGFyYW0ge2pRdWVyeX0gJGNob2ljZSAtIFRoZSBkcm9wZG93biBlbGVtZW50LlxuICAgICAqL1xuICAgIGNoYW5nZUdyb3VwSW5MaXN0KHZhbHVlLCB0ZXh0LCAkY2hvaWNlKSB7XG4gICAgICAgIGNvbnN0IHJvd0lkID0gJCgkY2hvaWNlKS5jbG9zZXN0KCd0cicpLmF0dHIoJ2lkJyk7XG4gICAgICAgIE1vZHVsZVVzZXJzVUlVc2Vyc1RhYi5hZGRQcm9ncmVzc0ljb24ocm93SWQpO1xuICAgICAgICAkLmFwaSh7XG4gICAgICAgICAgICB1cmw6IGAke2dsb2JhbFJvb3RVcmx9bW9kdWxlLXVzZXJzLXUtaS91c2Vycy1jcmVkZW50aWFscy9jaGFuZ2UtdXNlci1ncm91cGAsXG4gICAgICAgICAgICBvbjogJ25vdycsXG4gICAgICAgICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICB1c2VyX2lkOiByb3dJZCxcbiAgICAgICAgICAgICAgICBncm91cF9pZDogdmFsdWUsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc3VjY2Vzc1Rlc3QocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAvLyB0ZXN0IHdoZXRoZXIgYSBKU09OIHJlc3BvbnNlIGlzIHZhbGlkXG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlICE9PSB1bmRlZmluZWRcbiAgICAgICAgICAgICAgICAgICAgJiYgT2JqZWN0LmtleXMocmVzcG9uc2UpLmxlbmd0aCA+IDBcbiAgICAgICAgICAgICAgICAgICAgJiYgcmVzcG9uc2Uuc3VjY2VzcyA9PT0gdHJ1ZTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBvblN1Y2Nlc3MoKSB7XG4gICAgICAgICAgICAgICAgTW9kdWxlVXNlcnNVSVVzZXJzVGFiLnJlbW92ZVByb2dyZXNzSWNvbihyb3dJZCk7XG4gICAgICAgICAgICAgICAgJCgnLnVpLm1lc3NhZ2UuYWpheCcpLnJlbW92ZSgpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG9uRXJyb3IocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UubWVzc2FnZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIFVzZXJNZXNzYWdlLnNob3dNdWx0aVN0cmluZyhyZXNwb25zZS5tZXNzYWdlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgTW9kdWxlVXNlcnNVSVVzZXJzVGFiLnJlbW92ZVByb2dyZXNzSWNvbihyb3dJZCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgb25GYWlsdXJlKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLm1lc3NhZ2UgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICBVc2VyTWVzc2FnZS5zaG93TXVsdGlTdHJpbmcocmVzcG9uc2UubWVzc2FnZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIE1vZHVsZVVzZXJzVUlVc2Vyc1RhYi5yZW1vdmVQcm9ncmVzc0ljb24ocm93SWQpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEhhbmRsZXMgdGhlIGNoYW5nZSBvZiBMREFQIGNoZWNrYm94IGluIHRoZSBsaXN0LlxuICAgICAqL1xuICAgIGNoYW5nZUxkYXBJbkxpc3QoKSB7XG4gICAgICAgIGNvbnN0IHJvd0lkID0gJCh0aGlzKS5jbG9zZXN0KCd0cicpLmF0dHIoJ2lkJyk7XG4gICAgICAgIE1vZHVsZVVzZXJzVUlVc2Vyc1RhYi5hZGRQcm9ncmVzc0ljb24ocm93SWQpO1xuICAgICAgICAkLmFwaSh7XG4gICAgICAgICAgICB1cmw6IGAke2dsb2JhbFJvb3RVcmx9bW9kdWxlLXVzZXJzLXUtaS91c2Vycy1jcmVkZW50aWFscy9jaGFuZ2UtdXNlci11c2UtbGRhcGAsXG4gICAgICAgICAgICBvbjogJ25vdycsXG4gICAgICAgICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICB1c2VyX2lkOiByb3dJZCxcbiAgICAgICAgICAgICAgICB1c2VMZGFwOiAkKHRoaXMpLnBhcmVudCgnLmNoZWNrYm94JykuY2hlY2tib3goJ2lzIGNoZWNrZWQnKSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzdWNjZXNzVGVzdChyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgIC8vIHRlc3Qgd2hldGhlciBhIEpTT04gcmVzcG9uc2UgaXMgdmFsaWRcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UgIT09IHVuZGVmaW5lZFxuICAgICAgICAgICAgICAgICAgICAmJiBPYmplY3Qua2V5cyhyZXNwb25zZSkubGVuZ3RoID4gMFxuICAgICAgICAgICAgICAgICAgICAmJiByZXNwb25zZS5zdWNjZXNzID09PSB0cnVlO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG9uU3VjY2VzcygpIHtcbiAgICAgICAgICAgICAgICBNb2R1bGVVc2Vyc1VJVXNlcnNUYWIucmVtb3ZlUHJvZ3Jlc3NJY29uKHJvd0lkKTtcbiAgICAgICAgICAgICAgICBpZiAoJChgdHIjJHtyb3dJZH0gLnVzZXItdXNlLWxkYXAtY2hlY2tib3hgKS5jaGVja2JveCgnaXMgY2hlY2tlZCcpKXtcbiAgICAgICAgICAgICAgICAgICAgJChgdHIjJHtyb3dJZH0gdGQucGFzc3dvcmRgKS5oaWRlKCk7XG4gICAgICAgICAgICAgICAgICAgICQoYHRyIyR7cm93SWR9IHRkLmxvZ2luYCkuYXR0cignY29sc3BhbicsMik7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgJChgdHIjJHtyb3dJZH0gdGQucGFzc3dvcmRgKS5zaG93KCk7XG4gICAgICAgICAgICAgICAgICAgICQoYHRyIyR7cm93SWR9IHRkLmxvZ2luYCkuYXR0cignY29sc3BhbicsMSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICQoJy51aS5tZXNzYWdlLmFqYXgnKS5yZW1vdmUoKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBvbkVycm9yKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLm1lc3NhZ2UgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICBVc2VyTWVzc2FnZS5zaG93TXVsdGlTdHJpbmcocmVzcG9uc2UubWVzc2FnZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIE1vZHVsZVVzZXJzVUlVc2Vyc1RhYi5yZW1vdmVQcm9ncmVzc0ljb24ocm93SWQpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG9uRmFpbHVyZShyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5tZXNzYWdlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgVXNlck1lc3NhZ2Uuc2hvd011bHRpU3RyaW5nKHJlc3BvbnNlLm1lc3NhZ2UpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBNb2R1bGVVc2Vyc1VJVXNlcnNUYWIucmVtb3ZlUHJvZ3Jlc3NJY29uKHJvd0lkKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBDaGFuZ2VzIHRoZSBsb2dpbiBhbmQgcGFzc3dvcmQgaW4gdGhlIGxpc3QuXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IHJvd0lkIC0gVGhlIElEIG9mIHRoZSByb3cuXG4gICAgICovXG4gICAgY2hhbmdlTG9naW5QYXNzd29yZEluTGlzdChyb3dJZCkge1xuICAgICAgICBjb25zdCBsb2dpbiA9ICQoYCMke3Jvd0lkfSBpbnB1dC51c2VyLWxvZ2luLWlucHV0YCkudmFsKCk7XG4gICAgICAgIGNvbnN0IHBhc3N3b3JkID0gJChgIyR7cm93SWR9IGlucHV0LnVzZXItcGFzc3dvcmQtaW5wdXRgKS52YWwoKTtcblxuICAgICAgICBNb2R1bGVVc2Vyc1VJVXNlcnNUYWIuYWRkUHJvZ3Jlc3NJY29uKHJvd0lkKTtcblxuICAgICAgICAkLmFwaSh7XG4gICAgICAgICAgICB1cmw6IGAke2dsb2JhbFJvb3RVcmx9bW9kdWxlLXVzZXJzLXUtaS91c2Vycy1jcmVkZW50aWFscy9jaGFuZ2UtdXNlci1jcmVkZW50aWFsc2AsXG4gICAgICAgICAgICBvbjogJ25vdycsXG4gICAgICAgICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICB1c2VyX2lkOiByb3dJZCxcbiAgICAgICAgICAgICAgICBsb2dpbjogbG9naW4sXG4gICAgICAgICAgICAgICAgcGFzc3dvcmQ6IHBhc3N3b3JkLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHN1Y2Nlc3NUZXN0KHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgLy8gdGVzdCB3aGV0aGVyIGEgSlNPTiByZXNwb25zZSBpcyB2YWxpZFxuICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZSAhPT0gdW5kZWZpbmVkXG4gICAgICAgICAgICAgICAgICAgICYmIE9iamVjdC5rZXlzKHJlc3BvbnNlKS5sZW5ndGggPiAwXG4gICAgICAgICAgICAgICAgICAgICYmIHJlc3BvbnNlLnN1Y2Nlc3MgPT09IHRydWU7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgb25TdWNjZXNzKCkge1xuICAgICAgICAgICAgICAgIE1vZHVsZVVzZXJzVUlVc2Vyc1RhYi5yZW1vdmVQcm9ncmVzc0ljb24ocm93SWQpO1xuICAgICAgICAgICAgICAgICQoYHRyIyR7cm93SWR9IC5jaGFuZ2VkLWZpZWxkIGlucHV0YCkuYXR0cigncmVhZG9ubHknLCB0cnVlKTtcbiAgICAgICAgICAgICAgICAkKGB0ciMke3Jvd0lkfSBkaXYuY2hhbmdlZC1maWVsZGApLnJlbW92ZUNsYXNzKCdjaGFuZ2VkLWZpZWxkIGxvYWRpbmcnKS5hZGRDbGFzcygndHJhbnNwYXJlbnQnKTtcbiAgICAgICAgICAgICAgICAkKCcudWkubWVzc2FnZS5hamF4JykucmVtb3ZlKCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgb25FcnJvcihyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5tZXNzYWdlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgVXNlck1lc3NhZ2Uuc2hvd011bHRpU3RyaW5nKHJlc3BvbnNlLm1lc3NhZ2UpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBNb2R1bGVVc2Vyc1VJVXNlcnNUYWIucmVtb3ZlUHJvZ3Jlc3NJY29uKHJvd0lkKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBvbkZhaWx1cmUocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UubWVzc2FnZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIFVzZXJNZXNzYWdlLnNob3dNdWx0aVN0cmluZyhyZXNwb25zZS5tZXNzYWdlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgTW9kdWxlVXNlcnNVSVVzZXJzVGFiLnJlbW92ZVByb2dyZXNzSWNvbihyb3dJZCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9KTtcbiAgICB9LFxuICAgIC8qKlxuICAgICAqIEFkZHMgc2F2ZSBpY29uIGZyb20gdGhlIHJvd1xuICAgICAqL1xuICAgIGFkZFByb2dyZXNzSWNvbihyb3dJZCl7XG4gICAgICAgICQoYHRyIyR7cm93SWR9IC5jaGFuZ2VkLWZpZWxkYCkuZmluZCgnLnVpLnNwaW5uZXIubG9hZGluZy5pY29uJykuc2hvdygpO1xuICAgIH0sXG4gICAgLyoqXG4gICAgICogUmVtb3ZlcyBzYXZlIGljb24gZnJvbSB0aGUgcm93XG4gICAgICovXG4gICAgcmVtb3ZlUHJvZ3Jlc3NJY29uKHJvd0lkKSB7XG4gICAgICAgICQoYHRyIyR7cm93SWR9IC5jaGFuZ2VkLWZpZWxkYCkuZmluZCgnLnVpLnNwaW5uZXIubG9hZGluZy5pY29uJykuaGlkZSgpO1xuICAgICAgICAkKGB0ciMke3Jvd0lkfSAuY2hhbmdlZC1maWVsZGApLmNsb3Nlc3QoJ2RpdicpLnNlYXJjaCgnaGlkZSByZXN1bHRzJykuc2VhcmNoKCdkZXN0cm95Jyk7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIENhbGN1bGF0ZSBkYXRhIHRhYmxlIHBhZ2UgbGVuZ3RoXG4gICAgICpcbiAgICAgKiBAcmV0dXJucyB7bnVtYmVyfVxuICAgICAqL1xuICAgIGNhbGN1bGF0ZVBhZ2VMZW5ndGgoKSB7XG4gICAgICAgIC8vIENhbGN1bGF0ZSByb3cgaGVpZ2h0XG4gICAgICAgIGxldCByb3dIZWlnaHQgPSBNb2R1bGVVc2Vyc1VJVXNlcnNUYWIuJHVzZXJzVGFibGUuZmluZCgndHInKS5maXJzdCgpLm91dGVySGVpZ2h0KCk7XG4gICAgICAgIC8vIENhbGN1bGF0ZSB3aW5kb3cgaGVpZ2h0IGFuZCBhdmFpbGFibGUgc3BhY2UgZm9yIHRhYmxlXG4gICAgICAgIGNvbnN0IHdpbmRvd0hlaWdodCA9IHdpbmRvdy5pbm5lckhlaWdodDtcbiAgICAgICAgY29uc3QgaGVhZGVyRm9vdGVySGVpZ2h0ID0gNDAwOyAvLyBFc3RpbWF0ZSBoZWlnaHQgZm9yIGhlYWRlciwgZm9vdGVyLCBhbmQgb3RoZXIgZWxlbWVudHNcblxuICAgICAgICAvLyBDYWxjdWxhdGUgbmV3IHBhZ2UgbGVuZ3RoXG4gICAgICAgIHJldHVybiBNYXRoLm1heChNYXRoLmZsb29yKCh3aW5kb3dIZWlnaHQgLSBoZWFkZXJGb290ZXJIZWlnaHQpIC8gcm93SGVpZ2h0KSwgMTApO1xuICAgIH0sXG59O1xuXG4kKGRvY3VtZW50KS5yZWFkeSgoKSA9PiB7XG4gICAgTW9kdWxlVXNlcnNVSVVzZXJzVGFiLmluaXRpYWxpemUoKTtcbn0pO1xuXG4iXX0=