/*
 * MikoPBX - free phone system for small business
 * Copyright © 2017-2023 Alexey Portnov and Nikolay Beketov
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation; either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License along with this program.
 * If not, see <https://www.gnu.org/licenses/>.
 */

"use strict";

/*
 * MikoPBX - free phone system for small business
 * Copyright © 2017-2023 Alexey Portnov and Nikolay Beketov
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation; either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License along with this program.
 * If not, see <https://www.gnu.org/licenses/>.
 */

/* global SemanticLocalization, globalRootUrl */
var ModuleUsersUIUsersTab = {
  /**
   * Users table.
   * @type {jQuery}
   */
  $usersTable: $('#users-table'),

  /**
   * Select group dropdowns.
   * @type {jQuery}
   */
  $selectGroup: $('.select-group'),

  /**
   * User use LDAP table checkboxes.
   * @type {jQuery}
   */
  $userUseLdapTableCheckbox: $('.user-use-ldap-checkbox'),

  /**
   * Body.
   * @type {jQuery}
   */
  $body: $('body'),

  /**
   * Initializes the ModuleUsersUIIndex module.
   */
  initialize: function initialize() {
    ModuleUsersUIUsersTab.initializeDataTable();
    ModuleUsersUIUsersTab.$selectGroup.each(function (index, obj) {
      $(obj).dropdown({
        values: ModuleUsersUIUsersTab.makeDropdownList($(obj).attr('data-value'))
      });
    });
    ModuleUsersUIUsersTab.$selectGroup.dropdown({
      onChange: ModuleUsersUIUsersTab.changeGroupInList
    });
    ModuleUsersUIUsersTab.$userUseLdapTableCheckbox.checkbox({
      onChange: ModuleUsersUIUsersTab.changeLdapInList
    }); // Double click on password or login input field in the table

    ModuleUsersUIUsersTab.$body.on('focusin', '.user-login-input, .user-password-input', function (e) {
      $(e.target).transition('glow');
      $(e.target).closest('div').removeClass('transparent').addClass('changed-field');
      $(e.target).attr('readonly', false);

      if (moduleUsersUiIndexLdap.$useLdapCheckbox.checkbox('is checked') && $(e.target).closest('tr').find('.user-use-ldap-checkbox').checkbox('is checked')) {
        $(e.target).closest('div').search({
          // change search endpoint to a custom endpoint by manipulating apiSettings
          apiSettings: {
            url: "".concat(globalRootUrl, "module-users-u-i/ldap-config/search-ldap-user/{query}")
          }
        });
      }
    }); // Submit form on Enter or Tab

    $(document).on('keydown', function (e) {
      var keyCode = e.keyCode || e.which;

      if (keyCode === 13 || keyCode === 9 && !$(':focus').hasClass('.user-login-input') || keyCode === 9 && !$(':focus').hasClass('.user-password-input')) {
        var $el = $('.changed-field').closest('tr');
        $el.each(function (index, obj) {
          var currentRowId = $(obj).attr('id');

          if (currentRowId !== undefined) {
            ModuleUsersUIUsersTab.changeLoginPasswordInList(currentRowId);
          }
        });
      }
    }); // Submit form on focus out from password or login input field

    ModuleUsersUIUsersTab.$body.on('focusout', '.user-login-input, .user-password-input', function (e) {
      var $el = $('.changed-field').closest('tr');
      $el.each(function (index, obj) {
        var currentRowId = $(obj).attr('id');

        if (currentRowId !== undefined) {
          ModuleUsersUIUsersTab.changeLoginPasswordInList(currentRowId);
        }
      });
    });
  },

  /**
   * Initializes the users table DataTable.
   */
  initializeDataTable: function initializeDataTable() {
    ModuleUsersUIUsersTab.$usersTable.DataTable({
      // destroy: true,
      lengthChange: false,
      paging: false,
      columns: [// Username
      {
        orderable: true,
        // This column is orderable
        searchable: true // This column is searchable

      }, // Extension
      {
        orderable: true,
        // This column is orderable
        searchable: true // This column is searchable

      }, // Use LDAP
      {
        orderable: false,
        // This column is not orderable
        searchable: false // This column is not searchable

      }, // Login
      {
        orderable: true,
        // This column is orderable
        searchable: true // This column is searchable

      }, // Password
      {
        orderable: false,
        // This column is not orderable
        searchable: false // This column is not searchable

      }, // Access group
      {
        orderable: true,
        // This column is orderable
        searchable: true // This column is searchable

      }],
      order: [0, 'asc'],
      language: SemanticLocalization.dataTableLocalisation
    });
  },

  /**
   * Creates a dropdown list for users.
   * @param {string} selected - The selected value.
   * @returns {Array} - The dropdown list.
   */
  makeDropdownList: function makeDropdownList(selected) {
    var values = [];
    $('#users-groups-list option').each(function (index, obj) {
      if (selected === obj.text || selected === obj.value) {
        values.push({
          name: obj.text,
          value: obj.value,
          selected: true
        });
      } else {
        values.push({
          name: obj.text,
          value: obj.value
        });
      }
    });
    return values;
  },

  /**
   * Handles the change of group in the list.
   * @param {string} value - The selected value.
   * @param {string} text - The selected text.
   * @param {jQuery} $choice - The dropdown element.
   */
  changeGroupInList: function changeGroupInList(value, text, $choice) {
    var rowId = $($choice).closest('tr').attr('id');
    ModuleUsersUIUsersTab.addProgressIcon(rowId);
    $.api({
      url: "".concat(globalRootUrl, "module-users-u-i/users-credentials/change-user-group"),
      on: 'now',
      method: 'POST',
      data: {
        user_id: rowId,
        group_id: value
      },
      successTest: function successTest(response) {
        // test whether a JSON response is valid
        return response !== undefined && Object.keys(response).length > 0 && response.success === true;
      },
      onSuccess: function onSuccess() {
        ModuleUsersUIUsersTab.removeProgressIcon(rowId);
        $('.ui.message.ajax').remove();
      },
      onError: function onError(response) {
        if (response.message !== undefined) {
          UserMessage.showMultiString(response.message);
        }

        ModuleUsersUIUsersTab.removeProgressIcon(rowId);
      },
      onFailure: function onFailure(response) {
        if (response.message !== undefined) {
          UserMessage.showMultiString(response.message);
        }

        ModuleUsersUIUsersTab.removeProgressIcon(rowId);
      }
    });
  },

  /**
   * Handles the change of LDAP checkbox in the list.
   */
  changeLdapInList: function changeLdapInList() {
    var rowId = $(this).closest('tr').attr('id');
    ModuleUsersUIUsersTab.addProgressIcon(rowId);
    $.api({
      url: "".concat(globalRootUrl, "module-users-u-i/users-credentials/change-user-use-ldap"),
      on: 'now',
      method: 'POST',
      data: {
        user_id: rowId,
        useLdap: $(this).parent('.checkbox').checkbox('is checked')
      },
      successTest: function successTest(response) {
        // test whether a JSON response is valid
        return response !== undefined && Object.keys(response).length > 0 && response.success === true;
      },
      onSuccess: function onSuccess() {
        ModuleUsersUIUsersTab.removeProgressIcon(rowId);

        if ($("tr#".concat(rowId, " .user-use-ldap-checkbox")).checkbox('is checked')) {
          $("tr#".concat(rowId, " td.password")).hide();
          $("tr#".concat(rowId, " td.login")).attr('colspan', 2);
        } else {
          $("tr#".concat(rowId, " td.password")).show();
          $("tr#".concat(rowId, " td.login")).attr('colspan', 1);
        }

        $('.ui.message.ajax').remove();
      },
      onError: function onError(response) {
        if (response.message !== undefined) {
          UserMessage.showMultiString(response.message);
        }

        ModuleUsersUIUsersTab.removeProgressIcon(rowId);
      },
      onFailure: function onFailure(response) {
        if (response.message !== undefined) {
          UserMessage.showMultiString(response.message);
        }

        ModuleUsersUIUsersTab.removeProgressIcon(rowId);
      }
    });
  },

  /**
   * Changes the login and password in the list.
   * @param {string} rowId - The ID of the row.
   */
  changeLoginPasswordInList: function changeLoginPasswordInList(rowId) {
    var login = $("#".concat(rowId, " input.user-login-input")).val();
    var password = $("#".concat(rowId, " input.user-password-input")).val();
    ModuleUsersUIUsersTab.addProgressIcon(rowId);
    $.api({
      url: "".concat(globalRootUrl, "module-users-u-i/users-credentials/change-user-credentials"),
      on: 'now',
      method: 'POST',
      data: {
        user_id: rowId,
        login: login,
        password: password
      },
      successTest: function successTest(response) {
        // test whether a JSON response is valid
        return response !== undefined && Object.keys(response).length > 0 && response.success === true;
      },
      onSuccess: function onSuccess() {
        ModuleUsersUIUsersTab.removeProgressIcon(rowId);
        $("tr#".concat(rowId, " .changed-field input")).attr('readonly', true);
        $("tr#".concat(rowId, " div.changed-field")).removeClass('changed-field loading').addClass('transparent');
        $('.ui.message.ajax').remove();
      },
      onError: function onError(response) {
        if (response.message !== undefined) {
          UserMessage.showMultiString(response.message);
        }

        ModuleUsersUIUsersTab.removeProgressIcon(rowId);
      },
      onFailure: function onFailure(response) {
        if (response.message !== undefined) {
          UserMessage.showMultiString(response.message);
        }

        ModuleUsersUIUsersTab.removeProgressIcon(rowId);
      }
    });
  },

  /**
   * Adds save icon from the row
   */
  addProgressIcon: function addProgressIcon(rowId) {
    $("tr#".concat(rowId, " .changed-field")).find('.ui.spinner.loading.icon').show();
  },

  /**
   * Removes save icon from the row
   */
  removeProgressIcon: function removeProgressIcon(rowId) {
    $("tr#".concat(rowId, " .changed-field")).find('.ui.spinner.loading.icon').hide();
    $("tr#".concat(rowId, " .changed-field")).closest('div').search('hide results').search('destroy');
  }
};
$(document).ready(function () {
  ModuleUsersUIUsersTab.initialize();
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9tb2R1bGUtdXNlcnMtdWktaW5kZXgtdXNlcnMuanMiXSwibmFtZXMiOlsiTW9kdWxlVXNlcnNVSVVzZXJzVGFiIiwiJHVzZXJzVGFibGUiLCIkIiwiJHNlbGVjdEdyb3VwIiwiJHVzZXJVc2VMZGFwVGFibGVDaGVja2JveCIsIiRib2R5IiwiaW5pdGlhbGl6ZSIsImluaXRpYWxpemVEYXRhVGFibGUiLCJlYWNoIiwiaW5kZXgiLCJvYmoiLCJkcm9wZG93biIsInZhbHVlcyIsIm1ha2VEcm9wZG93bkxpc3QiLCJhdHRyIiwib25DaGFuZ2UiLCJjaGFuZ2VHcm91cEluTGlzdCIsImNoZWNrYm94IiwiY2hhbmdlTGRhcEluTGlzdCIsIm9uIiwiZSIsInRhcmdldCIsInRyYW5zaXRpb24iLCJjbG9zZXN0IiwicmVtb3ZlQ2xhc3MiLCJhZGRDbGFzcyIsIm1vZHVsZVVzZXJzVWlJbmRleExkYXAiLCIkdXNlTGRhcENoZWNrYm94IiwiZmluZCIsInNlYXJjaCIsImFwaVNldHRpbmdzIiwidXJsIiwiZ2xvYmFsUm9vdFVybCIsImRvY3VtZW50Iiwia2V5Q29kZSIsIndoaWNoIiwiaGFzQ2xhc3MiLCIkZWwiLCJjdXJyZW50Um93SWQiLCJ1bmRlZmluZWQiLCJjaGFuZ2VMb2dpblBhc3N3b3JkSW5MaXN0IiwiRGF0YVRhYmxlIiwibGVuZ3RoQ2hhbmdlIiwicGFnaW5nIiwiY29sdW1ucyIsIm9yZGVyYWJsZSIsInNlYXJjaGFibGUiLCJvcmRlciIsImxhbmd1YWdlIiwiU2VtYW50aWNMb2NhbGl6YXRpb24iLCJkYXRhVGFibGVMb2NhbGlzYXRpb24iLCJzZWxlY3RlZCIsInRleHQiLCJ2YWx1ZSIsInB1c2giLCJuYW1lIiwiJGNob2ljZSIsInJvd0lkIiwiYWRkUHJvZ3Jlc3NJY29uIiwiYXBpIiwibWV0aG9kIiwiZGF0YSIsInVzZXJfaWQiLCJncm91cF9pZCIsInN1Y2Nlc3NUZXN0IiwicmVzcG9uc2UiLCJPYmplY3QiLCJrZXlzIiwibGVuZ3RoIiwic3VjY2VzcyIsIm9uU3VjY2VzcyIsInJlbW92ZVByb2dyZXNzSWNvbiIsInJlbW92ZSIsIm9uRXJyb3IiLCJtZXNzYWdlIiwiVXNlck1lc3NhZ2UiLCJzaG93TXVsdGlTdHJpbmciLCJvbkZhaWx1cmUiLCJ1c2VMZGFwIiwicGFyZW50IiwiaGlkZSIsInNob3ciLCJsb2dpbiIsInZhbCIsInBhc3N3b3JkIiwicmVhZHkiXSwibWFwcGluZ3MiOiI7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUVBLElBQU1BLHFCQUFxQixHQUFHO0FBRTFCO0FBQ0o7QUFDQTtBQUNBO0FBQ0lDLEVBQUFBLFdBQVcsRUFBRUMsQ0FBQyxDQUFDLGNBQUQsQ0FOWTs7QUFRMUI7QUFDSjtBQUNBO0FBQ0E7QUFDSUMsRUFBQUEsWUFBWSxFQUFFRCxDQUFDLENBQUMsZUFBRCxDQVpXOztBQWMxQjtBQUNKO0FBQ0E7QUFDQTtBQUNJRSxFQUFBQSx5QkFBeUIsRUFBRUYsQ0FBQyxDQUFDLHlCQUFELENBbEJGOztBQW9CMUI7QUFDSjtBQUNBO0FBQ0E7QUFDSUcsRUFBQUEsS0FBSyxFQUFFSCxDQUFDLENBQUMsTUFBRCxDQXhCa0I7O0FBMEIxQjtBQUNKO0FBQ0E7QUFDSUksRUFBQUEsVUE3QjBCLHdCQTZCYjtBQUNUTixJQUFBQSxxQkFBcUIsQ0FBQ08sbUJBQXRCO0FBQ0FQLElBQUFBLHFCQUFxQixDQUFDRyxZQUF0QixDQUFtQ0ssSUFBbkMsQ0FBd0MsVUFBQ0MsS0FBRCxFQUFRQyxHQUFSLEVBQWdCO0FBQ3BEUixNQUFBQSxDQUFDLENBQUNRLEdBQUQsQ0FBRCxDQUFPQyxRQUFQLENBQWdCO0FBQ1pDLFFBQUFBLE1BQU0sRUFBRVoscUJBQXFCLENBQUNhLGdCQUF0QixDQUF1Q1gsQ0FBQyxDQUFDUSxHQUFELENBQUQsQ0FBT0ksSUFBUCxDQUFZLFlBQVosQ0FBdkM7QUFESSxPQUFoQjtBQUdILEtBSkQ7QUFL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bnRlbnQiOlsiLypcbiAqIE1pa29QQlggLSBmcmVlIHBob25lIHN5c3RlbSBmb3Igc21hbGwgYnVzaW5lc3NcbiAqIENvcHlyaWdodCDCqSAyMDE3LTIwMjMgQWxleGV5IFBvcnRub3YgYW5kIE5pa29sYXkgQmVrZXRvdlxuICpcbiAqIFRoaXMgcHJvZ3JhbSBpcyBmcmVlIHNvZnR3YXJlOiB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IgbW9kaWZ5XG4gKiBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieVxuICogdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbjsgZWl0aGVyIHZlcnNpb24gMyBvZiB0aGUgTGljZW5zZSwgb3JcbiAqIChhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uXG4gKlxuICogVGhpcyBwcm9ncmFtIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsXG4gKiBidXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZlxuICogTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZVxuICogR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy5cbiAqXG4gKiBZb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBhbG9uZyB3aXRoIHRoaXMgcHJvZ3JhbS5cbiAqIElmIG5vdCwgc2VlIDxodHRwczovL3d3dy5nbnUub3JnL2xpY2Vuc2VzLz4uXG4gKi9cblxuLyogZ2xvYmFsIFNlbWFudGljTG9jYWxpemF0aW9uLCBnbG9iYWxSb290VXJsICovXG5cbmNvbnN0IE1vZHVsZVVzZXJzVUlVc2Vyc1RhYiA9IHtcblxuICAgIC8qKlxuICAgICAqIFVzZXJzIHRhYmxlLlxuICAgICAqIEB0eXBlIHtqUXVlcnl9XG4gICAgICovXG4gICAgJHVzZXJzVGFibGU6ICQoJyN1c2Vycy10YWJsZScpLFxuXG4gICAgLyoqXG4gICAgICogU2VsZWN0IGdyb3VwIGRyb3Bkb3ducy5cbiAgICAgKiBAdHlwZSB7alF1ZXJ5fVxuICAgICAqL1xuICAgICRzZWxlY3RHcm91cDogJCgnLnNlbGVjdC1ncm91cCcpLFxuXG4gICAgLyoqXG4gICAgICogVXNlciB1c2UgTERBUCB0YWJsZSBjaGVja2JveGVzLlxuICAgICAqIEB0eXBlIHtqUXVlcnl9XG4gICAgICovXG4gICAgJHVzZXJVc2VMZGFwVGFibGVDaGVja2JveDogJCgnLnVzZXItdXNlLWxkYXAtY2hlY2tib3gnKSxcblxuICAgIC8qKlxuICAgICAqIEJvZHkuXG4gICAgICogQHR5cGUge2pRdWVyeX1cbiAgICAgKi9cbiAgICAkYm9keTogJCgnYm9keScpLFxuXG4gICAgLyoqXG4gICAgICogSW5pdGlhbGl6ZXMgdGhlIE1vZHVsZVVzZXJzVUlJbmRleCBtb2R1bGUuXG4gICAgICovXG4gICAgaW5pdGlhbGl6ZSgpIHtcbiAgICAgICAgTW9kdWxlVXNlcnNVSVVzZXJzVGFiLmluaXRpYWxpemVEYXRhVGFibGUoKTtcbiAgICAgICAgTW9kdWxlVXNlcnNVSVVzZXJzVGFiLiRzZWxlY3RHcm91cC5lYWNoKChpbmRleCwgb2JqKSA9PiB7XG4gICAgICAgICAgICAkKG9iaikuZHJvcGRvd24oe1xuICAgICAgICAgICAgICAgIHZhbHVlczogTW9kdWxlVXNlcnNVSVVzZXJzVGFiLm1ha2VEcm9wZG93bkxpc3QoJChvYmopLmF0dHIoJ2RhdGEtdmFsdWUnKSksXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICAgIE1vZHVsZVVzZXJzVUlVc2Vyc1RhYi4kc2VsZWN0R3JvdXAuZHJvcGRvd24oe1xuICAgICAgICAgICAgb25DaGFuZ2U6IE1vZHVsZVVzZXJzVUlVc2Vyc1RhYi5jaGFuZ2VHcm91cEluTGlzdCxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgTW9kdWxlVXNlcnNVSVVzZXJzVGFiLiR1c2VyVXNlTGRhcFRhYmxlQ2hlY2tib3guY2hlY2tib3goe1xuICAgICAgICAgICAgb25DaGFuZ2U6IE1vZHVsZVVzZXJzVUlVc2Vyc1RhYi5jaGFuZ2VMZGFwSW5MaXN0LFxuICAgICAgICB9KTtcblxuICAgICAgICAvLyBEb3VibGUgY2xpY2sgb24gcGFzc3dvcmQgb3IgbG9naW4gaW5wdXQgZmllbGQgaW4gdGhlIHRhYmxlXG4gICAgICAgIE1vZHVsZVVzZXJzVUlVc2Vyc1RhYi4kYm9keS5vbignZm9jdXNpbicsICcudXNlci1sb2dpbi1pbnB1dCwgLnVzZXItcGFzc3dvcmQtaW5wdXQnLCAoZSkgPT4ge1xuICAgICAgICAgICAgJChlLnRhcmdldCkudHJhbnNpdGlvbignZ2xvdycpO1xuXG4gICAgICAgICAgICAkKGUudGFyZ2V0KS5jbG9zZXN0KCdkaXYnKVxuICAgICAgICAgICAgICAgIC5yZW1vdmVDbGFzcygndHJhbnNwYXJlbnQnKVxuICAgICAgICAgICAgICAgIC5hZGRDbGFzcygnY2hhbmdlZC1maWVsZCcpO1xuICAgICAgICAgICAgJChlLnRhcmdldCkuYXR0cigncmVhZG9ubHknLCBmYWxzZSk7XG5cbiAgICAgICAgICAgIGlmIChtb2R1bGVVc2Vyc1VpSW5kZXhMZGFwLiR1c2VMZGFwQ2hlY2tib3guY2hlY2tib3goJ2lzIGNoZWNrZWQnKVxuICAgICAgICAgICAgICAgICYmICQoZS50YXJnZXQpLmNsb3Nlc3QoJ3RyJykuZmluZCgnLnVzZXItdXNlLWxkYXAtY2hlY2tib3gnKS5jaGVja2JveCgnaXMgY2hlY2tlZCcpKXtcbiAgICAgICAgICAgICAgICAkKGUudGFyZ2V0KS5jbG9zZXN0KCdkaXYnKS5zZWFyY2goe1xuICAgICAgICAgICAgICAgICAgICAvLyBjaGFuZ2Ugc2VhcmNoIGVuZHBvaW50IHRvIGEgY3VzdG9tIGVuZHBvaW50IGJ5IG1hbmlwdWxhdGluZyBhcGlTZXR0aW5nc1xuICAgICAgICAgICAgICAgICAgICBhcGlTZXR0aW5nczoge1xuICAgICAgICAgICAgICAgICAgICAgICAgdXJsOiBgJHtnbG9iYWxSb290VXJsfW1vZHVsZS11c2Vycy11LWkvbGRhcC1jb25maWcvc2VhcmNoLWxkYXAtdXNlci97cXVlcnl9YFxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICAvLyBTdWJtaXQgZm9ybSBvbiBFbnRlciBvciBUYWJcbiAgICAgICAgJChkb2N1bWVudCkub24oJ2tleWRvd24nLCAoZSkgPT4ge1xuICAgICAgICAgICAgY29uc3Qga2V5Q29kZSA9IGUua2V5Q29kZSB8fCBlLndoaWNoO1xuICAgICAgICAgICAgaWYgKGtleUNvZGUgPT09IDEzXG4gICAgICAgICAgICAgICAgfHwgKGtleUNvZGUgPT09IDkgJiYgISQoJzpmb2N1cycpLmhhc0NsYXNzKCcudXNlci1sb2dpbi1pbnB1dCcpKVxuICAgICAgICAgICAgICAgIHx8IChrZXlDb2RlID09PSA5ICYmICEkKCc6Zm9jdXMnKS5oYXNDbGFzcygnLnVzZXItcGFzc3dvcmQtaW5wdXQnKSlcbiAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICAgIGNvbnN0ICRlbCA9ICQoJy5jaGFuZ2VkLWZpZWxkJykuY2xvc2VzdCgndHInKTtcbiAgICAgICAgICAgICAgICAkZWwuZWFjaCgoaW5kZXgsIG9iaikgPT4ge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBjdXJyZW50Um93SWQgPSAkKG9iaikuYXR0cignaWQnKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRSb3dJZCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBNb2R1bGVVc2Vyc1VJVXNlcnNUYWIuY2hhbmdlTG9naW5QYXNzd29yZEluTGlzdChjdXJyZW50Um93SWQpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIFN1Ym1pdCBmb3JtIG9uIGZvY3VzIG91dCBmcm9tIHBhc3N3b3JkIG9yIGxvZ2luIGlucHV0IGZpZWxkXG4gICAgICAgIE1vZHVsZVVzZXJzVUlVc2Vyc1RhYi4kYm9keS5vbignZm9jdXNvdXQnLCAnLnVzZXItbG9naW4taW5wdXQsIC51c2VyLXBhc3N3b3JkLWlucHV0JywgKGUpID0+IHtcbiAgICAgICAgICAgIGNvbnN0ICRlbCA9ICQoJy5jaGFuZ2VkLWZpZWxkJykuY2xvc2VzdCgndHInKTtcbiAgICAgICAgICAgICRlbC5lYWNoKChpbmRleCwgb2JqKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgY3VycmVudFJvd0lkID0gJChvYmopLmF0dHIoJ2lkJyk7XG4gICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRSb3dJZCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIE1vZHVsZVVzZXJzVUlVc2Vyc1RhYi5jaGFuZ2VMb2dpblBhc3N3b3JkSW5MaXN0KGN1cnJlbnRSb3dJZCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuXG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEluaXRpYWxpemVzIHRoZSB1c2VycyB0YWJsZSBEYXRhVGFibGUuXG4gICAgICovXG4gICAgaW5pdGlhbGl6ZURhdGFUYWJsZSgpIHtcbiAgICAgICAgTW9kdWxlVXNlcnNVSVVzZXJzVGFiLiR1c2Vyc1RhYmxlLkRhdGFUYWJsZSh7XG4gICAgICAgICAgICAvLyBkZXN0cm95OiB0cnVlLFxuICAgICAgICAgICAgbGVuZ3RoQ2hhbmdlOiBmYWxzZSxcbiAgICAgICAgICAgIHBhZ2luZzogZmFsc2UsXG4gICAgICAgICAgICBjb2x1bW5zOiBbXG4gICAgICAgICAgICAgICAgLy8gVXNlcm5hbWVcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIG9yZGVyYWJsZTogdHJ1ZSwgIC8vIFRoaXMgY29sdW1uIGlzIG9yZGVyYWJsZVxuICAgICAgICAgICAgICAgICAgICBzZWFyY2hhYmxlOiB0cnVlICAvLyBUaGlzIGNvbHVtbiBpcyBzZWFyY2hhYmxlXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAvLyBFeHRlbnNpb25cbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIG9yZGVyYWJsZTogdHJ1ZSwgIC8vIFRoaXMgY29sdW1uIGlzIG9yZGVyYWJsZVxuICAgICAgICAgICAgICAgICAgICBzZWFyY2hhYmxlOiB0cnVlICAvLyBUaGlzIGNvbHVtbiBpcyBzZWFyY2hhYmxlXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAvLyBVc2UgTERBUFxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgb3JkZXJhYmxlOiBmYWxzZSwgIC8vIFRoaXMgY29sdW1uIGlzIG5vdCBvcmRlcmFibGVcbiAgICAgICAgICAgICAgICAgICAgc2VhcmNoYWJsZTogZmFsc2UgIC8vIFRoaXMgY29sdW1uIGlzIG5vdCBzZWFyY2hhYmxlXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAvLyBMb2dpblxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgb3JkZXJhYmxlOiB0cnVlLCAgLy8gVGhpcyBjb2x1bW4gaXMgb3JkZXJhYmxlXG4gICAgICAgICAgICAgICAgICAgIHNlYXJjaGFibGU6IHRydWUgIC8vIFRoaXMgY29sdW1uIGlzIHNlYXJjaGFibGVcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIC8vIFBhc3N3b3JkXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBvcmRlcmFibGU6IGZhbHNlLCAgLy8gVGhpcyBjb2x1bW4gaXMgbm90IG9yZGVyYWJsZVxuICAgICAgICAgICAgICAgICAgICBzZWFyY2hhYmxlOiBmYWxzZSAgLy8gVGhpcyBjb2x1bW4gaXMgbm90IHNlYXJjaGFibGVcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIC8vIEFjY2VzcyBncm91cFxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgb3JkZXJhYmxlOiB0cnVlLCAgLy8gVGhpcyBjb2x1bW4gaXMgb3JkZXJhYmxlXG4gICAgICAgICAgICAgICAgICAgIHNlYXJjaGFibGU6IHRydWUgIC8vIFRoaXMgY29sdW1uIGlzIHNlYXJjaGFibGVcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgXSxcbiAgICAgICAgICAgIG9yZGVyOiBbMCwgJ2FzYyddLFxuICAgICAgICAgICAgbGFuZ3VhZ2U6IFNlbWFudGljTG9jYWxpemF0aW9uLmRhdGFUYWJsZUxvY2FsaXNhdGlvbixcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYSBkcm9wZG93biBsaXN0IGZvciB1c2Vycy5cbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gc2VsZWN0ZWQgLSBUaGUgc2VsZWN0ZWQgdmFsdWUuXG4gICAgICogQHJldHVybnMge0FycmF5fSAtIFRoZSBkcm9wZG93biBsaXN0LlxuICAgICAqL1xuICAgIG1ha2VEcm9wZG93bkxpc3Qoc2VsZWN0ZWQpIHtcbiAgICAgICAgY29uc3QgdmFsdWVzID0gW107XG4gICAgICAgICQoJyN1c2Vycy1ncm91cHMtbGlzdCBvcHRpb24nKS5lYWNoKChpbmRleCwgb2JqKSA9PiB7XG4gICAgICAgICAgICBpZiAoc2VsZWN0ZWQgPT09IG9iai50ZXh0IHx8IHNlbGVjdGVkID09PSBvYmoudmFsdWUpIHtcbiAgICAgICAgICAgICAgICB2YWx1ZXMucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgIG5hbWU6IG9iai50ZXh0LFxuICAgICAgICAgICAgICAgICAgICB2YWx1ZTogb2JqLnZhbHVlLFxuICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdmFsdWVzLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICBuYW1lOiBvYmoudGV4dCxcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IG9iai52YWx1ZSxcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiB2YWx1ZXM7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEhhbmRsZXMgdGhlIGNoYW5nZSBvZiBncm91cCBpbiB0aGUgbGlzdC5cbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gdmFsdWUgLSBUaGUgc2VsZWN0ZWQgdmFsdWUuXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IHRleHQgLSBUaGUgc2VsZWN0ZWQgdGV4dC5cbiAgICAgKiBAcGFyYW0ge2pRdWVyeX0gJGNob2ljZSAtIFRoZSBkcm9wZG93biBlbGVtZW50LlxuICAgICAqL1xuICAgIGNoYW5nZUdyb3VwSW5MaXN0KHZhbHVlLCB0ZXh0LCAkY2hvaWNlKSB7XG4gICAgICAgIGNvbnN0IHJvd0lkID0gJCgkY2hvaWNlKS5jbG9zZXN0KCd0cicpLmF0dHIoJ2lkJyk7XG4gICAgICAgIE1vZHVsZVVzZXJzVUlVc2Vyc1RhYi5hZGRQcm9ncmVzc0ljb24ocm93SWQpO1xuICAgICAgICAkLmFwaSh7XG4gICAgICAgICAgICB1cmw6IGAke2dsb2JhbFJvb3RVcmx9bW9kdWxlLXVzZXJzLXUtaS91c2Vycy1jcmVkZW50aWFscy9jaGFuZ2UtdXNlci1ncm91cGAsXG4gICAgICAgICAgICBvbjogJ25vdycsXG4gICAgICAgICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICB1c2VyX2lkOiByb3dJZCxcbiAgICAgICAgICAgICAgICBncm91cF9pZDogdmFsdWUsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc3VjY2Vzc1Rlc3QocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAvLyB0ZXN0IHdoZXRoZXIgYSBKU09OIHJlc3BvbnNlIGlzIHZhbGlkXG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlICE9PSB1bmRlZmluZWRcbiAgICAgICAgICAgICAgICAgICAgJiYgT2JqZWN0LmtleXMocmVzcG9uc2UpLmxlbmd0aCA+IDBcbiAgICAgICAgICAgICAgICAgICAgJiYgcmVzcG9uc2Uuc3VjY2VzcyA9PT0gdHJ1ZTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBvblN1Y2Nlc3MoKSB7XG4gICAgICAgICAgICAgICAgTW9kdWxlVXNlcnNVSVVzZXJzVGFiLnJlbW92ZVByb2dyZXNzSWNvbihyb3dJZCk7XG4gICAgICAgICAgICAgICAgJCgnLnVpLm1lc3NhZ2UuYWpheCcpLnJlbW92ZSgpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG9uRXJyb3IocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UubWVzc2FnZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIFVzZXJNZXNzYWdlLnNob3dNdWx0aVN0cmluZyhyZXNwb25zZS5tZXNzYWdlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgTW9kdWxlVXNlcnNVSVVzZXJzVGFiLnJlbW92ZVByb2dyZXNzSWNvbihyb3dJZCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgb25GYWlsdXJlKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLm1lc3NhZ2UgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICBVc2VyTWVzc2FnZS5zaG93TXVsdGlTdHJpbmcocmVzcG9uc2UubWVzc2FnZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIE1vZHVsZVVzZXJzVUlVc2Vyc1RhYi5yZW1vdmVQcm9ncmVzc0ljb24ocm93SWQpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEhhbmRsZXMgdGhlIGNoYW5nZSBvZiBMREFQIGNoZWNrYm94IGluIHRoZSBsaXN0LlxuICAgICAqL1xuICAgIGNoYW5nZUxkYXBJbkxpc3QoKSB7XG4gICAgICAgIGNvbnN0IHJvd0lkID0gJCh0aGlzKS5jbG9zZXN0KCd0cicpLmF0dHIoJ2lkJyk7XG4gICAgICAgIE1vZHVsZVVzZXJzVUlVc2Vyc1RhYi5hZGRQcm9ncmVzc0ljb24ocm93SWQpO1xuICAgICAgICAkLmFwaSh7XG4gICAgICAgICAgICB1cmw6IGAke2dsb2JhbFJvb3RVcmx9bW9kdWxlLXVzZXJzLXUtaS91c2Vycy1jcmVkZW50aWFscy9jaGFuZ2UtdXNlci11c2UtbGRhcGAsXG4gICAgICAgICAgICBvbjogJ25vdycsXG4gICAgICAgICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICB1c2VyX2lkOiByb3dJZCxcbiAgICAgICAgICAgICAgICB1c2VMZGFwOiAkKHRoaXMpLnBhcmVudCgnLmNoZWNrYm94JykuY2hlY2tib3goJ2lzIGNoZWNrZWQnKSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzdWNjZXNzVGVzdChyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgIC8vIHRlc3Qgd2hldGhlciBhIEpTT04gcmVzcG9uc2UgaXMgdmFsaWRcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UgIT09IHVuZGVmaW5lZFxuICAgICAgICAgICAgICAgICAgICAmJiBPYmplY3Qua2V5cyhyZXNwb25zZSkubGVuZ3RoID4gMFxuICAgICAgICAgICAgICAgICAgICAmJiByZXNwb25zZS5zdWNjZXNzID09PSB0cnVlO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG9uU3VjY2VzcygpIHtcbiAgICAgICAgICAgICAgICBNb2R1bGVVc2Vyc1VJVXNlcnNUYWIucmVtb3ZlUHJvZ3Jlc3NJY29uKHJvd0lkKTtcbiAgICAgICAgICAgICAgICBpZiAoJChgdHIjJHtyb3dJZH0gLnVzZXItdXNlLWxkYXAtY2hlY2tib3hgKS5jaGVja2JveCgnaXMgY2hlY2tlZCcpKXtcbiAgICAgICAgICAgICAgICAgICAgJChgdHIjJHtyb3dJZH0gdGQucGFzc3dvcmRgKS5oaWRlKCk7XG4gICAgICAgICAgICAgICAgICAgICQoYHRyIyR7cm93SWR9IHRkLmxvZ2luYCkuYXR0cignY29sc3BhbicsMik7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgJChgdHIjJHtyb3dJZH0gdGQucGFzc3dvcmRgKS5zaG93KCk7XG4gICAgICAgICAgICAgICAgICAgICQoYHRyIyR7cm93SWR9IHRkLmxvZ2luYCkuYXR0cignY29sc3BhbicsMSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICQoJy51aS5tZXNzYWdlLmFqYXgnKS5yZW1vdmUoKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBvbkVycm9yKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLm1lc3NhZ2UgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICBVc2VyTWVzc2FnZS5zaG93TXVsdGlTdHJpbmcocmVzcG9uc2UubWVzc2FnZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIE1vZHVsZVVzZXJzVUlVc2Vyc1RhYi5yZW1vdmVQcm9ncmVzc0ljb24ocm93SWQpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG9uRmFpbHVyZShyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5tZXNzYWdlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgVXNlck1lc3NhZ2Uuc2hvd011bHRpU3RyaW5nKHJlc3BvbnNlLm1lc3NhZ2UpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBNb2R1bGVVc2Vyc1VJVXNlcnNUYWIucmVtb3ZlUHJvZ3Jlc3NJY29uKHJvd0lkKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBDaGFuZ2VzIHRoZSBsb2dpbiBhbmQgcGFzc3dvcmQgaW4gdGhlIGxpc3QuXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IHJvd0lkIC0gVGhlIElEIG9mIHRoZSByb3cuXG4gICAgICovXG4gICAgY2hhbmdlTG9naW5QYXNzd29yZEluTGlzdChyb3dJZCkge1xuICAgICAgICBjb25zdCBsb2dpbiA9ICQoYCMke3Jvd0lkfSBpbnB1dC51c2VyLWxvZ2luLWlucHV0YCkudmFsKCk7XG4gICAgICAgIGNvbnN0IHBhc3N3b3JkID0gJChgIyR7cm93SWR9IGlucHV0LnVzZXItcGFzc3dvcmQtaW5wdXRgKS52YWwoKTtcblxuICAgICAgICBNb2R1bGVVc2Vyc1VJVXNlcnNUYWIuYWRkUHJvZ3Jlc3NJY29uKHJvd0lkKTtcblxuICAgICAgICAkLmFwaSh7XG4gICAgICAgICAgICB1cmw6IGAke2dsb2JhbFJvb3RVcmx9bW9kdWxlLXVzZXJzLXUtaS91c2Vycy1jcmVkZW50aWFscy9jaGFuZ2UtdXNlci1jcmVkZW50aWFsc2AsXG4gICAgICAgICAgICBvbjogJ25vdycsXG4gICAgICAgICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICB1c2VyX2lkOiByb3dJZCxcbiAgICAgICAgICAgICAgICBsb2dpbjogbG9naW4sXG4gICAgICAgICAgICAgICAgcGFzc3dvcmQ6IHBhc3N3b3JkLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHN1Y2Nlc3NUZXN0KHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgLy8gdGVzdCB3aGV0aGVyIGEgSlNPTiByZXNwb25zZSBpcyB2YWxpZFxuICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZSAhPT0gdW5kZWZpbmVkXG4gICAgICAgICAgICAgICAgICAgICYmIE9iamVjdC5rZXlzKHJlc3BvbnNlKS5sZW5ndGggPiAwXG4gICAgICAgICAgICAgICAgICAgICYmIHJlc3BvbnNlLnN1Y2Nlc3MgPT09IHRydWU7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgb25TdWNjZXNzKCkge1xuICAgICAgICAgICAgICAgIE1vZHVsZVVzZXJzVUlVc2Vyc1RhYi5yZW1vdmVQcm9ncmVzc0ljb24ocm93SWQpO1xuICAgICAgICAgICAgICAgICQoYHRyIyR7cm93SWR9IC5jaGFuZ2VkLWZpZWxkIGlucHV0YCkuYXR0cigncmVhZG9ubHknLCB0cnVlKTtcbiAgICAgICAgICAgICAgICAkKGB0ciMke3Jvd0lkfSBkaXYuY2hhbmdlZC1maWVsZGApLnJlbW92ZUNsYXNzKCdjaGFuZ2VkLWZpZWxkIGxvYWRpbmcnKS5hZGRDbGFzcygndHJhbnNwYXJlbnQnKTtcbiAgICAgICAgICAgICAgICAkKCcudWkubWVzc2FnZS5hamF4JykucmVtb3ZlKCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgb25FcnJvcihyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5tZXNzYWdlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgVXNlck1lc3NhZ2Uuc2hvd011bHRpU3RyaW5nKHJlc3BvbnNlLm1lc3NhZ2UpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBNb2R1bGVVc2Vyc1VJVXNlcnNUYWIucmVtb3ZlUHJvZ3Jlc3NJY29uKHJvd0lkKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBvbkZhaWx1cmUocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UubWVzc2FnZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIFVzZXJNZXNzYWdlLnNob3dNdWx0aVN0cmluZyhyZXNwb25zZS5tZXNzYWdlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgTW9kdWxlVXNlcnNVSVVzZXJzVGFiLnJlbW92ZVByb2dyZXNzSWNvbihyb3dJZCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9KTtcbiAgICB9LFxuICAgIC8qKlxuICAgICAqIEFkZHMgc2F2ZSBpY29uIGZyb20gdGhlIHJvd1xuICAgICAqL1xuICAgIGFkZFByb2dyZXNzSWNvbihyb3dJZCl7XG4gICAgICAgICQoYHRyIyR7cm93SWR9IC5jaGFuZ2VkLWZpZWxkYCkuZmluZCgnLnVpLnNwaW5uZXIubG9hZGluZy5pY29uJykuc2hvdygpO1xuICAgIH0sXG4gICAgLyoqXG4gICAgICogUmVtb3ZlcyBzYXZlIGljb24gZnJvbSB0aGUgcm93XG4gICAgICovXG4gICAgcmVtb3ZlUHJvZ3Jlc3NJY29uKHJvd0lkKSB7XG4gICAgICAgICQoYHRyIyR7cm93SWR9IC5jaGFuZ2VkLWZpZWxkYCkuZmluZCgnLnVpLnNwaW5uZXIubG9hZGluZy5pY29uJykuaGlkZSgpO1xuICAgICAgICAkKGB0ciMke3Jvd0lkfSAuY2hhbmdlZC1maWVsZGApLmNsb3Nlc3QoJ2RpdicpLnNlYXJjaCgnaGlkZSByZXN1bHRzJykuc2VhcmNoKCdkZXN0cm95Jyk7XG4gICAgfVxufTtcblxuJChkb2N1bWVudCkucmVhZHkoKCkgPT4ge1xuICAgIE1vZHVsZVVzZXJzVUlVc2Vyc1RhYi5pbml0aWFsaXplKCk7XG59KTtcblxuIl19