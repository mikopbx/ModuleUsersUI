"use strict";

/*
 * MikoPBX - free phone system for small business
 * Copyright Â© 2017-2023 Alexey Portnov and Nikolay Beketov
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation; either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License along with this program.
 * If not, see <https://www.gnu.org/licenses/>.
 */

/** global: globalRootUrl */

/**
 * ExtensionCredentialsTab module for managing extension credentials tab.
 * @module ExtensionCredentialsTab
 */
var ExtensionCredentialsTab = {
  /**
   * Hidden field for LDAP enabled status.
   * @type {jQuery}
   * @private
   */
  $ldapEnabledHiddenField: $('#module_users_ui_ldap_enabled'),

  /**
   * Checkbox for LDAP authentication.
   * @type {jQuery}
   * @private
   */
  $useLdapCheckbox: $('#module_users_ui_use_ldap_auth'),

  /**
   * Login input field.
   * @type {jQuery}
   * @private
   */
  $loginField: $('#module_users_ui_login'),

  /**
   * Password input field.
   * @type {jQuery}
   * @private
   */
  $passwordField: $('#module_users_ui_password'),

  /**
   * Access group dropdown.
   * @type {jQuery}
   * @private
   */
  $accessGroupDropdown: $('#module_users_ui_access_group'),

  /**
   * Fields, which we need to disable if selected access group is 'No access'.
   * @type {jQuery}
   * @private
   */
  $disableIfNoAccess: $('.disable-if-no-access'),

  /**
   * Initializes the ExtensionCredentialsTab module.
   */
  initialize: function initialize() {
    ExtensionCredentialsTab.showHideAuthFields();
    ExtensionCredentialsTab.showHideUseLdapCheckbox();
    ExtensionCredentialsTab.showHidePasswordInput();
    ExtensionCredentialsTab.$useLdapCheckbox.parent('.checkbox').checkbox({
      onChange: ExtensionCredentialsTab.showHidePasswordInput
    });
    ExtensionCredentialsTab.$accessGroupDropdown.parent('.dropdown').dropdown({
      onChange: ExtensionCredentialsTab.showHideAuthFields
    });
  },

  /**
   * Shows or hides the authentication fields based on the selected access group.
   */
  showHideAuthFields: function showHideAuthFields() {
    if (ExtensionCredentialsTab.$accessGroupDropdown.val() === 'No access') {
      ExtensionCredentialsTab.$disableIfNoAccess.addClass('disabled');
    } else {
      ExtensionCredentialsTab.$disableIfNoAccess.removeClass('disabled');
    }
  },

  /**
   * Shows or hides the LDAP checkbox based on the LDAP enabled status.
   */
  showHideUseLdapCheckbox: function showHideUseLdapCheckbox() {
    if (ExtensionCredentialsTab.$ldapEnabledHiddenField.val() === '1') {
      ExtensionCredentialsTab.$useLdapCheckbox.parent('.field').show();
    } else {
      ExtensionCredentialsTab.$useLdapCheckbox.parent('.field').hide();
      ExtensionCredentialsTab.$useLdapCheckbox.parent('.checkbox').checkbox('set unchecked');
    }
  },

  /**
   * Shows or hides the password input based on the LDAP checkbox status.
   */
  showHidePasswordInput: function showHidePasswordInput() {
    if (ExtensionCredentialsTab.$useLdapCheckbox.parent('.checkbox').checkbox('is checked')) {
      ExtensionCredentialsTab.$passwordField.parent('.field').hide();
    } else {
      ExtensionCredentialsTab.$passwordField.parent('.field').show();
    }

    ExtensionCredentialsTab.activateLdapLoginSearch();
  },

  /**
   * Activate or disactivate ldap search feature
   */
  activateLdapLoginSearch: function activateLdapLoginSearch() {
    if (ExtensionCredentialsTab.$useLdapCheckbox.parent('.checkbox').checkbox('is checked')) {
      var $inputField = ExtensionCredentialsTab.$loginField;
      $inputField.parent('.ui.search').search({
        apiSettings: {
          url: "".concat(globalRootUrl, "module-users-u-i/ldap-config/search-ldap-user/{query}")
        }
      }); // Handle Enter key press event

      $inputField.on('keydown', function (event) {
        if (event.key === 'Enter') {
          // Prevent default action (if form, prevent submission)
          event.preventDefault();
          var $searchResults = $inputField.closest('div').find('.results .result'); // If there is one result, insert it into the field

          if ($searchResults.length === 1) {
            var result = $searchResults.first().data('result');
            $inputField.val(result.title);
          }
        }
      });
    } else {
      ExtensionCredentialsTab.$loginField.parent('.ui.search').search('hide results').search('destroy');
    }
  }
};
$(document).ready(function () {
  ExtensionCredentialsTab.initialize();
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9tb2R1bGUtdXNlcnMtdWktZXh0ZW5zaW9ucy1tb2RpZnkuanMiXSwibmFtZXMiOlsiRXh0ZW5zaW9uQ3JlZGVudGlhbHNUYWIiLCIkbGRhcEVuYWJsZWRIaWRkZW5GaWVsZCIsIiQiLCIkdXNlTGRhcENoZWNrYm94IiwiJGxvZ2luRmllbGQiLCIkcGFzc3dvcmRGaWVsZCIsIiRhY2Nlc3NHcm91cERyb3Bkb3duIiwiJGRpc2FibGVJZk5vQWNjZXNzIiwiaW5pdGlhbGl6ZSIsInNob3dIaWRlQXV0aEZpZWxkcyIsInNob3dIaWRlVXNlTGRhcENoZWNrYm94Iiwic2hvd0hpZGVQYXNzd29yZElucHV0IiwicGFyZW50IiwiY2hlY2tib3giLCJvbkNoYW5nZSIsImRyb3Bkb3duIiwidmFsIiwiYWRkQ2xhc3MiLCJyZW1vdmVDbGFzcyIsInNob3ciLCJoaWRlIiwiYWN0aXZhdGVMZGFwTG9naW5TZWFyY2giLCIkaW5wdXRGaWVsZCIsInNlYXJjaCIsImFwaVNldHRpbmdzIiwidXJsIiwiZ2xvYmFsUm9vdFVybCIsIm9uIiwiZXZlbnQiLCJrZXkiLCJwcmV2ZW50RGVmYXVsdCIsIiRzZWFyY2hSZXN1bHRzIiwiY2xvc2VzdCIsImZpbmQiLCJsZW5ndGgiLCJyZXN1bHQiLCJmaXJzdCIsImRhdGEiLCJ0aXRsZSIsImRvY3VtZW50IiwicmVhZHkiXSwibWFwcGluZ3MiOiI7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQU1BLHVCQUF1QixHQUFHO0FBQzVCO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDSUMsRUFBQUEsdUJBQXVCLEVBQUVDLENBQUMsQ0FBQywrQkFBRCxDQU5FOztBQVE1QjtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0lDLEVBQUFBLGdCQUFnQixFQUFFRCxDQUFDLENBQUMsZ0NB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b1BCWCAtIGZyZWUgcGhvbmUgc3lzdGVtIGZvciBzbWFsbCBidXNpbmVzc1xuICogQ29weXJpZ2h0IMKpIDIwMTctMjAyMyBBbGV4ZXkgUG9ydG5vdiBhbmQgTmlrb2xheSBCZWtldG92XG4gKlxuICogVGhpcyBwcm9ncmFtIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnlcbiAqIGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5XG4gKiB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uOyBlaXRoZXIgdmVyc2lvbiAzIG9mIHRoZSBMaWNlbnNlLCBvclxuICogKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi5cbiAqXG4gKiBUaGlzIHByb2dyYW0gaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCxcbiAqIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mXG4gKiBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlXG4gKiBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLlxuICpcbiAqIFlvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFsb25nIHdpdGggdGhpcyBwcm9ncmFtLlxuICogSWYgbm90LCBzZWUgPGh0dHBzOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvPi5cbiAqL1xuXG4vKiogZ2xvYmFsOiBnbG9iYWxSb290VXJsICovXG5cbi8qKlxuICogRXh0ZW5zaW9uQ3JlZGVudGlhbHNUYWIgbW9kdWxlIGZvciBtYW5hZ2luZyBleHRlbnNpb24gY3JlZGVudGlhbHMgdGFiLlxuICogQG1vZHVsZSBFeHRlbnNpb25DcmVkZW50aWFsc1RhYlxuICovXG5jb25zdCBFeHRlbnNpb25DcmVkZW50aWFsc1RhYiA9IHtcbiAgICAvKipcbiAgICAgKiBIaWRkZW4gZmllbGQgZm9yIExEQVAgZW5hYmxlZCBzdGF0dXMuXG4gICAgICogQHR5cGUge2pRdWVyeX1cbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgICRsZGFwRW5hYmxlZEhpZGRlbkZpZWxkOiAkKCcjbW9kdWxlX3VzZXJzX3VpX2xkYXBfZW5hYmxlZCcpLFxuXG4gICAgLyoqXG4gICAgICogQ2hlY2tib3ggZm9yIExEQVAgYXV0aGVudGljYXRpb24uXG4gICAgICogQHR5cGUge2pRdWVyeX1cbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgICR1c2VMZGFwQ2hlY2tib3g6ICQoJyNtb2R1bGVfdXNlcnNfdWlfdXNlX2xkYXBfYXV0aCcpLFxuXG4gICAgLyoqXG4gICAgICogTG9naW4gaW5wdXQgZmllbGQuXG4gICAgICogQHR5cGUge2pRdWVyeX1cbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgICRsb2dpbkZpZWxkOiAkKCcjbW9kdWxlX3VzZXJzX3VpX2xvZ2luJyksXG5cbiAgICAvKipcbiAgICAgKiBQYXNzd29yZCBpbnB1dCBmaWVsZC5cbiAgICAgKiBAdHlwZSB7alF1ZXJ5fVxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgJHBhc3N3b3JkRmllbGQ6ICQoJyNtb2R1bGVfdXNlcnNfdWlfcGFzc3dvcmQnKSxcblxuICAgIC8qKlxuICAgICAqIEFjY2VzcyBncm91cCBkcm9wZG93bi5cbiAgICAgKiBAdHlwZSB7alF1ZXJ5fVxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgJGFjY2Vzc0dyb3VwRHJvcGRvd246ICQoJyNtb2R1bGVfdXNlcnNfdWlfYWNjZXNzX2dyb3VwJyksXG5cbiAgICAvKipcbiAgICAgKiBGaWVsZHMsIHdoaWNoIHdlIG5lZWQgdG8gZGlzYWJsZSBpZiBzZWxlY3RlZCBhY2Nlc3MgZ3JvdXAgaXMgJ05vIGFjY2VzcycuXG4gICAgICogQHR5cGUge2pRdWVyeX1cbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgICRkaXNhYmxlSWZOb0FjY2VzczogJCgnLmRpc2FibGUtaWYtbm8tYWNjZXNzJyksXG5cbiAgICAvKipcbiAgICAgKiBJbml0aWFsaXplcyB0aGUgRXh0ZW5zaW9uQ3JlZGVudGlhbHNUYWIgbW9kdWxlLlxuICAgICAqL1xuICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgRXh0ZW5zaW9uQ3JlZGVudGlhbHNUYWIuc2hvd0hpZGVBdXRoRmllbGRzKCk7XG4gICAgICAgIEV4dGVuc2lvbkNyZWRlbnRpYWxzVGFiLnNob3dIaWRlVXNlTGRhcENoZWNrYm94KCk7XG4gICAgICAgIEV4dGVuc2lvbkNyZWRlbnRpYWxzVGFiLnNob3dIaWRlUGFzc3dvcmRJbnB1dCgpO1xuICAgICAgICBFeHRlbnNpb25DcmVkZW50aWFsc1RhYi4kdXNlTGRhcENoZWNrYm94LnBhcmVudCgnLmNoZWNrYm94JykuY2hlY2tib3goe1xuICAgICAgICAgICAgb25DaGFuZ2U6IEV4dGVuc2lvbkNyZWRlbnRpYWxzVGFiLnNob3dIaWRlUGFzc3dvcmRJbnB1dCxcbiAgICAgICAgfSk7XG4gICAgICAgIEV4dGVuc2lvbkNyZWRlbnRpYWxzVGFiLiRhY2Nlc3NHcm91cERyb3Bkb3duLnBhcmVudCgnLmRyb3Bkb3duJykuZHJvcGRvd24oe1xuICAgICAgICAgICAgb25DaGFuZ2U6IEV4dGVuc2lvbkNyZWRlbnRpYWxzVGFiLnNob3dIaWRlQXV0aEZpZWxkcyxcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIFNob3dzIG9yIGhpZGVzIHRoZSBhdXRoZW50aWNhdGlvbiBmaWVsZHMgYmFzZWQgb24gdGhlIHNlbGVjdGVkIGFjY2VzcyBncm91cC5cbiAgICAgKi9cbiAgICBzaG93SGlkZUF1dGhGaWVsZHMoKXtcbiAgICAgICAgaWYgKEV4dGVuc2lvbkNyZWRlbnRpYWxzVGFiLiRhY2Nlc3NHcm91cERyb3Bkb3duLnZhbCgpID09PSAnTm8gYWNjZXNzJyl7XG4gICAgICAgICAgICBFeHRlbnNpb25DcmVkZW50aWFsc1RhYi4kZGlzYWJsZUlmTm9BY2Nlc3MuYWRkQ2xhc3MoJ2Rpc2FibGVkJyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBFeHRlbnNpb25DcmVkZW50aWFsc1RhYi4kZGlzYWJsZUlmTm9BY2Nlc3MucmVtb3ZlQ2xhc3MoJ2Rpc2FibGVkJyk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogU2hvd3Mgb3IgaGlkZXMgdGhlIExEQVAgY2hlY2tib3ggYmFzZWQgb24gdGhlIExEQVAgZW5hYmxlZCBzdGF0dXMuXG4gICAgICovXG4gICAgc2hvd0hpZGVVc2VMZGFwQ2hlY2tib3g6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKEV4dGVuc2lvbkNyZWRlbnRpYWxzVGFiLiRsZGFwRW5hYmxlZEhpZGRlbkZpZWxkLnZhbCgpID09PSAnMScpIHtcbiAgICAgICAgICAgIEV4dGVuc2lvbkNyZWRlbnRpYWxzVGFiLiR1c2VMZGFwQ2hlY2tib3gucGFyZW50KCcuZmllbGQnKS5zaG93KCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBFeHRlbnNpb25DcmVkZW50aWFsc1RhYi4kdXNlTGRhcENoZWNrYm94LnBhcmVudCgnLmZpZWxkJykuaGlkZSgpO1xuICAgICAgICAgICAgRXh0ZW5zaW9uQ3JlZGVudGlhbHNUYWIuJHVzZUxkYXBDaGVja2JveC5wYXJlbnQoJy5jaGVja2JveCcpLmNoZWNrYm94KCdzZXQgdW5jaGVja2VkJyk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogU2hvd3Mgb3IgaGlkZXMgdGhlIHBhc3N3b3JkIGlucHV0IGJhc2VkIG9uIHRoZSBMREFQIGNoZWNrYm94IHN0YXR1cy5cbiAgICAgKi9cbiAgICBzaG93SGlkZVBhc3N3b3JkSW5wdXQ6IGZ1bmN0aW9uICgpe1xuICAgICAgICBpZiAoRXh0ZW5zaW9uQ3JlZGVudGlhbHNUYWIuJHVzZUxkYXBDaGVja2JveC5wYXJlbnQoJy5jaGVja2JveCcpLmNoZWNrYm94KCdpcyBjaGVja2VkJykpIHtcbiAgICAgICAgICAgIEV4dGVuc2lvbkNyZWRlbnRpYWxzVGFiLiRwYXNzd29yZEZpZWxkLnBhcmVudCgnLmZpZWxkJykuaGlkZSgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgRXh0ZW5zaW9uQ3JlZGVudGlhbHNUYWIuJHBhc3N3b3JkRmllbGQucGFyZW50KCcuZmllbGQnKS5zaG93KCk7XG4gICAgICAgIH1cbiAgICAgICAgRXh0ZW5zaW9uQ3JlZGVudGlhbHNUYWIuYWN0aXZhdGVMZGFwTG9naW5TZWFyY2goKTtcbiAgICB9LFxuICAgIC8qKlxuICAgICAqIEFjdGl2YXRlIG9yIGRpc2FjdGl2YXRlIGxkYXAgc2VhcmNoIGZlYXR1cmVcbiAgICAgKi9cbiAgICBhY3RpdmF0ZUxkYXBMb2dpblNlYXJjaCgpe1xuICAgICAgICBpZiAoRXh0ZW5zaW9uQ3JlZGVudGlhbHNUYWIuJHVzZUxkYXBDaGVja2JveC5wYXJlbnQoJy5jaGVja2JveCcpLmNoZWNrYm94KCdpcyBjaGVja2VkJykpe1xuICAgICAgICAgICAgY29uc3QgJGlucHV0RmllbGQgPSBFeHRlbnNpb25DcmVkZW50aWFsc1RhYi4kbG9naW5GaWVsZDtcbiAgICAgICAgICAgICRpbnB1dEZpZWxkLnBhcmVudCgnLnVpLnNlYXJjaCcpLnNlYXJjaCh7XG4gICAgICAgICAgICAgICAgYXBpU2V0dGluZ3M6IHtcbiAgICAgICAgICAgICAgICAgICAgdXJsOiBgJHtnbG9iYWxSb290VXJsfW1vZHVsZS11c2Vycy11LWkvbGRhcC1jb25maWcvc2VhcmNoLWxkYXAtdXNlci97cXVlcnl9YFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIC8vIEhhbmRsZSBFbnRlciBrZXkgcHJlc3MgZXZlbnRcbiAgICAgICAgICAgICRpbnB1dEZpZWxkLm9uKCdrZXlkb3duJywgZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgICAgICAgICBpZiAoZXZlbnQua2V5ID09PSAnRW50ZXInKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIFByZXZlbnQgZGVmYXVsdCBhY3Rpb24gKGlmIGZvcm0sIHByZXZlbnQgc3VibWlzc2lvbilcbiAgICAgICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgJHNlYXJjaFJlc3VsdHMgPSAkaW5wdXRGaWVsZC5jbG9zZXN0KCdkaXYnKS5maW5kKCcucmVzdWx0cyAucmVzdWx0Jyk7XG4gICAgICAgICAgICAgICAgICAgIC8vIElmIHRoZXJlIGlzIG9uZSByZXN1bHQsIGluc2VydCBpdCBpbnRvIHRoZSBmaWVsZFxuICAgICAgICAgICAgICAgICAgICBpZiAoJHNlYXJjaFJlc3VsdHMubGVuZ3RoID09PSAxKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCByZXN1bHQgPSAkc2VhcmNoUmVzdWx0cy5maXJzdCgpLmRhdGEoJ3Jlc3VsdCcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgJGlucHV0RmllbGQudmFsKHJlc3VsdC50aXRsZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIEV4dGVuc2lvbkNyZWRlbnRpYWxzVGFiLiRsb2dpbkZpZWxkLnBhcmVudCgnLnVpLnNlYXJjaCcpLnNlYXJjaCgnaGlkZSByZXN1bHRzJykuc2VhcmNoKCdkZXN0cm95Jyk7XG4gICAgICAgIH1cblxuICAgIH0sXG59XG4kKGRvY3VtZW50KS5yZWFkeSgoKSA9PiB7XG4gICAgRXh0ZW5zaW9uQ3JlZGVudGlhbHNUYWIuaW5pdGlhbGl6ZSgpO1xufSk7XG4iXX0=